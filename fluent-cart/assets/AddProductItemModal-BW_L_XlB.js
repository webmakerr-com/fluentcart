var N=Object.defineProperty;var z=(t,i,e)=>i in t?N(t,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[i]=e;var $=(t,i,e)=>z(t,typeof i!="symbol"?i+"":i,e);import{N as L,a as S,b as q,o,i as I,c as d,f as s,e as V,n as B,d as p,u as a,t as h,F as A,h as T,g as C,p as R,w as y}from"./vue.esm-bundler-DZdE0M9V.js";import{_ as U}from"./DynamicIcon-D-LZibaK.js";import D from"./CaretRight-2tV7VHCK.js";import{S as P}from"./Str-Ckn63bs5.js";import{f as k}from"./productService-BVWCmR6j.js";import{t as v}from"./Translator-Bios5QX5.js";import{M as E}from"./Model-B7FTF6mI.js";import{R as F}from"./Rest-DEQMhckH.js";import{A as G}from"./Arr-MwYQQ3qa.js";import{A as O}from"./Asset-DDfERlE5.js";const j={__name:"ItemCheckbox",props:{model:{type:Object,required:!0},variant:{type:Object,required:!0}},setup(t){const i=t;return L(()=>{i.model.data.selectionStates[i.variant.id]===void 0&&(i.model.data.selectionStates[i.variant.id]=!1)}),(e,l)=>{const n=S("el-checkbox");return o(),q(n,{modelValue:t.model.data.selectionStates[t.variant.id],"onUpdate:modelValue":l[0]||(l[0]=r=>t.model.data.selectionStates[t.variant.id]=r),onChange:l[1]||(l[1]=r=>{t.model.onVariationSelected(t.variant,r)})},null,8,["modelValue"])}}},H={class:"fct-collapsible-item-inner"},J={class:"fct-collapsible-item"},K={class:"fct-collapsible-content-wrapper"},Q={key:1,class:"content-indent"},W={key:2,class:"content-checkbox",style:{width:"15px"}},X={class:"content-img"},Y=["src","alt"],Z={class:"content-title"},ee={class:"title"},te={key:0,class:"fct-collapsible-stock-wrapper"},ae={key:0},le={key:1,class:"text-red-500"},oe={class:"fct-collapsible-value-wrapper"},se={key:0},ie={key:1},de={class:"fct-collapsible-item-child-inner"},ne={class:"fct-collapsible-item"},ce={class:"fct-collapsible-content-wrapper"},re={class:"content-checkbox"},ue={class:"content-img"},pe=["src","alt"],me={class:"content-title"},he={class:"title"},fe={class:"fct-collapsible-stock-wrapper"},ve={key:0},be={key:1,class:"text-red-500"},ge={class:"fct-collapsible-value-wrapper"},_e={__name:"ListItem",props:{model:{type:Object,required:!0},product:{type:Object,required:!0},variant:{type:Object,required:!0},showCollapseButton:{type:Boolean,default:!1},stock:{type:String,default:""},checked:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1}},emits:["toggleCollapse","updateSelectedVariations"],setup(t,{emit:i}){var M;const e=t,l=I(!1);I(!1);const n=e.model.getProductTitle(e.product),r=((M=e.variant.manage_stock)==null?void 0:M.toString())==="1",u=e.variant.item_price,x=e.variant.available;return(b,c)=>{var g,w,_;return o(),d("div",H,[s("div",J,[s("div",K,[t.showCollapseButton?(o(),d("div",{key:0,onClick:c[0]||(c[0]=m=>l.value=!l.value),class:B(["content-collapsible-btn",{"is-collapsed":l.value}])},[p(D,{class:"icon w-3 h-3"})],2)):V("",!0),t.showCollapseButton?V("",!0):(o(),d("div",Q)),t.product.variants.length===1?(o(),d("div",W,[p(j,{model:t.model,variant:t.variant,disabled:t.product.variants.length>1},null,8,["model","variant","disabled"])])):V("",!0),s("div",X,[s("img",{src:t.model.getProductThumbnail(t.product),alt:a(n)},null,8,Y)]),s("div",Z,[s("div",ee,h(a(n)),1)])]),t.product.variants.length===1?(o(),d("div",te,[t.product.detail.stock_availability==="in-stock"?(o(),d("span",ae,h(r?a(v)("Available %s",a(x)):a(v)("Unlimited")),1)):(o(),d("span",le,h(a(P).capitalize(t.product.detail.stock_availability)),1))])):V("",!0),s("div",oe,[((w=(g=t.product)==null?void 0:g.variants)==null?void 0:w.length)>1?(o(),d("span",se,h(t.product.detail.min_price!=t.product.detail.max_price?a(k)(t.product.detail.min_price)+" - "+a(k)(t.product.detail.max_price):a(k)(t.product.detail.min_price)),1)):(o(),d("span",ie,h(a(k)(a(u))),1))])]),((_=t.product)==null?void 0:_.variants.length)>1?(o(),d("div",{key:0,class:B(["fct-collapsible-item-child-container",{"is-collapsed":l.value}])},[s("ul",de,[(o(!0),d(A,null,T(t.product.variants,(m,f)=>(o(),d("li",{key:f},[s("div",ne,[s("div",ce,[s("div",re,[p(j,{model:t.model,variant:m},null,8,["model","variant"])]),s("div",ue,[s("img",{src:t.model.getVariantThumbnail(m),alt:m.variation_title},null,8,pe)]),s("div",me,[s("div",he,h(m.variation_title),1)])]),s("div",fe,[m.stock_status=="in-stock"?(o(),d("span",ve,h(m.manage_stock.toString()!=="1"?b.$t("Available %s",m.available):b.$t("Unlimited")),1)):(o(),d("span",be,h(a(P).capitalize(m.stock_status)),1))]),s("div",ge,h(a(k)(m.price)),1)])]))),128))])],2)):V("",!0)])}}},Ve={class:"fct-collapsible-list-item-inner"},ye={__name:"ProductListItem",props:{model:{type:Object,required:!0},product:{type:Object,required:!0},allowSubscription:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},preSelectedVariations:{type:Object,default:{}}},emits:["onVariationSelectionUpdated"],setup(t,{emit:i}){const e=i;return(l,n)=>(o(),d("div",Ve,[p(_e,{product:t.product,model:t.model,variant:t.product.variants[0],showCollapseButton:t.product.variants.length>1,onUpdateSelectedVariations:n[0]||(n[0]=(r,u)=>{e("onVariationSelectionUpdated",r,u)})},null,8,["product","model","variant","showCollapseButton"])]))}},ke={class:"fct-collapsible-list"},Se={__name:"VariationSelector",props:{model:{type:Object,required:!0},allowSubscription:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},preSelectedVariations:{type:Object,default:{}}},emits:["onVariationSelectionUpdated"],setup(t,{emit:i}){const e=i;return(l,n)=>(o(),d("ul",ke,[C(h(t.model.data.selectedVariationIds)+" ",1),(o(!0),d(A,null,T(t.model.data.products,(r,u)=>(o(),d("li",{class:"fct-collapsible-list-item",key:u},[p(ye,{model:t.model,product:r,preSelectedVariations:{},isMultiple:!0,allow_subscription:!1,onOnVariationSelectionUpdated:n[0]||(n[0]=()=>{e("onVariationSelectionUpdated")})},null,8,["model","product"])]))),128))]))}};class Me extends E{constructor(){super(...arguments);$(this,"data",{search:"",loading:!1,products:[],selectedVariations:{},showModal:!1,isMultiple:!1,selectedVariationIds:[],lastManagedVariationId:null,selectionStates:{}})}openModal(){this.data.showModal=!0,this.fetchProducts()}closeModal(){this.data.showModal=!1,this.data.selectedVariationIds=[]}toggleModal(){this.data.showModal=!this.data.showModal}setPreselectedVariations(e){this.data.selectedVariationIds=e,e.forEach(l=>{this.data.selectionStates[l]=!0})}fetchProducts(e=[]){this.loading=!0;let l={active_view:"publish",per_page:10,page:1,search:this.data.search,filter_type:"simple",sort_by:"ID",with:["detail.variants.media","categories","variants.media"]};return e&&(l.scopes=e),new Promise((n,r)=>{F.get("products",l).then(u=>{this.data.products=G.get(u,"products.data",[]),this.data.selectionStates={},n(u)}).catch(u=>{console.log(u),r(u)}).finally(()=>{this.loading=!1})})}get loading(){return this.data.loading}getProductTitle(e){return e.post_title}getProductThumbnail(e){var l;return((l=e.detail.featured_media)==null?void 0:l.url)||O.getUrl("images/placeholder-small.svg")}getVariantThumbnail(e){return e.thumbnail||O.getUrl("images/placeholder-small.svg")}onVariationSelected(e,l){this.data.isMultiple?l?this.data.selectedVariationIds.push(e.id):this.data.selectedVariationIds=this.data.selectedVariationIds.filter(n=>n!==e.id):(this.data.selectedVariationIds=[e.id],this.data.lastManagedVariationId!==e.id&&(this.data.selectionStates[this.data.lastManagedVariationId]=!1)),this.data.lastManagedVariationId=e.id}isChecked(e){return this.data.selectedVariationIds.includes(e.id)}}function we(){return Me.init()}const Ie={class:"fct-add-product-item-elementor-modal-wrap"},xe={class:"-mx-5 pb-5 border border-solid border-t-0 border-x-0 border-gray-divider dark:border-dark-400"},Ce={class:"px-5"},$e={key:1,class:"fc_product_search_table"},Be={class:"dialog-footer"},De={__name:"AddProductItemModal",props:{scopes:{type:Array,default:[]},isMultiple:{type:Boolean,default:!1},selectedIds:{type:Array,default:[]}},emits:["onVariationSelectionUpdated"],setup(t,{emit:i}){const e=we(),l=i,n=t;e.data.isMultiple=n.isMultiple;const r=I(n.scopes),u=I(n.selectedIds);R(()=>n.selectedIds,(b,c)=>{u.value=b});const x=()=>{l("onVariationSelectionUpdated",e.data.selectedVariationIds,e.data.products),e.closeModal()},M=async()=>{e.data.showModal=!0,await e.fetchProducts(r.value),e.setPreselectedVariations(u.value)};return(b,c)=>{const g=S("el-input"),w=S("el-skeleton"),_=S("el-button"),m=S("el-dialog");return o(),d("div",Ie,[p(g,{modelValue:a(e).data.search,"onUpdate:modelValue":c[0]||(c[0]=f=>a(e).data.search=f),onClick:c[1]||(c[1]=f=>M()),placeholder:a(v)("Search products")},{prefix:y(()=>[p(U,{name:"Search"})]),_:1},8,["modelValue","placeholder"]),p(m,{modelValue:a(e).data.showModal,"onUpdate:modelValue":c[5]||(c[5]=f=>a(e).data.showModal=f),title:a(v)("Select Items"),onClose:c[6]||(c[6]=f=>a(e).closeModal())},{default:y(()=>[s("div",xe,[s("div",Ce,[p(g,{placeholder:a(v)("Search products"),autofocus:"",ref:"fc_product_search_new",onInput:c[2]||(c[2]=f=>a(e).fetchProducts(r.value)),modelValue:a(e).data.search,"onUpdate:modelValue":c[3]||(c[3]=f=>a(e).data.search=f),clearable:""},{prefix:y(()=>[p(U,{name:"Search"})]),_:1},8,["placeholder","modelValue"])])]),s("div",null,[a(e).loading?(o(),q(w,{key:0,class:"px-5 py-4",loading:a(e).loading,rows:5,animated:""},null,8,["loading"])):(o(),d("div",$e,[p(Se,{model:a(e),products:a(e).data.products,preSelectedVariations:{},isMultiple:!0,allow_subscription:!1},null,8,["model","products"])]))]),s("div",Be,[p(_,{onClick:c[4]||(c[4]=f=>a(e).closeModal())},{default:y(()=>[C(h(a(v)("Cancel")),1)]),_:1}),p(_,{disabled:!a(e).data.selectedVariationIds.length,type:"primary",onClick:x},{default:y(()=>[C(h(a(v)("Ok")),1)]),_:1},8,["disabled"])])]),_:1},8,["modelValue","title"])])}}};export{De as _};
