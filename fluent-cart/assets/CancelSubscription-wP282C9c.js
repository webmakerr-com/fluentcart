import{i as V,j as re,c as a,t as o,u as i,o as t,d as s,w as n,f as e,e as k,g as T,F as L,a as v,b as C,n as K,W as ae,X as ie,h as B,C as Z,m as G}from"./vue.esm-bundler-DZdE0M9V.js";import{_ as Q}from"./Empty-aPQNCX5s.js";import{B as j,I as ce}from"./Badge-CAEsoWyQ.js";import{t as r,a as ee,A as U}from"./Translator-Bios5QX5.js";import{S as R}from"./Str-Ckn63bs5.js";import{U as te}from"./Url-D4lOoZOf.js";import{_ as N}from"./DynamicIcon-D-LZibaK.js";import{_ as H}from"./RouteCell-DrtjJJDU.js";import{C as F}from"./productService-BVWCmR6j.js";import{O as se}from"./OrderCustomerInformation-DVrA669s.js";import{R as de}from"./Rest-DEQMhckH.js";import{n as z}from"./Notify-CV-A2uNH.js";import{L as ue}from"./NotFound-tC_jj0zn.js";import{h as _e,a as oe}from"./index-DwF99AZu.js";import{A as W}from"./Arr-MwYQQ3qa.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./common-D35bkMcN.js";import{d as Y}from"./Utils-DWmIjEEK.js";const me=["title"],J={__name:"ConvertedTime",props:{dateTime:{type:[Object,String],required:!1},withTime:{type:Boolean,required:!1,default:!0},onlyTime:{type:Boolean,required:!1,default:!1}},setup(d){const h=d,_=V("MMM DD");return re(()=>{h.withTime&&(_.value="MMM DD h:mm A"),h.onlyTime&&(_.value="h:mm A")}),($,O)=>(t(),a("span",{title:i(Y)(d.dateTime,"h:mm A")},o(i(Y)(d.dateTime,_.value)),9,me))}},pe={class:"fct-popover-box"},he={class:"fct-popover-content fct-customer-info-popover"},fe={class:"fct-customer-info-list"},ve={class:"title"},be={class:"dot-separator"},ye={class:"text"},ge={class:"text"},ke={class:"fct-customer-card fct-popover-box-action"},we={class:"fct-customer-name mr-4 truncate"},$e={class:"fct-popover-box-action-icon"},X={__name:"CustomerInfoPopover",props:{customer:{type:Object,required:!0},toRoute:{type:Object,required:!0}},setup(d){return(h,_)=>{const $=v("router-link"),O=v("el-button"),c=v("el-popover");return t(),a("div",pe,[s(c,{placement:"bottom-start",width:280,trigger:"click"},{reference:n(()=>{var b;return[e("div",ke,[e("div",we,o(((b=d.customer)==null?void 0:b.full_name)||i(r)("No Name")),1),e("div",$e,[s(N,{name:"ChevronDown"})])])]}),default:n(()=>{var b,x,w,M,p;return[e("div",he,[e("ul",fe,[e("li",null,[e("span",ve,o(((b=d.customer)==null?void 0:b.full_name)||i(r)("No Name")),1)]),e("li",null,[e("div",be,[e("span",null,[d.customer.purchase_count>0?(t(),a(L,{key:0},[T(o(i(ee)(d.customer.purchase_count)),1)],64)):k("",!0),T(" "+o(h.$n("Order","Orders",d.customer.purchase_count??0,"No Order")),1)]),e("span",null,o(d.customer.country_name),1)])]),_[0]||(_[0]=e("li",null,[e("div",{class:"separator"})],-1)),e("li",null,[e("div",ye,[s($,{to:{name:"view_customer",params:{customer_id:(x=d.customer)==null?void 0:x.id}}},{default:n(()=>{var D;return[T(o((D=d.customer)==null?void 0:D.email),1)]}),_:1},8,["to"])])]),e("li",null,[e("div",ge,o((M=(w=d.customer)==null?void 0:w.primary_billing_address)==null?void 0:M.phone),1)])]),s(O,{size:"small",tag:"router-link",to:{name:"view_customer",params:{customer_id:(p=d.customer)==null?void 0:p.id}}},{default:n(()=>[T(o(h.$t("View Customer")),1)]),_:1},8,["to"])])]}),_:1}),s(H,{class:"hover:no-underline",to:d.toRoute},{default:n(()=>_[1]||(_[1]=[e("span",null," ",-1)])),_:1,__:[1]},8,["to"])])}}},Ce={class:"fct-bulk-delete-action-wrap p-4 pl-5 pt-0"},xe={class:"fct-bulk-delete-action-dialog-content space-y-4"},Te={key:0},Oe={class:"m-0 mb-2"},Me={key:0,class:"text-sm text-gray-600 mb-3"},Se={key:1},Ie={class:"m-0 mb-3"},Le={class:"max-h-60 overflow-x-hidden"},De={class:"font-mono text-sm"},Ne={class:"flex items-center justify-end gap-2"},He={class:"text-xs"},Pe={key:2,class:"!mt-2 p-3 bg-gray-50 dark:bg-primary-500 rounded"},Ve={class:"flex justify-between text-sm"},Re={class:"text-green-600"},qe={class:"text-red-600"},Ae={key:3},Be={class:"text-sm text-red-600"},je={class:"flex justify-end"},Ee={__name:"BulkDeleteAction",props:{selectedOrders:{type:Array,required:!0},onComplete:{type:Function,default:()=>{}}},setup(d){const h=d,_=V(!1),$=V(0);V(!1);const O=V(!1),c=V([]),b=V(""),x=()=>{c.value=[],$.value=0,b.value=""},w=(l=0)=>{if(!h.selectedOrders.length){x();return}if(l>h.selectedOrders.length-1){setTimeout(()=>{const I=c.value.filter(A=>A.status==="success").length,E=c.value.filter(A=>A.status==="error").length;I>0&&z.success(`${I} orders deleted successfully`),E>0&&z.error(`${E} orders failed to delete`),_.value=!1,b.value=""},500);return}const f=h.selectedOrders[l],u=f.id,P=f.invoice_no;b.value=P;const y=c.value.findIndex(I=>I.id===u);if(f.status==="completed"){y!==-1&&(c.value[y].status="warning",c.value[y].error_message=`Cannot delete order ${P} due to status: completed`),$.value=Math.round((l+1)/h.selectedOrders.length*100),w(l+1);return}y!==-1&&(c.value[y].status="processing"),de.delete("/orders/"+u,{ids:[u]}).then(I=>{y!==-1&&(c.value[y].status="success",c.value[y].invoice_no=I.data.invoice_no),$.value=Math.round((l+1)/h.selectedOrders.length*100),w(l+1)}).catch(I=>{console.log(`Error deleting order ${P} (ID: ${u}):`,I),y!==-1&&(c.value[y].status="error",c.value[y].error_message=I&&I.message||"Unknown error"),$.value=Math.round((l+1)/h.selectedOrders.length*100),w(l+1)})},M=()=>{h.selectedOrders.length&&(_.value=!0,O.value=!0,x(),c.value=h.selectedOrders.map(l=>({id:l.id,invoice_no:l.invoice_no,parent_id:l.parent_id,status:l.status==="completed"?"warning":"pending",error_message:l.status==="completed"?`${r("Cannot delete order %s due to status: completed",l.invoice_no)}`:""})),w(0))},p=l=>{switch(l){case"success":return"Check";case"error":return"Cross";case"processing":return"Loading";case"warning":return"Warning";default:return"Clock"}},D=l=>{switch(l){case"success":return"text-green-500";case"error":return"text-red-500";case"processing":return"text-blue-500";case"warning":return"text-warning-500";default:return"text-gray-400"}},S=l=>{switch(l){case"success":return r("Success");case"error":return r("Failed");case"processing":return r("Processing...");case"warning":return r("Undeletable");default:return r("Pending")}},q=()=>{O.value=!1,h.onComplete()};return(l,f)=>{const u=v("el-button"),P=v("el-popconfirm"),y=v("el-progress"),I=v("el-table-column"),E=v("el-icon"),A=v("el-table"),m=v("el-dialog");return t(),a("div",Ce,[s(P,{title:i(r)("Are you sure you want to delete these orders?"),onConfirm:M,width:"250"},{reference:n(()=>[s(u,{type:"danger",size:"small",loading:_.value,disabled:_.value||!d.selectedOrders.length,class:"flex items-center gap-2"},{default:n(()=>[_.value?(t(),a(L,{key:1},[T(o(i(r)("Deleting...")),1)],64)):(t(),a(L,{key:0},[s(N,{name:"Delete",class:"w-4 h-4"}),T(" "+o(i(r)("Delete Selected (%s)",d.selectedOrders.length)),1)],64))]),_:1},8,["loading","disabled"])]),_:1},8,["title"]),s(m,{modelValue:O.value,"onUpdate:modelValue":f[1]||(f[1]=g=>O.value=g),title:i(r)("Deleting Orders"),width:"800px","close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,"modal-class":"fct-bulk-delete-action-dialog"},{footer:n(()=>[e("div",je,[s(u,{onClick:f[0]||(f[0]=g=>q()),disabled:_.value,type:"primary"},{default:n(()=>[T(o(_.value?i(r)("Processing..."):i(r)("Done")),1)]),_:1},8,["disabled"])])]),default:n(()=>[e("div",xe,[_.value?(t(),a("div",Te,[e("p",Oe,o(i(r)("Please do not close or refresh this window. Please wait while we delete the selected orders...")),1),b.value?(t(),a("p",Me,o(i(r)("Currently processing: %s",b.value)),1)):k("",!0)])):(t(),a("div",Se,[e("p",Ie,o(i(r)("Deletion completed")),1)])),s(y,{percentage:$.value,"stroke-width":6,striped:"","striped-flow":"",class:"mb-4 !mt-0",status:_.value?void 0:"success"},null,8,["percentage","status"]),e("div",Le,[s(A,{data:c.value,class:"w-full",size:"small"},{default:n(()=>[s(I,{label:i(r)("Invoice No."),"min-width":"120"},{default:n(g=>[e("span",De,o(g.row.invoice_no||g.row.id),1)]),_:1},8,["label"]),s(I,{label:i(r)("Status"),width:"150",align:"right"},{default:n(g=>[e("div",Ne,[g.row.status!=="processing"?(t(),C(N,{key:0,name:p(g.row.status),class:K(["w-4 h-4 flex-none ",D(g.row.status)])},null,8,["name","class"])):(t(),C(E,{key:1,class:"is-loading text-blue-500"},{default:n(()=>[s(i(_e))]),_:1})),e("span",He,[g.row.status=="error"||g.row.status=="warning"?(t(),C(ue,{key:0,title:S(g.row.status),content:g.row.error_message},null,8,["title","content"])):(t(),a(L,{key:1},[T(o(S(g.row.status)),1)],64))])])]),_:1},8,["label"])]),_:1},8,["data"])]),!_.value&&c.value.length?(t(),a("div",Pe,[e("div",Ve,[e("span",null,o(i(r)("Total"))+": "+o(c.value.length),1),e("span",Re,o(i(r)("Success"))+": "+o(c.value.filter(g=>g.status==="success").length),1),e("span",qe,o(i(r)("Failed"))+": "+o(c.value.filter(g=>g.status==="error").length),1)])])):k("",!0),c.value.filter(g=>g.status==="warning").length?(t(),a("div",Ae,[e("p",Be,o(i(r)("We have found some completed orders that are not deletable (%s)",c.value.filter(g=>g.status==="warning").length)),1)])):k("",!0)])]),_:1},8,["modelValue","title"])])}}},le={name:"CustomColumnRenderer",components:{Badge:j,DynamicIcon:N},props:{data:{type:Object,required:!0},templateContent:{type:String,required:!1,default:""}},data(){return{}},render(){if(this.templateContent){const d=`<div>${this.templateContent}</div>`,h=ae(d).bind(this);return ie(h,{data:this.data,app:this})}return null}},Fe={class:"fct-orders-table-wrap"},Ue=["title"],ze={key:1},We={class:"fct-popover-box"},Qe={class:"fct-popover-content"},Je={class:"fct-product-orders-items is-scroll"},Xe={class:"variation-title"},Ge={key:0},Ke={class:"fct-popover-box-action"},Ye={key:0,class:"block w-full truncate mr-4"},Ze={key:1,class:"block w-full truncate mr-4"},et={class:"fct-popover-box-action-icon"},tt=["innerHTML"],st=["innerHTML"],ot=["innerHTML"],nt={class:"fct-status-group"},lt=["src","alt"],rt={key:0},at={key:1},it=["innerHTML"],ct=["innerHTML"],dt={class:"fct-btn-group sm justify-end"},ut={class:"table-cell"},bo={__name:"OrdersTable",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:r("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(d,{expose:h}){const _=d,$=V([]),O=U.get("site_url"),c=U.get("receipt_page_url"),b=l=>_.columns.includes(l),x=l=>U.get("payment_logos."+l),w=c||!1,M=l=>l?te.appendQueryParams(O,{"fluent-cart":"receipt",order_hash:l,download:1}):"",p=l=>l.filter(f=>f.payment_type!=="signup_fee"),D=l=>{$.value=l.map(f=>({id:f.id,parent_id:f.parent_id,invoice_no:f.invoice_no,status:f.status}))},S=()=>{_.table.fetch()},q=l=>{switch(l){case"payment":return r("Payment");case"subscription":return r("Subscription");case"renewal":return r("Renewal");default:R.headline(l)}};return h({selectedOrders:$}),(l,f)=>{const u=v("el-table-column"),P=v("router-link"),y=v("el-popover"),I=v("el-tag"),E=v("el-tooltip"),A=v("el-table");return t(),a("div",Fe,[$.value.length?(t(),C(Ee,{key:0,"selected-orders":$.value,"on-complete":S},null,8,["selected-orders"])):k("",!0),s(A,{class:"w-full compact-table",data:d.orders,"tooltip-options":{popperClass:"fct-tooltip-long"},onSelectionChange:D},{empty:n(()=>[s(Q,{icon:"Empty/Order","has-dark":"",text:d.emptyText},null,8,["text"])]),default:n(()=>[d.table&&d.table.data.showDeleteBulkAction?(t(),C(u,{key:0,type:"selection",width:"45"})):k("",!0),s(u,{width:140,label:i(r)("Date")},{default:n(m=>[s(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[e("div",null,[e("div",{title:i(r)("Order ID: %s",m.row.id),class:"text-xs text-system-mid dark:text-gray-300 mb-0.5"},o(m.row.invoice_no),9,Ue),s(J,{"date-time":m.row.created_at,"with-time":!1},null,8,["date-time"])])]),_:2},1032,["to"])]),_:1},8,["label"]),b("customer")?(t(),C(u,{key:1,width:130,label:i(r)("Customer")},{default:n(m=>[m.row.customer?(t(),C(X,{key:0,customer:m.row.customer,"to-route":{name:"view_order",params:{order_id:m.row.id}}},null,8,["customer","to-route"])):(t(),a("span",ze,o(i(r)("Customer Not Found")),1))]),_:1},8,["label"])):k("",!0),b("order_items")?(t(),C(u,{key:2,"min-width":200,label:i(r)("Items")},{default:n(m=>[e("div",We,[s(y,{placement:"bottom-start",width:360,trigger:"click"},{reference:n(()=>{var g;return[e("div",Ke,[p(m.row.order_items).length===1?(t(),a("span",Ye,o((g=p(m.row.order_items)[0])==null?void 0:g.post_title),1)):(t(),a("span",Ze,o(i(ee)(p(m.row.order_items).length))+" "+o(l.$t("items")),1)),e("div",et,[s(N,{name:"ChevronDown"})])])]}),default:n(()=>[e("div",Qe,[e("div",Je,[(t(!0),a(L,null,B(p(m.row.order_items),g=>(t(),a("p",{key:g.id},[s(P,{class:"title",to:{name:"product_edit",params:{product_id:g==null?void 0:g.post_id}}},{default:n(()=>[T(o(g.post_title),1)]),_:2},1032,["to"]),e("span",Xe,[e("b",null,o(g.quantity),1),T(" x "+o(g.title),1)])]))),128)),p(m.row.order_items).length===0?(t(),a("p",Ge,o(i(r)("No products found!")),1)):k("",!0)])])]),_:2},1024),s(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>f[0]||(f[0]=[e("span",null," ",-1)])),_:2,__:[0]},1032,["to"])])]),_:1},8,["label"])):k("",!0),s(u,{width:150,label:i(r)("Total")},{default:n(m=>[s(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[parseInt(m.row.total_refund)?(t(),a(L,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:i(F).formatNumber(m.row.total_amount,!0,!1,m.row.currency)},null,8,st),m.row.payment_status!="refunded"?(t(),a("span",{key:0,style:{"margin-left":"5px"},innerHTML:i(F).formatNumber(parseInt(m.row.total_amount)-parseInt(m.row.total_refund),!0,!1,m.row.currency)},null,8,ot)):k("",!0)],64)):(t(),a("span",{key:0,innerHTML:i(F).formatNumber(m.row.total_amount,!0,!1,m.row.currency)},null,8,tt))]),_:2},1032,["to"])]),_:1},8,["label"]),s(u,{width:150,label:i(r)("Payment Status")},{default:n(m=>[s(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[e("div",nt,[s(j,{status:m.row.payment_status,"hide-icon":!0},null,8,["status"]),x(m.row.payment_method)?(t(),a("span",{key:0,class:K(["img",m.row.payment_method])},[e("img",{src:x(m.row.payment_method),alt:i(R).headline(m.row.payment_method)},null,8,lt)],2)):(t(),C(I,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:n(()=>[T(o(i(R).headline(m.row.payment_method)),1)]),_:2},1024))])]),_:2},1032,["to"])]),_:1},8,["label"]),b("status")?(t(),C(u,{key:3,width:120,label:i(r)("Status")},{default:n(m=>[s(H,{class:"hover:no-underline",to:{name:"view_order",params:{order_id:m.row.id}}},{default:n(()=>[(t(),C(j,{status:m.row.status,"hide-icon":!0,key:m.row.id},null,8,["status"]))]),_:2},1032,["to"])]),_:1},8,["label"])):k("",!0),b("type")?(t(),C(u,{key:4,width:140,label:i(r)("Order Type")},{default:n(m=>[e("span",null,o(q(m.row.type)),1),s(se,{order:m.row},null,8,["order"])]),_:1},8,["label"])):k("",!0),d.table?(t(!0),a(L,{key:5},B(d.table.getCustomColumns(),m=>(t(),C(u,{label:m.label},{default:n(g=>[m.render_template?(t(),a("div",rt,[(t(),C(Z(le),{templateContent:m.template,data:{column:m,order:g.row,index:g.$index}},null,8,["templateContent","data"]))])):(t(),a("div",at,[m.as_link!==!1?(t(),C(H,{key:0,class:"hover:no-underline",to:{name:"view_order",params:{order_id:g.row.id}}},{default:n(()=>[e("div",{innerHTML:i(W).get(g.row,m.accessor)},null,8,it)]),_:2},1032,["to"])):(t(),a("div",{key:1,innerHTML:i(W).get(g.row,m.accessor)},null,8,ct))]))]),_:2},1032,["label"]))),256)):k("",!0),b("actions")&&i(w)?(t(),C(u,{key:6,width:"60",label:""},{default:n(m=>[e("div",dt,[e("div",ut,[s(E,{content:i(r)("View Invoice"),placement:"top","popper-class":"fct-tooltip"},{default:n(()=>[s(ce,{target:"_blank",href:M(m.row.uuid),size:"small",tag:"a",bg:"ghost"},{default:n(()=>[s(N,{name:"Print"})]),_:2},1032,["href"])]),_:2},1032,["content"])])])]),_:1})):k("",!0)]),_:1},8,["data"])])}}},_t={class:"fct-orders-table-mobile-wrap"},mt={class:"fct-orders-table-mobile-header"},pt=["onClick"],ht=["title"],ft={class:"flex items-center gap-3"},vt=["onClick"],bt=["innerHTML"],yt=["innerHTML"],gt=["innerHTML"],kt={key:0,class:"fct-order-table-actions-col"},wt={class:"el-dropdown-link"},$t=["href"],Ct={key:0,class:"fct-orders-table-mobile-body"},xt={class:"fct-order-and-customer-info"},Tt={key:0,class:"fct-order-table-customer-col"},Ot={key:1},Mt={key:1,class:"fct-order-table-order-items-col"},St={class:"fct-popover-box"},It={class:"fct-popover-content"},Lt={class:"fct-product-orders-items is-scroll"},Dt={class:"variation-title"},Nt={key:0},Ht={class:"fct-popover-box-action"},Pt={key:0,class:"fct-order-count-text"},Vt={key:1,class:"fct-order-count-text"},Rt={class:"fct-popover-box-action-icon"},qt=["onClick"],At={class:"fct-status-and-order-type-wrap"},Bt={class:"fct-order-table-payment-status-col"},jt={class:"title"},Et={class:"fct-status-group"},Ft=["src","alt"],Ut={key:0,class:"fct-order-table-status-col"},zt={class:"title"},Wt={key:1,class:"fct-order-table-order-type-col"},Qt={class:"title"},Jt={class:"type"},Xt={class:"fct-orders-table-mobile-footer"},Gt={class:"fct-status-and-order-type-wrap"},Kt={class:"fct-order-table-order-items-col"},Yt={key:0,class:"title"},Zt=["innerHTML"],es=["innerHTML"],ts={key:0,class:"py-6 text-center"},yo={__name:"OrdersTableMobile",props:{orders:{type:Array,required:!0},emptyText:{type:String,required:!1,default:r("No orders found.")},columns:{type:Array,required:!1,default(){return["selection","customer","actions","status","order_items"]}},table:Object},setup(d){const h=d,_=U.get("site_url"),$=w=>h.columns.includes(w),O=w=>U.get("payment_logos."+w),c=w=>w?te.appendQueryParams(_,{"fluent-cart":"receipt",order_hash:w,download:1}):"",b=w=>w.filter(M=>M.payment_type!=="signup_fee"),x=w=>{switch(w){case"payment":return r("Payment");case"subscription":return r("Subscription");case"renewal":return r("Renewal");default:R.headline(w)}};return(w,M)=>{const p=v("el-dropdown-item"),D=v("el-dropdown-menu"),S=v("el-dropdown"),q=v("router-link"),l=v("el-popover"),f=v("el-tag");return t(),a("div",_t,[(t(!0),a(L,null,B(d.orders,(u,P)=>(t(),a("div",{key:u.id,class:"fct-orders-table-mobile-row"},[e("div",mt,[e("div",{class:"fct-order-table-date-col",onClick:y=>w.$router.push({name:"view_order",params:{order_id:u.id}})},[s(J,{class:"date","date-time":u.created_at,"with-time":!1},null,8,["date-time"]),M[0]||(M[0]=e("span",{class:"bullet"},"•",-1)),e("div",{title:i(r)("Order ID: %s",u.id),class:"invoice-no"},o(u.invoice_no),9,ht)],8,pt),e("div",ft,[e("div",{class:"fct-order-table-total-col",onClick:y=>w.$router.push({name:"view_order",params:{order_id:u.id}})},[parseInt(u.total_refund)?(t(),a(L,{key:1},[e("span",{class:"text-gray-700 line-through",innerHTML:i(F).formatNumber(u.total_amount,!0,!1,u.currency)},null,8,yt),u.payment_status!="refunded"?(t(),a("span",{key:0,class:"ml-1",innerHTML:i(F).formatNumber(parseInt(u.total_amount)-parseInt(u.total_refund),!0,!1,u.currency)},null,8,gt)):k("",!0)],64)):(t(),a("span",{key:0,innerHTML:i(F).formatNumber(u.total_amount,!0,!1,u.currency)},null,8,bt))],8,vt),$("actions")?(t(),a("div",kt,[s(S,{trigger:"click","popper-class":"fct-dropdown"},{dropdown:n(()=>[s(D,null,{default:n(()=>[s(p,{class:"item-link"},{default:n(()=>[e("a",{target:"_blank",href:c(u.uuid)},[s(N,{name:"Print"}),T(" "+o(i(r)("View Invoice")),1)],8,$t)]),_:2},1024)]),_:2},1024)]),default:n(()=>[e("span",wt,[s(N,{name:"More",class:"w-1"})])]),_:2},1024)])):k("",!0)])]),$("customer")||$("order_items")?(t(),a("div",Ct,[e("div",xt,[$("customer")?(t(),a("div",Tt,[u.customer?(t(),C(X,{key:0,customer:u.customer,"to-route":{name:"view_order",params:{order_id:u.id}}},null,8,["customer","to-route"])):(t(),a("span",Ot,o(i(r)("Customer Not Found")),1))])):k("",!0),$("order_items")?(t(),a("div",Mt,[e("div",St,[s(l,{placement:"bottom-start",width:360,trigger:"click"},{reference:n(()=>{var y;return[e("div",Ht,[b(u.order_items).length===1?(t(),a("span",Pt,o((y=b(u.order_items)[0])==null?void 0:y.post_title),1)):(t(),a("span",Vt,o(b(u.order_items).length)+" "+o(w.$t("items")),1)),e("div",Rt,[s(N,{name:"ChevronDown"})])])]}),default:n(()=>[e("div",It,[e("div",Lt,[(t(!0),a(L,null,B(b(u.order_items),y=>(t(),a("p",{key:y.id},[s(q,{class:"title",to:{name:"product_edit",params:{product_id:y==null?void 0:y.post_id}}},{default:n(()=>[T(o(y.post_title),1)]),_:2},1032,["to"]),e("span",Dt,[e("b",null,o(y.quantity),1),T(" x "+o(y.title),1)])]))),128)),b(u.order_items).length===0?(t(),a("p",Nt,o(i(r)("No products found!")),1)):k("",!0)])])]),_:2},1024)])])):k("",!0)])])):k("",!0),e("div",{class:"fct-orders-table-mobile-footer",onClick:y=>w.$router.push({name:"view_order",params:{order_id:u.id}})},[e("div",At,[e("div",Bt,[e("div",jt,o(i(r)("Payment Status")),1),e("div",Et,[s(j,{status:u.payment_status,"hide-icon":!0},null,8,["status"]),O(u.payment_method)?(t(),a("span",{key:0,class:K(["img",u.payment_method])},[e("img",{src:O(u.payment_method),alt:i(R).headline(u.payment_method)},null,8,Ft)],2)):(t(),C(f,{key:1,type:"info",round:"",size:"small",class:"capitalize"},{default:n(()=>[T(o(i(R).headline(u.payment_method)),1)]),_:2},1024))])]),$("status")?(t(),a("div",Ut,[e("div",zt,o(i(r)("Status")),1),(t(),C(j,{status:u.status,"hide-icon":!0,key:u.id},null,8,["status"]))])):k("",!0),$("type")?(t(),a("div",Wt,[e("div",Qt,o(i(r)("Order Type")),1),e("span",Jt,o(x(u.type)),1),s(se,{order:u},null,8,["order"])])):k("",!0)])],8,qt),e("div",Xt,[e("div",Gt,[d.table?(t(!0),a(L,{key:0},B(d.table.getCustomColumns(),y=>(t(),a("div",Kt,[y.label?(t(),a("div",Yt,o(y.label),1)):k("",!0),y.render_template?(t(),C(Z(le),{key:1,templateContent:y.template,data:y,column:y,row:u},null,8,["templateContent","data","column","row"])):(t(),a(L,{key:2},[y.as_link!==!1?(t(),C(H,{key:0,class:"hover:no-underline",to:{name:"view_order",params:{order_id:u.id}}},{default:n(()=>[e("div",{innerHTML:i(W).get(u,y.accessor)},null,8,Zt)]),_:2},1032,["to"])):(t(),a("div",{key:1,innerHTML:i(W).get(u,y.accessor)},null,8,es))],64))]))),256)):k("",!0)])])]))),128)),d.orders.length===0?(t(),a("div",ts,[s(Q,{icon:"Empty/Order","has-dark":"",text:d.emptyText},null,8,["text"])])):k("",!0)])}}},ss={key:0,class:"text"},os={class:"font-medium"},ns=["innerHTML"],ls={class:"purchase-values"},rs=["innerHTML"],as={key:1},is=["innerHTML"],cs={key:1,class:"text"},go={__name:"CustomerPurchaseValue",props:{value:{type:[Object,String],required:!0}},setup(d){const h=d,_=G(()=>{if(typeof h.value=="string")try{return JSON.parse(h.value)}catch{return{}}return h.value&&typeof h.value=="object"?h.value:{}}),$=G(()=>{const c=Object.entries(_.value||{});if(!c.length)return{currency:"",value:0};const[b,x]=c[0];return{currency:b,value:x}}),O=G(()=>Object.entries(_.value||{}).slice(1).map(([b,x])=>({currency:b,value:x})));return(c,b)=>{const x=v("el-popover");return Object.keys(_.value).length?(t(),a("span",ss,[O.value.length?(t(),C(x,{key:0,placement:"bottom",trigger:"hover","popper-class":"fct-popover"},{reference:n(()=>[e("span",os,[e("span",{innerHTML:c.formatNumber($.value.value,!0,!1,$.value.currency)},null,8,ns),T(" +"+o(O.value.length),1)])]),default:n(()=>[e("div",ls,[(t(!0),a(L,null,B(O.value,(w,M)=>(t(),a("div",{key:w.currency,class:"purchase-value-item"},[e("span",{innerHTML:c.formatNumber(w.value,!0,!1,w.currency)},null,8,rs)]))),128))])]),_:1})):(t(),a("span",as,[e("span",{innerHTML:c.formatNumber($.value.value,!0,!1,$.value.currency)},null,8,is)])),T(" "+o(i(r)("Lifetime Value")),1)])):(t(),a("span",cs,o(i(r)("Lifetime Value"))+": "+o(i(r)("No Data")),1))}}},ds={name:"SubscriptionsTable",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:J,RouteCell:H,Badge:j,DynamicIcon:N,ArrowDown:oe,Empty:Q,CustomerInfoPopover:X},computed:{Str(){return R}},methods:{translate:r,translateNumber:r,subscriptionStatus(d){return d==null?void 0:d.status}}},us={class:"fct-subscriptions-table-wrap"},_s={key:1},ms={class:"truncate"},ps=["innerHTML"];function hs(d,h,_,$,O,c){const b=v("RouteCell"),x=v("el-table-column"),w=v("CustomerInfoPopover"),M=v("Badge"),p=v("ConvertedTime"),D=v("router-link"),S=v("Empty"),q=v("el-table");return t(),a("div",us,[s(q,{data:_.subscriptions,class:"w-full compact-table","tooltip-options":{popperClass:"fct-tooltip-long"}},{empty:n(()=>[s(S,{icon:"Empty/ListView","has-dark":!0,text:c.translate("No subscriptions found.")},null,8,["text"])]),default:n(()=>[s(x,{fixed:"",label:c.translate("ID"),width:"100"},{default:n(l=>{var f;return[s(b,{class:"link block",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[T(" #"+o(c.translateNumber(l.row.id)),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),_.columns.indexOf("customer")!==-1?(t(),C(x,{key:0,label:c.translate("Customer"),width:150},{default:n(l=>{var f;return[l.row.customer?(t(),C(w,{key:0,customer:l.row.customer,"to-route":{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},null,8,["customer","to-route"])):(t(),a("span",_s,o(c.translate("Customer Not Found")),1))]}),_:1},8,["label"])):k("",!0),s(x,{label:c.translate("Product"),width:"360","show-overflow-tooltip":""},{default:n(l=>{var f;return[s(b,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[e("div",ms,o(l.row.item_name),1)]),_:2},1032,["to"])]}),_:1},8,["label"]),s(x,{label:c.translate("Status"),width:"120"},{default:n(l=>{var f;return[s(b,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[(t(),C(M,{status:c.subscriptionStatus(l.row),key:l.row.id,size:"small","hide-icon":!0},null,8,["status"]))]),_:2},1032,["to"])]}),_:1},8,["label"]),s(x,{label:c.translate("Billing"),width:"230"},{default:n(l=>{var f;return[s(b,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[e("span",{innerHTML:l.row.payment_info},null,8,ps)]),_:2},1032,["to"])]}),_:1},8,["label"]),s(x,{label:c.translate("Created At"),width:"130"},{default:n(l=>{var f;return[s(b,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[s(p,{"date-time":l.row.created_at,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"]),_.columns.indexOf("next_billing_date")!==-1?(t(),C(x,{key:1,label:c.translate("Next Billing Date"),width:"160"},{default:n(l=>{var f;return[s(b,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[s(p,{"date-time":l.row.next_billing_date,"with-time":!1},null,8,["date-time"])]),_:2},1032,["to"])]}),_:1},8,["label"])):k("",!0),_.columns.indexOf("collection_method")!==-1?(t(),C(x,{key:2,label:c.translate("Collection Method"),width:"160"},{default:n(l=>{var f;return[s(b,{class:"link block hover:no-underline",to:{name:"view_subscription",params:{subscription_id:(f=l.row)==null?void 0:f.id}}},{default:n(()=>[T(o(l.row.collection_method),1)]),_:2},1032,["to"])]}),_:1},8,["label"])):k("",!0),_.columns.indexOf("bills_count")!==-1?(t(),C(x,{key:3,label:c.translate("Bills Count"),width:"100"},{default:n(l=>[T(o(l.row.bill_count),1)]),_:1},8,["label"])):k("",!0),_.columns.indexOf("payment_method")!==-1?(t(),C(x,{key:4,label:c.translate("Payment Method"),width:"150"},{default:n(l=>[T(o(l.row.current_payment_method?c.Str.headline(l.row.current_payment_method.trim().replace(/_/g,"-")):"-"),1)]),_:1},8,["label"])):k("",!0),_.columns.indexOf("order_id")!==-1?(t(),C(x,{key:5,label:c.translate("Order ID"),width:"100"},{default:n(l=>[s(D,{class:"link",to:{name:"view_order",params:{order_id:l.row.parent_order_id}}},{default:n(()=>[T(" #"+o(l.row.parent_order_id),1)]),_:2},1032,["to"])]),_:1},8,["label"])):k("",!0)]),_:1},8,["data"])])}const ko=ne(ds,[["render",hs]]),fs={name:"SubscriptionsTableMobile",emits:["fetch"],props:{subscriptions:{type:Array,required:!0},columns:{type:Array,required:!1,default(){return["customer","next_billing_date","collection_method","bills_count","payment_method","valid_till"]}}},components:{ConvertedTime:J,RouteCell:H,Badge:j,DynamicIcon:N,ArrowDown:oe,Empty:Q,CustomerInfoPopover:X},computed:{Str(){return R}},methods:{translate:r,subscriptionStatus(d){return d==null?void 0:d.status}}},vs={class:"fct-table-mobile-wrap fct-subscriptions-table-mobile-wrap"},bs=["onClick"],ys={class:"fct-table-mobile-header-left"},gs={class:"fct-table-status-col"},ks={class:"fct-table-id-col"},ws={class:"id"},$s={class:"fct-table-mobile-body"},Cs={key:0,class:"fct-table-customer-col"},xs=["onClick"],Ts={class:"fct-table-product-col"},Os={class:"product-name"},Ms={class:"fct-table-billing-col"},Ss={class:"title"},Is=["innerHTML"],Ls={class:"fct-table-mobile-footer"},Ds={class:"fct-table-mobile-footer-row cols-3"},Ns=["onClick"],Hs={class:"title"},Ps=["onClick"],Vs={class:"title"},Rs=["onClick"],qs={class:"title"},As={class:"value"},Bs=["onClick"],js={class:"title"},Es={class:"value"},Fs=["onClick"],Us={class:"title"},zs={class:"value"},Ws=["onClick"],Qs={class:"title"},Js={class:"value"},Xs={key:0,class:"py-6 text-center"};function Gs(d,h,_,$,O,c){const b=v("Badge"),x=v("CustomerInfoPopover"),w=v("ConvertedTime"),M=v("Empty");return t(),a("div",vs,[(t(!0),a(L,null,B(_.subscriptions,(p,D)=>(t(),a("div",{key:p.id,class:"fct-table-mobile-row"},[e("div",{class:"fct-table-mobile-header",onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",ys,[e("div",gs,[(t(),C(b,{status:c.subscriptionStatus(p),key:p.id},null,8,["status"]))]),e("div",ks,[e("div",ws,"#"+o(p.id),1)])])],8,bs),e("div",$s,[_.columns.indexOf("customer")!==-1?(t(),a("div",Cs,[s(x,{customer:p.customer,"to-route":{name:"view_subscription",params:{subscription_id:p==null?void 0:p.id}}},null,8,["customer","to-route"])])):k("",!0),e("div",{onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Ts,[e("div",Os,o(p.item_name),1)]),e("div",Ms,[e("div",Ss,o(c.translate("Billing:")),1),e("span",{innerHTML:p.payment_info},null,8,Is)])],8,xs)]),e("div",Ls,[e("div",Ds,[e("div",{class:"fct-table-created-at-col",onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Hs,o(c.translate("Created At")),1),s(w,{class:"value","date-time":p.created_at,"with-time":!1},null,8,["date-time"])],8,Ns),_.columns.indexOf("next_billing_date")!==-1?(t(),a("div",{key:0,class:"fct-table-next-bill-date-col",onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Vs,o(c.translate("Next Billing")),1),s(w,{class:"value","date-time":p.next_billing_date,"with-time":!1},null,8,["date-time"])],8,Ps)):k("",!0),_.columns.indexOf("bills_count")!==-1?(t(),a("div",{key:1,class:"fct-table-bill-count-col",onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",qs,o(c.translate("Bills Count")),1),e("div",As,o(p.bill_count),1)],8,Rs)):k("",!0),_.columns.indexOf("payment_method")!==-1?(t(),a("div",{key:2,class:"fct-table-payment-method-col",onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",js,o(c.translate("Payment Method")),1),e("div",Es,o(p.current_payment_method?c.Str.headline(p.current_payment_method.trim().replace(/_/g,"-")):"-"),1)],8,Bs)):k("",!0),_.columns.indexOf("order_id")!==-1?(t(),a("div",{key:3,class:"fct-table-order-id-col",onClick:S=>d.$router.push({name:"view_order",params:{order_id:p.parent_order_id}})},[e("div",Us,o(c.translate("Order ID")),1),e("div",zs,"#"+o(p.parent_order_id),1)],8,Fs)):k("",!0),_.columns.indexOf("collection_method")!==-1?(t(),a("div",{key:4,class:"fct-table-collection-method-col",onClick:S=>d.$router.push({name:"view_subscription",params:{subscription_id:p.id}})},[e("div",Qs,o(c.translate("Collection")),1),e("div",Js,o(p.collection_method),1)],8,Ws)):k("",!0)])])]))),128)),_.subscriptions.length===0?(t(),a("div",Xs,[s(M,{icon:"Empty/ListView","has-dark":"",text:c.translate("No subscriptions found.")},null,8,["text"])])):k("",!0)])}const wo=ne(fs,[["render",Gs]]),Ks={class:"dialog-footer"},Ys={name:"CancelSubscription",props:["subscription","orderId","modelValue"],data(){return{cancelReason:"customer_request",cancelling:!1,otherReason:""}},computed:{updatedModelValue:{get(){return this.modelValue},set(d){this.modelValue=d}},otherReasonError(){return this.cancelReason==="other"&&this.otherReason.trim()===""?r("Please enter a reason"):""}},methods:{cancelSubscription(){if(this.cancelling=!0,this.cancelReason==="other"){if(this.otherReason.trim()===""){this.$notify.error(r("Please enter a reason")),this.cancelling=!1;return}this.cancelReason=this.otherReason}this.$put(`orders/${this.orderId}/subscriptions/${this.subscription.id}/cancel`,{cancel_reason:this.cancelReason}).then(d=>{this.cancelling=!0,this.$notify({type:"success",title:r("Success"),message:r("Subscription canceled successfully")}),this.$emit("reload")}).catch(d=>{var h;this.cancelling=!0,d.status_code=="422"?z.validationErrors(d):z.error((h=d.data)==null?void 0:h.message)}).finally(()=>{this.cancelling=!0,this.cancelSubscriptionModal=!1})}}},$o=Object.assign(Ys,{setup(d){return(h,_)=>{const $=v("el-option"),O=v("el-select"),c=v("el-form-item"),b=v("el-input"),x=v("el-form"),w=v("el-button"),M=v("el-dialog");return t(),C(M,{"model-value":h.updatedModelValue,loading:h.cancelling,title:i(r)("Cancel Subscription"),width:"500"},{footer:n(()=>[e("div",Ks,[s(w,{onClick:_[2]||(_[2]=p=>h.$emit("close"))},{default:n(()=>[T(o(i(r)("Cancel")),1)]),_:1}),s(w,{loading:h.cancelling,type:"warning",onClick:h.cancelSubscription},{default:n(()=>[T(o(i(r)("Cancel Subscription")),1)]),_:1},8,["loading","onClick"])])]),default:n(()=>[s(x,{"label-position":"top"},{default:n(()=>[e("div",null,o(i(r)("Are you sure to cancel the subscription?")),1),_[3]||(_[3]=e("br",null,null,-1)),s(c,{label:i(r)("Cancellation reason"),required:""},{default:n(()=>[s(O,{modelValue:h.cancelReason,"onUpdate:modelValue":_[0]||(_[0]=p=>h.cancelReason=p)},{default:n(()=>[s($,{label:i(r)("Refunded"),value:"refunded"},null,8,["label"]),s($,{label:i(r)("Customer request"),value:"customer_request"},null,8,["label"]),s($,{label:i(r)("Completed (EOT)"),value:"completed"},null,8,["label"]),s($,{label:i(r)("Fraudulent"),value:"fraudulent"},null,8,["label"]),s($,{label:i(r)("Other"),value:"other"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),h.cancelReason==="other"?(t(),C(c,{key:0,label:i(r)("Other Reason"),required:"",error:h.otherReasonError},{default:n(()=>[s(b,{modelValue:h.otherReason,"onUpdate:modelValue":_[1]||(_[1]=p=>h.otherReason=p)},null,8,["modelValue"])]),_:1},8,["label","error"])):k("",!0)]),_:1,__:[3]})]),_:1},8,["model-value","loading","title"])}}});export{wo as S,J as _,bo as a,yo as b,go as c,ko as d,$o as e,le as f};
