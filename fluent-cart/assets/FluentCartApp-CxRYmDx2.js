var B=s=>{throw TypeError(s)};var H=(s,t,e)=>t.has(s)||B("Cannot "+e);var i=(s,t,e)=>(H(s,t,"read from private field"),e?e.call(s):t.get(s)),g=(s,t,e)=>t.has(s)?B("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,e),_=(s,t,e,a)=>(H(s,t,"write to private field"),a?a.call(s,e):t.set(s,e),e),f=(s,t,e)=>(H(s,t,"access private method"),e);class N{constructor(t={}){this.storageKey=t.storageKey||"fc_utm_data",this.expirationDays=t.expirationDays||30,this.utmKeys=t.utmKeys||N.getUtmParams(),this.collectFromURL()}collectFromURL(){const t=this.getURLParams();document.referrer&&new URL(document.referrer).hostname!==window.location.hostname&&(t.refer_url=document.referrer),Object.keys(t).length>0&&this.store(t)}getURLParams(){const t=new URLSearchParams(window.location.search),e={};return this.utmKeys.forEach(a=>{const r=t.get(a);r&&(e[a]=r)}),e}store(t){const e=this.getStoredData(),a=Date.now(),l={params:{...e.params,...t},timestamp:a};try{localStorage.setItem(this.storageKey,JSON.stringify(l))}catch{}}getStoredData(){try{const t=localStorage.getItem(this.storageKey);if(t){let e=JSON.parse(t);if(e&&e.timestamp)return e}}catch{}return{params:{},timestamp:null}}get(){return this.getStoredData().params||{}}clear(){try{localStorage.removeItem(this.storageKey)}catch(t){console.warn("UTMManager: Unable to clear localStorage",t)}}static getUtmParams(){return window.fluentcart_utm_vars.allowed_keys||["utm_source","utm_medium","utm_campaign","utm_term","utm_content","utm_id"]}}var K,J,C,p,D,A,O,P,R,v,E,M,o,T,F,Q,W,$,x,Y,z,Z,tt;const L=class L{constructor(){g(this,o);g(this,p,[]);g(this,D,"?action=fluent_cart_checkout_routes&fc_checkout_action=fluent_cart_cart_status");g(this,A,"?action=fluent_cart_checkout_routes&fc_checkout_action=fluent_cart_cart_update");g(this,O,window.fluentCartRestVars.ajaxurl);g(this,P,!1);g(this,R,(K=window.fluentcart_drawer_vars)==null?void 0:K.is_admin_bar_showing);g(this,v,"open");g(this,E,"active");g(this,M,((J=window.fluentcart_drawer_vars)==null?void 0:J.is_drawer_hidden)=="1")}init(){return i(L,C)!==null?i(L,C):(_(L,C,this),f(this,o,tt).call(this),i(this,M)||f(this,o,Z).call(this),f(this,o,z).call(this),f(this,o,F).call(this),f(this,o,Q).call(this),f(this,o,W).call(this),f(this,o,$).call(this),this)}async getCart(){let t=await new Promise((e,a)=>{fetch(i(this,O)+i(this,D),{method:"GET",headers:{"Content-Type":"application/json"}}).then(r=>{if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}).then(r=>{r&&r.cart_data?e(r.cart_data):e([])}).catch(r=>{a([])})});return _(this,p,t),window.dispatchEvent(new Event("fluentCartNotifyCartDrawerItemChanged")),t}async addProduct(t,e=1,a=!1,r=!1){return f(this,o,T).call(this,t,e,a,r)}async removeProduct(t,e=!1){return t=t.toString(),await f(this,o,T).call(this,t,0,!1,e)}async incrementProduct(t,e=1){const a=document.querySelector("[data-fluent-cart-cart-drawer-overlay]");return a&&a.classList.contains("active")&&_(this,P,!0),t=t.toString(),e=Math.abs(parseInt(e.toString())),await f(this,o,T).call(this,t,e)}async decrementProduct(t,e=1){const a=document.querySelector("[data-fluent-cart-cart-drawer-overlay]");return a&&a.classList.contains("active")&&_(this,P,!0),t=t.toString(),e=Math.abs(parseInt(e.toString())),await f(this,o,T).call(this,t,e*-1)}async updateProductQuantity(t,e=1,a=!1){return e=parseInt(e.toString(),10),(isNaN(e)||e<1)&&(e=1),t=t.toString(),await f(this,o,T).call(this,t,e,a)}closeModal(){const t=document.querySelector("[data-fluent-cart-cart-drawer-overlay]"),e=document.querySelector("[data-fluent-cart-cart-drawer]"),a=document.body;t&&t.classList.remove(i(this,E)),e&&e.classList.remove(i(this,v)),a.style.overflow=""}openModal(){const t=document.querySelector("[data-fluent-cart-cart-drawer-overlay]"),e=document.querySelector("[data-fluent-cart-cart-drawer]"),a=document.body;t&&t.classList.add(i(this,E)),e&&e.classList.add(i(this,v)),a.style.overflow="hidden"}appendUtmSource(t){const e=new URLSearchParams(window.location.search);return N.getUtmParams().forEach(a=>{e.has(a)&&(t[a]=e.get(a))}),t}getState(){return i(this,p)}};C=new WeakMap,p=new WeakMap,D=new WeakMap,A=new WeakMap,O=new WeakMap,P=new WeakMap,R=new WeakMap,v=new WeakMap,E=new WeakMap,M=new WeakMap,o=new WeakSet,T=async function(t=null,e=1,a=!1,r=!1){if(t==null)return;const l=document.querySelector("[data-fluent-cart-cart-drawer]");let n="";l&&(n=l.querySelector("[data-fluent-cart-cart-drawer-loader]"),n&&n.classList.add("show"));let h={item_id:t,quantity:e};a&&(h.by_input=!0),(i(this,P)||r||a)&&(h.open_cart=!0),h.is_admin_bar_enabled=i(this,R),h=this.appendUtmSource(h);let y=await new Promise((d,b)=>{const u=new URL(i(this,O)+i(this,A));Object.entries(h).forEach(([w,q])=>{u.searchParams.append(w,q)});const m=new XMLHttpRequest;m.open("GET",u.toString(),!0),m.setRequestHeader("Content-Type","application/json"),m.setRequestHeader("X-WP-Nonce",window.fluentCartRestVars.rest.nonce),m.onreadystatechange=function(){var w,q;if(m.readyState===XMLHttpRequest.DONE)try{if(m.status>=200&&m.status<300){const c=JSON.parse(m.responseText);if(c&&(c!=null&&c.fragments)&&c.fragments)if(Array.isArray(c.fragments))c.fragments.forEach(S=>{const k=document.querySelector(S.selector);!k&&S.selector==="[data-fluent-cart-cart-drawer-container]"&&document.body.insertAdjacentHTML("beforeend",S.content),k&&S.type==="replace"&&(k.outerHTML=S.content)});else{const S=document.querySelector(c.fragments.selector);!S&&c.fragments.selector==="[data-fluent-cart-cart-drawer-container]"&&document.body.insertAdjacentHTML("beforeend",c.fragments.content),S&&c.fragments.type==="replace"&&(S.outerHTML=c.fragments.content)}c&&((q=(w=c==null?void 0:c.data)==null?void 0:w.cart)!=null&&q.cart_data)?d(c.data.cart.cart_data):(c.message&&new Toastify({text:c.message,className:"warning",duration:3e3,gravity:"top",position:"right",slideFrom:"right",type:"warning"}).showToast(),d([])),n&&n.classList.remove("show")}else{const c=m.responseText&&JSON.parse(m.responseText).message||"An error occurred";new Toastify({text:c,className:"info",duration:2e3,style:{background:"#eabe11"}}).showToast(),n&&n.classList.remove("show"),b(new Error(c))}}catch(c){c.message&&new Toastify({text:c.message,className:"info",duration:2e3,style:{background:"#eabe11"}}).showToast(),n&&n.classList.remove("show"),b(c)}},m.send()});return y.length,_(this,p,y),new URLSearchParams(window.location.search).has("fct_cart_hash")||window.dispatchEvent(new CustomEvent("fluentCartNotifyCartDrawerItemChanged",{detail:{response:y}})),y},F=function(){const t=this;document.addEventListener("click",async function(e){var r;const a=e.target.closest("[data-fluent-cart-cart-list-item-delete-button]");if(a){const l=a.dataset.itemId,n=await t.removeProduct(l,!0);n!=null&&(_(t,p,n),f(r=t,o,x).call(r))}})},Q=function(){const t=this;document.addEventListener("click",async function(e){var r;const a=e.target.closest("[data-fluent-cart-cart-list-item-increase-button]");if(a){const l=a.dataset.itemId,n=await t.incrementProduct(l);n!=null&&(_(t,p,n),f(r=t,o,x).call(r))}})},W=function(){const t=this;document.addEventListener("click",async function(e){var r;const a=e.target.closest("[data-fluent-cart-cart-list-item-decrease-button]");if(a){const l=a.dataset.itemId,n=await t.decrementProduct(l);n!=null&&(_(t,p,n),f(r=t,o,x).call(r))}})},$=function(){const t=this;document.addEventListener("change",async function(e){var r;const a=e.target.closest("[data-fluent-cart-cart-list-item-quantity-input]");if(a){const l=a.dataset.itemId;let n=parseInt(event.target.value,10);parseInt(event.target.dataset.oldValue||"0",10),n<1&&(n=1);let h=n;const y=await t.updateProductQuantity(l,h,!0);y!=null&&(_(t,p,y),f(r=t,o,x).call(r))}})},x=function(){if(f(this,o,Y).call(this)){const t=document.querySelectorAll("[data-fluent-cart-cart-total-item]"),e=document.querySelectorAll("[data-fluent-cart-checkout-page-cart-item-count]"),a=document.querySelectorAll("[data-fluent-cart-cart-total-wrapper]"),r=document.querySelectorAll("[data-fluent-cart-cart-expand-button]"),l=document.querySelectorAll("[data-fluent-cart-cart-checkout-button-wrap]");t&&t.forEach(n=>n.textContent="0"),e&&e.forEach(n=>n.textContent="0"),a&&a.forEach(n=>n.style.display="none"),l&&l.forEach(n=>n.style.display="none"),r&&r.forEach(n=>n.classList.add("is-hidden")),setTimeout(()=>{this.closeModal()},300)}},Y=function(){return i(this,p)===void 0||i(this,p)==null||Object.keys(i(this,p)).length===0},z=function(){const t=this;document.addEventListener("click",function(e){const a=document.querySelector("[data-fluent-cart-cart-drawer-overlay]");a&&a.contains(e.target)&&t.closeModal()})},Z=function(){const t=this,e=document.body;document.addEventListener("click",a=>{document.querySelector("[data-fluent-cart-cart-drawer-container]");const r=document.querySelector("[data-fluent-cart-cart-drawer]"),l=document.querySelector("[data-fluent-cart-cart-drawer-overlay]"),n=a.target.closest("[data-fluent-cart-cart-toggle-button]"),h=a.target.closest("[data-fluent-cart-cart-expand-button], .fcart-cart-toggle-button"),y=a.target.closest("[data-fluent-cart-cart-collapse-button]");if(n){r&&r.classList.toggle(i(t,v));return}if(h){r&&r.classList.add(i(t,v)),l&&l.classList.add(i(t,E)),e.style.overflow="hidden";return}if(y){r&&r.classList.remove(i(t,v)),l&&l.classList.remove(i(t,E)),e.style.overflow="";return}})},tt=function(){const t=document.querySelector(".fluent-cart-menu-cart-open-button-container");if(t){const e=t.closest("li"),a=e==null?void 0:e.previousElementSibling;if(a&&e){const r=a.cloneNode(!0);r.removeAttribute("id"),r.innerHTML="",r.appendChild(t.cloneNode(!0)),e.parentNode.replaceChild(r,e)}}},g(L,C,null);let j=L;var V,X,G;const et={...((V=window.fluentcart_checkout_vars)==null?void 0:V.trans)||{},...((X=window.fluentcart_checkout_vars)==null?void 0:X.payments_trans)||{},...((G=window.fluentcart_shop_vars)==null?void 0:G.trans)||{}};window.fluentcart={$t:function(s){return et[s]||s}};const I=function(s,t={},e){const a=`${window.fluentCartRestVars.ajaxurl}`,r=new AbortController,l=r.signal,n={"X-WP-Nonce":window.fluentCartRestVars.rest.nonce};["PUT","PATCH","DELETE"].indexOf(s.toUpperCase())!==-1&&(n["X-HTTP-Method-Override"]=s,s="POST"),t.query_timestamp=Date.now();const h=new Promise((y,U)=>{const d=new XMLHttpRequest;let b=a;if(s.toUpperCase()==="GET"){let u={};Object.keys(t).forEach(w=>{t[w]===null||t[w]===!1?delete t[w]:typeof t[w]=="object"?u=Object.assign(u,recursiveFlatten(t[w],w)):u[w]=t[w]});let m=new URLSearchParams(u).toString();b.indexOf("?")!==-1?b+="&"+m:b+="?"+m}d.open(s,b,!0),l.addEventListener("abort",()=>{d.abort(),U({aborted:!0,message:"Request aborted"})}),Object.keys(n).forEach(u=>{d.setRequestHeader(u,n[u])}),d.onload=function(){let u;try{u=JSON.parse(d.responseText)}catch{u=null}this.status>=200&&this.status<300?y(u):(u&&(typeof u=="object"&&(u.xhr_status=d.status),u.code=="rest_cookie_invalid_nonce"&&document.dispatchEvent(new CustomEvent("fcart_renew_rest_nonce",{detail:u}))),U(u))},d.onerror=function(){console.info("Your server firewall blocked the request or it's a plugin conflict. Please check the detailed error."),console.log({status:d.status,statusText:d.statusText,responseText:d.responseText}),U({status:d.status,statusText:d.statusText})},s.toUpperCase()==="GET"?d.send():(d.setRequestHeader("Content-Type","application/json;charset=UTF-8"),d.send(JSON.stringify(t)))});return e?{request:h,controller:r}:h};document.addEventListener("DOMContentLoaded",function(){window.fluentCartCart=new j().init(),window.fluentCartUtmManager=new N,window.fluentCartAjax={get:function(s={},t=!1){return I("GET",s,t)},post:function(s={}){return I("POST",s,cancelable)}},window.fluentcart.ajax=window.fluentCartAjax,window.dispatchEvent(new CustomEvent("fluent_cart_app_loaded",{}))});
