var qt=Object.defineProperty;var st=c=>{throw TypeError(c)};var Tt=(c,e,t)=>e in c?qt(c,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[e]=t;var It=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports);var h=(c,e,t)=>Tt(c,typeof e!="symbol"?e+"":e,t),Pe=(c,e,t)=>e.has(c)||st("Cannot "+t);var d=(c,e,t)=>(Pe(c,e,"read from private field"),t?t.call(c):e.get(c)),g=(c,e,t)=>e.has(c)?st("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(c):e.set(c,t),y=(c,e,t,i)=>(Pe(c,e,"write to private field"),i?i.call(c,t):e.set(c,t),t),p=(c,e,t)=>(Pe(c,e,"access private method"),t);import{C as v,P as At}from"./payment-loader-rBHbdlEj.js";import{U as z}from"./Url-D4lOoZOf.js";import{u as Je,t as Ye}from"./timezone-C2U15obx.js";import{d as I}from"./dayjs.min-2rai63wT.js";import"./Str-Ckn63bs5.js";import"./vue.esm-bundler-DZdE0M9V.js";import"./Arr-MwYQQ3qa.js";var Vt=It((Xt,Ce)=>{class Dt{constructor(e,t={}){this.element=e,this.disabled=!1;const i=this.parseSelectElement();this.options=t.options||i||[];const s=t.placeholder===!1;this.searchPlaceholder="",this.placeholder="",s||(this.placeholder=t.placeholder||this.getPlaceholderFromSelect()||"Select an option...",this.searchPlaceholder=t.searchPlaceholder||"Type to search..."),this.clearable=t.clearable!==!1,this.onChange=t.onChange||(()=>{}),this.onSearch=t.onSearch||(()=>{});const n=this.getInitialSelection();this.selectedValue=n.value,this.selectedText=n.text,this.filteredOptions=[...this.options],this.highlightedIndex=-1,this.isOpen=!1,this.searchTerm="",this.init()}init(){this.createElements(),this.bindEvents(),this.render(),this.selectedValue&&(this.input.value=this.selectedText)}parseSelectElement(){if(this.element.tagName!=="SELECT")return null;const e=[];return this.element.querySelectorAll("option").forEach(i=>{(i.value||i.textContent.trim())&&e.push({value:i.value||i.textContent.trim(),text:i.textContent.trim()})}),e}getPlaceholderFromSelect(){if(this.element.tagName!=="SELECT")return null;if(this.element.hasAttribute("data-placeholder"))return this.element.getAttribute("data-placeholder");const e=this.element.querySelector("option");return e&&!e.value&&e.textContent.trim()?e.textContent.trim():null}getInitialSelection(){if(this.element.tagName!=="SELECT")return{value:null,text:""};const e=this.element.querySelector("option[selected]")||this.element.options[this.element.selectedIndex];return e&&e.value?{value:e.value,text:e.textContent.trim()}:{value:null,text:""}}createElements(){const e=this.element.tagName==="SELECT";let t,i=e&&this.element.parentNode.classList.contains("fct-custom-searchable-select"),s=null;if(i){t=this.element.parentNode;const n=t.querySelector(".fct-custom-searchable-select-container");n&&t.removeChild(n),s=t.querySelector("input")}else t=document.createElement("div"),t.className="fct-custom-searchable-select",e?(this.element.parentNode.insertBefore(t,this.element),t.appendChild(this.element)):(t.classList.add("custom-select-wrapper"),this.element.appendChild(t));e?(this.originalElement=this.element.cloneNode(!0),this.element.style.display="none"):this.originalElement=null,this.selectContainer=document.createElement("div"),this.selectContainer.className="fct-custom-searchable-select-container",this.input=document.createElement("input"),this.input.className="select-input",this.input.type="text",this.input.placeholder=this.placeholder+"*",this.input.addEventListener("keypress",n=>{this.isOpen||n.preventDefault()}),this.originalElement&&(this.originalElement.disabled&&this.disable(),this.originalElement.required&&(this.input.required=!0),this.originalElement.name&&(s?this.hiddenInput=s:(this.hiddenInput=document.createElement("input"),t.appendChild(this.hiddenInput)),this.hiddenInput.type="hidden",this.hiddenInput.name=this.originalElement.name)),this.arrow=document.createElement("div"),this.arrow.className="select-arrow",this.clearBtn=document.createElement("button"),this.clearBtn.className="clear-btn",this.clearBtn.innerHTML="×",this.clearBtn.type="button",this.dropdown=document.createElement("div"),this.dropdown.className="select-dropdown",this.selectContainer.appendChild(this.input),this.clearable&&this.selectContainer.appendChild(this.clearBtn),this.selectContainer.appendChild(this.arrow),this.selectContainer.appendChild(this.dropdown),t.appendChild(this.selectContainer),this.hiddenInput&&(this.hiddenInput.value=this.selectedValue||""),this.wrapper=t}bindEvents(){this.selectContainer.addEventListener("click",e=>{e.target!==this.clearBtn&&this.toggle()}),this.clearBtn.addEventListener("click",e=>{e.stopPropagation(),this.clear()}),this.input.addEventListener("focus",()=>{this.isOpen||this.open()}),this.input.addEventListener("input",e=>{this.searchTerm=e.target.value,this.filter(),this.onSearch(this.searchTerm)}),this.input.addEventListener("keydown",e=>{this.handleKeydown(e)}),this.dropdown.addEventListener("click",e=>{const t=e.target.closest(".select-option");if(t&&!t.classList.contains("no-options")){const i=t.dataset.value,s=t.textContent;this.select(i,s),this.close()}}),this.outsideClickHandler=e=>{this.element.contains(e.target)||this.close()},document.addEventListener("click",this.outsideClickHandler)}handleKeydown(e){switch(e.key){case"ArrowDown":e.preventDefault(),this.highlightNext();break;case"ArrowUp":e.preventDefault(),this.highlightPrev();break;case"Enter":if(e.preventDefault(),this.highlightedIndex>=0&&this.filteredOptions[this.highlightedIndex]){const t=this.filteredOptions[this.highlightedIndex];this.select(t.value,t.text)}break;case"Escape":this.close();break;case"Backspace":this.selectedValue&&this.clear();break}}open(){this.isOpen=!0,this.selectContainer.classList.add("open"),this.input.placeholder=this.searchPlaceholder,this.highlightedIndex=-1,this.input.value="",this.filter(),setTimeout(()=>this.input.focus(),0)}close(){this.isOpen=!1,this.selectContainer.classList.remove("open"),this.input.placeholder=this.placeholder,this.searchTerm="",this.input.value=this.selectedText,this.highlightedIndex=-1}toggle(){this.isOpen?this.close():this.open()}filter(){const e=this.searchTerm.toLowerCase();this.filteredOptions=this.options.filter(t=>t.text.toLowerCase().includes(e)),this.highlightedIndex=-1,this.renderOptions()}highlightNext(){this.filteredOptions.length!==0&&(this.highlightedIndex=Math.min(this.highlightedIndex+1,this.filteredOptions.length-1),this.updateHighlight())}highlightPrev(){this.filteredOptions.length!==0&&(this.highlightedIndex=Math.max(this.highlightedIndex-1,0),this.updateHighlight())}updateHighlight(){var t;const e=this.dropdown.querySelectorAll(".select-option:not(.no-options)");e.forEach((i,s)=>{i.classList.toggle("highlighted",s===this.highlightedIndex)}),this.highlightedIndex>=0&&((t=e[this.highlightedIndex])==null||t.scrollIntoView({block:"nearest"}))}select(e,t){this.selectedValue=e,this.selectedText=t,this.input.value=t,this.hiddenInput&&(this.hiddenInput.value=e||""),this.originalElement&&(this.originalElement.value=e||""),setTimeout(()=>{this.onChange(e,t),this.close()},10)}clear(){return this.select(null,""),this}addOption(e,t){const i={value:e,text:t};return this.options.push(i),(!this.isOpen||!this.searchTerm)&&this.filteredOptions.push(i),this.render(),this}removeOption(e){return this.options=this.options.filter(t=>t.value!==e),this.filteredOptions=this.filteredOptions.filter(t=>t.value!==e),this.selectedValue===e&&this.clear(),this.render(),this}setOptions(e,t=null,i=null){return(t||i)&&(i=i??"value",t=t??"text",e=e.map(s=>({value:s[i],text:s[t]}))),this.options=e||[],this.filteredOptions=[...this.options],this.selectedValue&&!this.options.find(s=>s.value===this.selectedValue)&&this.clear(),this.render(),this}getValue(){return this.selectedValue}getText(){return this.selectedText}getSelected(){return{value:this.selectedValue,text:this.selectedText}}setValue(e){const t=this.options.find(i=>i.value===e);return t?this.select(t.value,t.text):this.clear(),this}disable(){return this.input.disabled=!0,this.disabled=!0,this.selectContainer.classList.add("disabled"),this.element.classList.add("disabled"),this}enable(){return this.input.disabled=!1,this.disabled=!1,this.selectContainer.classList.remove("disabled"),this.element.classList.remove("disabled"),this}render(){this.renderOptions()}renderOptions(){if(this.dropdown.innerHTML="",this.filteredOptions.length===0){const e=document.createElement("div");e.className="select-option no-options",e.textContent=this.searchTerm?"No matches found":"No options available",this.dropdown.appendChild(e);return}this.filteredOptions.forEach((e,t)=>{const i=document.createElement("div");i.className="select-option",i.dataset.value=e.value,i.textContent=e.text,e.value===this.selectedValue&&i.classList.add("selected"),this.dropdown.appendChild(i)})}destroy(){document.removeEventListener("click",this.outsideClickHandler),this.element.innerHTML="",this.selectContainer.remove()}}const be={init:function(c,e={}){const t=typeof c=="string"?document.querySelector(c):c;if(!t)throw new Error("Element not found");return new Dt(t,e)}};typeof Ce<"u"&&Ce.exports?Ce.exports=be:typeof define=="function"&&define.amd?define(function(){return be}):window.customSelect=be;const G=(c,e,t={})=>{let i;e==="click"?i=MouseEvent:e==="change"?i=Event:e.includes("focus")?i=FocusEvent:i=UIEvent;const s=new i(e,{bubbles:!0,cancelable:!1,...t});c.dispatchEvent(s)},F=c=>G(c,"click"),Be=c=>G(c,"change"),Ot=c=>G(c,"focusin"),Nt=c=>G(c,"focusout"),Wt=c=>G(c,"modalopen"),Me=c=>G(c,"modalclose"),B=(c,e)=>c[e]!==void 0?c[e]:c.getAttribute(e),L=(c,e)=>c==null?void 0:c.classList.contains(e),C=(c,e)=>c==null?void 0:c.classList.add(e),_=(c,e)=>c==null?void 0:c.classList.remove(e),Pt={data:null,searchable:!0,showSelectedItems:!0,placeholder:"Select an option",searchtext:"Search",selectedtext:"selected",hideSelect:!0,onChange:null};var S,Ve,Ue,nt,at,rt,ot,lt,ct,He,dt,_e,ht;class W{constructor(e,t={}){g(this,S);if(!e)throw new Error("No element provided to NiceSelect");if(!(e instanceof Element))throw new Error("Invalid element provided to NiceSelect - must be a valid DOM element");const i=[];e.tagName==="SELECT"&&e.querySelectorAll("option").forEach(n=>{(n.value||n.textContent.trim())&&i.push({value:n.value||n.textContent.trim(),text:n.textContent.trim()})}),t.data==null&&(t.data=i),this.el=e,this.el._niceSelect=this,this.config={...Pt,...t},this.data=this.config.data,this.selectedOptions=[],this.placeholder=B(this.el,"placeholder")||this.config.placeholder,this.searchtext=B(this.el,"searchtext")||this.config.searchtext,this.selectedtext=B(this.el,"selectedtext")||this.config.selectedtext,this.dropdown=null,this.selectionList=null,this.multiple=B(this.el,"multiple"),this.disabled=B(this.el,"disabled"),this.onChange=this.config.onChange,p(this,S,Ve).call(this),p(this,S,rt).call(this)}_renderSelectedItems(){if(this.multiple){let e="";window.getComputedStyle(this.dropdown).width==="auto"||this.selectedOptions.length<2?(this.selectedOptions.forEach((t,i,s)=>{let n=t.data.text;i!==s.length-1&&(n+=", "),e+=`<span class="current">${n||this.placeholder}</span>`}),e=e||this.placeholder):e=`${this.selectedOptions.length} ${this.selectedtext}`,this.dropdown.querySelector(".multiple-options").innerHTML=e}else{const e=this.selectedOptions.length>0?this.selectedOptions[0].data.text:this.placeholder,t=this.dropdown.querySelector(".current");t.innerHTML=e,this.selectedOptions.length>0&&(!this.selectedOptions[0].data.value||this.selectedOptions[0].data.value==="")?t.classList.add("empty-value"):t.classList.remove("empty-value")}}setSelected(e){let t=null;for(let s=0;s<this.options.length;s++)if(this.options[s].data.value===e){t=this.options[s];break}const i=t==null?void 0:t.element;i&&(i.click(),_(this.dropdown,"open"))}_renderItems(){const e=this.dropdown.querySelector("ul");this.options.forEach(t=>{t.data.value!==""&&(this.multiple&&this.config.showSelectedItems&&this._multipleListAdd(t),e.appendChild(this._renderItem(t)))})}_renderItem(e){const t=document.createElement("li");if(t.innerHTML=e.data.text,e.data.extra!==void 0&&t.appendChild(this._renderItemExtra(e.data.extra)),e.attributes.optgroup)C(t,"optgroup");else{t.setAttribute("data-value",e.data.value);const i=["option"];e.attributes.selected&&i.push("selected"),e.attributes.disabled&&i.push("disabled"),t.classList.add(...i),t.addEventListener("click",s=>this._onDropdownItemClicked(e,s))}return e.element=t,t}_renderItemExtra(e){const t=document.createElement("span");return t.innerHTML=e,C(t,"extra"),t}update(e=""){var i;let t=this;e!=""&&(t=e.target._niceSelect),p(i=t,S,He).call(i)}disable(){this.disabled||(this.disabled=!0,C(this.dropdown,"disabled"))}enable(){this.disabled&&(this.disabled=!1,_(this.dropdown,"disabled"))}clear(){p(this,S,ct).call(this),this.selectedOptions=[],this._renderSelectedItems(),this.update(),Be(this.el)}destroy(){this.selectionList&&p(this,S,_e).call(this),this.dropdown&&(this.dropdown.remove(),this.el.classList.remove("hidden-select"))}focus(e=""){if(L(this.dropdown,"open")?this.multiple?e===this.dropdown.querySelector(".multiple-options")&&(_(this.dropdown,"open"),Me(this.el)):(_(this.dropdown,"open"),Me(this.el)):(C(this.dropdown,"open"),Wt(this.el)),L(this.dropdown,"open")){const i=this.dropdown.querySelector(".fct-nice-select-search");i&&(i.value="",i.focus());const s=this.dropdown.querySelector(".focus");s&&_(s,"focus");const n=this.dropdown.querySelector(".selected");n&&C(n,"focus"),this.dropdown.querySelectorAll("ul li").forEach(a=>a.style.display="")}else this.dropdown.focus()}_bindSearchEvent(){const e=this.dropdown.querySelector(".fct-nice-select-search");e&&(e.addEventListener("click",t=>t.stopPropagation()),e.addEventListener("input",t=>this._onSearchChanged(t)))}_onClicked(e){e.preventDefault(),this.focus(e.target)}_onDropdownItemClicked(e,t){const i=t.target;if(!L(i,"disabled")){if(this.multiple){let s;L(i,"selected")?(s=!1,_(i,"selected"),this.selectedOptions=this.selectedOptions.filter(n=>n.data!==e.data)):(s=!0,C(i,"selected"),this.selectedOptions.push(e)),e.data.selected=s,e.attributes.selected=s}else{this.dropdown.querySelectorAll("li.selected").forEach(n=>_(n,"selected")),C(i,"selected"),this.selectedOptions=[e];let s=this.options.find(n=>n.attributes.selected);s&&(s.data.selected=!1,s.attributes.selected=!1),e.data.selected=!0,e.attributes.selected=!0}this._renderSelectedItems(),p(this,S,lt).call(this),p(this,S,dt).call(this)}}setOnChange(e){this.onChange=e}_onClickedOutside(e){this.dropdown.contains(e.target)||(_(this.dropdown,"open"),Me(this.el))}_onKeyPressed(e){const t=this.dropdown.querySelector(".focus"),i=L(this.dropdown,"open");if(e.keyCode===13)F(i?t:this.dropdown);else if(e.keyCode===40){if(!i)F(this.dropdown);else{const n=this._findNext(t);n&&(t&&_(t,"focus"),C(n,"focus"))}e.preventDefault()}else if(e.keyCode===38){if(!i)F(this.dropdown);else{const n=this._findPrev(t);n&&(t&&_(t,"focus"),C(n,"focus"))}e.preventDefault()}else if(e.keyCode===27&&i)F(this.dropdown);else if(e.keyCode===32&&i)return!1;const s=this.dropdown.querySelector(".focus");return s&&s.scrollIntoView({block:"center"}),!1}_findNext(e){let t=e?e.nextElementSibling:this.dropdown.querySelector(".list .option");for(;t;){if(!L(t,"disabled")&&t.style.display!=="none")return t;t=t.nextElementSibling}return null}_findPrev(e){let t=e?e.previousElementSibling:this.dropdown.querySelector(".list .option:last-child");for(;t;){if(!L(t,"disabled")&&t.style.display!=="none")return t;t=t.previousElementSibling}return null}_onSearchChanged(e){const t=e.target.value.toLowerCase();if(t==="")this.options.forEach(s=>{s.element&&(s.element.style.display="")});else if(L(this.dropdown,"open")){const s=new RegExp(t);this.options.forEach(n=>{n.element&&(n.element.style.display=s.test(n.data.text.toLowerCase())?"":"none")})}this.dropdown.querySelectorAll(".focus").forEach(s=>_(s,"focus"));const i=this._findNext(null);i&&C(i,"focus")}_triggerValidationMessage(e){e==="invalid"?(C(this.dropdown,"invalid"),_(this.dropdown,"valid")):(C(this.dropdown,"valid"),_(this.dropdown,"invalid"))}setOptions(e,t=null,i=null){if((t||i)&&(i=i??"value",t=t??"text",e=e.map(s=>({value:s[i],text:s[t],selected:s.selected||!1,disabled:s.disabled||!1,extra:s.extra}))),this.data=e||[],p(this,S,Ue).call(this,this.data),this.selectedOptions.length>0){const s=this.data.map(a=>a.value),n=this.selectedOptions.filter(a=>s.includes(a.data.value));n.length===0?this.clear():this.selectedOptions=n}return p(this,S,ht).call(this),p(this,S,He).call(this),this}_multipleListAdd(e){if(!this.multiple||e.data.disabled||e.data.value==""||!e.attributes.selected)return;if(this.selectionList==null)this.selectionList=document.createElement("ul"),this.selectionList.classList.add("select-selection-list"),this.el.after(this.selectionList);else if(this.selectionList.querySelector(`[data-value="${e.data.value}"]`)!=null)return;let t=document.createElement("li");t.classList.add("select-selection"),t.dataset.value=e.data.value;let i=`
      <button type="button" class="small remove-select-selection">
        <span class='remove-select-selection'>×</span>
      </button>
    `;i+=`<span class='selected-name'>${e.data.text}</span>`,t.innerHTML=i,this.selectionList.appendChild(t),t.querySelectorAll(".remove-select-selection").forEach(s=>s.addEventListener("click",this._multipleListRemove.bind(this)))}_multipleListRemove(e){if(this.selectionList==null||(e.target!=null&&(e=e.target),e.matches==null||!e.matches(".remove-select-selection")))return;let t=e.closest("li.select-selection"),i=this.options.find(s=>s.data.value===t.dataset.value).element;i&&i.matches(".selected")&&i.click()}}S=new WeakSet,Ve=function(e=!0){this.data?p(this,S,Ue).call(this,this.data):p(this,S,nt).call(this,e),this.el.classList.remove("hidden-select"),p(this,S,at).call(this),this.config.hideSelect&&this.el.classList.add("hidden-select"),p(this,S,ot).call(this)},Ue=function(e){this.options=e.map(t=>({data:t,attributes:{selected:!!t.selected,disabled:!!t.disabled,optgroup:t.value==="optgroup"}}))},nt=function(e){const t=Array.from(this.el.querySelectorAll("option,optgroup")),i=[],s=[];this.data=t.map(n=>{let a,r=n.selected;e&&n.selected&&!n.defaultSelected&&(r=!1),n.tagName==="OPTGROUP"?a={text:n.label,value:"optgroup"}:a={text:n.dataset.display??n.innerText,value:n.value,extra:n.dataset.extra,selected:r,disabled:n.disabled};const l={selected:r,disabled:n.disabled,optgroup:n.tagName==="OPTGROUP"},o={data:a,attributes:l,element:null};return i.push(o),l.selected&&s.push(o),a}),this.options=i,this.selectedOptions=s},at=function(){const e=["fct-nice-select",B(this.el,"class")||"",this.disabled?"disabled":"",this.multiple?"has-multiple":""].filter(Boolean),t=this.config.searchable?`
  <div class="fct-nice-select-search-box">
    <input type="text" class="fct-nice-select-search" placeholder="${this.searchtext}..." title="search"/>
  </div>
`:"",i=`
  <div class="${e.join(" ")}" tabindex="${this.disabled?"":0}">
    <span class="${this.multiple?"multiple-options":"current"}"></span>
    <div class="fct-nice-select-dropdown">
      ${t}
      <ul class="list"></ul>
    </div>
  </div>
`;this.el.insertAdjacentHTML("afterend",i),this.dropdown=this.el.nextElementSibling,this._renderSelectedItems(),this._renderItems()},rt=function(){this.el.addEventListener("invalid",()=>this._triggerValidationMessage("invalid")),window.addEventListener("click",e=>this._onClickedOutside(e)),this.el.addEventListener("change",this.update)},ot=function(){this.dropdown.addEventListener("click",e=>this._onClicked(e)),this.dropdown.addEventListener("keydown",e=>this._onKeyPressed(e)),this.dropdown.addEventListener("focusin",()=>Ot(this.el)),this.dropdown.addEventListener("focusout",()=>Nt(this.el)),this.config.searchable&&this._bindSearchEvent()},lt=function(){const e=this.el;if(this.selectedOptions.length>0?e.value=this.selectedOptions[0].data.value:(e.value="",e.selectedIndex=-1),this.options.forEach(t=>{let i=Array.from(e.options).find(s=>s.textContent===t.data.text);i==null&&(i=Array.from(e.options).find(s=>s.textContent===t.data.value)),i&&(t.attributes.selected?i.selected=!0:i.selected=!1)}),e.removeEventListener("change",this.update),Be(e),this.onChange&&typeof this.onChange=="function"){this.onChange(e.value,e);const t=new Event("change",{bubbles:!0,cancelable:!0});e.dispatchEvent(t)}e.addEventListener("change",this.update)},ct=function(){if(this.multiple){const e=this.el;this.selectedOptions.forEach(t=>{const i=e.querySelector(`option[value="${t.data.value}"]`);i&&(i.selected=!1)})}else this.selectedOptions.length>0&&(this.el.selectedIndex=-1);Be(this.el)},He=function(){if(this.dropdown){const e=L(this.dropdown,"open");p(this,S,_e).call(this),this.dropdown.remove(),this.data=null,p(this,S,Ve).call(this,!1),e&&F(this.dropdown)}B(this.el,"disabled")?this.disable():this.enable()},dt=function(){this.config.showSelectedItems&&(p(this,S,_e).call(this),this.selectedOptions.forEach(e=>{this._multipleListAdd(e)}))},_e=function(){this.selectionList!=null&&(this.selectionList.remove(),this.selectionList=null)},ht=function(){this.el.innerHTML="",this.data.forEach(e=>{const t=document.createElement("option");t.value=e.value,t.textContent=e.text,t.selected=e.selected||!1,t.disabled=e.disabled||!1,e.extra&&(t.dataset.extra=e.extra),this.el.appendChild(t)})};var ee,Fe;class E{static async getCountryInfo(e,t="billing"){return this.countryInfo[e]?{...this.countryInfo[e],cached:!0}:await p(this,ee,Fe).call(this,null,e,t)}static getCountryCodeByTimeZone(e){return this.countryCodeByTimeZone[e]?this.countryCodeByTimeZone[e]:null}static async getCountryInfoByTimeZone(e,t="billing"){const i=this.getCountryCodeByTimeZone(e);return i&&this.countryInfo[i]?this.countryInfo[i]:await p(this,ee,Fe).call(this,e,null,t)}}ee=new WeakSet,Fe=async function(e,t,i="billing"){const s=e?{timezone:e}:{country_code:t};i&&(s.type=i);let n=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_country_info`).toString();n=z.appendQueryParams(n,s);let a;return await fetch(n,{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(async r=>{var l;r=await r.json(),a={...r},delete r.views,this.countryInfo[(l=r.country_info)==null?void 0:l.country_code]=r==null?void 0:r.country_info,r!=null&&r.fragments&&v.handleFragments(r.fragments)}),a==null?void 0:a.country_info},g(E,ee),h(E,"countryInfo",window.fluentcart_checkout_info.country_info||{}),h(E,"countryCodeByTimeZone",{});window.fluent_cart_localization_service={getCountryInfo:E.getCountryInfo,getCountryCodeByTimeZone:E.getCountryCodeByTimeZone,getCountryInfoByTimeZone:E.getCountryInfoByTimeZone};var R,xe,Z,Le,qe,te,ie,m,ut,pt,j,ft,gt,mt,$e,yt,wt,St,vt,bt,_t,Ct,kt,Et;const $=class ${constructor(e){g(this,m);g(this,xe,{});g(this,Z);h(this,"form");g(this,Le,null);g(this,qe,null);g(this,te,null);h(this,"isAllDigital");h(this,"translate",window.fluentcart.$t);g(this,ie,"");var t,i;this.checkoutInfo=window.fluentcart_checkout_info,y(this,te,e),y(this,Z,window.fluentCartRestVars.rest.url),this.nonce=(t=window.fluentCartRestVars)==null?void 0:t.rest.nonce,this.addAddressUrl=`${d(this,Z)}/customers/add-address`,this.findAddressUrl=`${d(this,Z)}/customers/`,y(this,qe,v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=update_address_select`)),this.isAllDigital=((i=window.fluentcart_checkout_vars)==null?void 0:i.is_all_digital.toString())==="1",I.extend(Je),I.extend(Ye),y(this,Le,I.tz.guess()),y(this,ie,window.fluentcart_checkout_info.checkout_nonce)}init(){return d($,R)!==null?d($,R):(this.initAddressFieldModalAction(),y($,R,this),this.initialSetup(),this)}initialSetup(){document.querySelector("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button-wrapper]");const e=document.querySelector("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button].selected"),t=document.querySelector("[data-fluent-cart-checkout-page-form-address-modal-apply-button]");e&&t&&(t.dataset.addressId=e.dataset.id)}initAddressFieldModalAction(){document.addEventListener("click",e=>{const t=e.target.closest("[data-fluent-cart-checkout-page-form-address-modal-open-button]");if(t){const i=p(this,m,$e).call(this,t);if(i){const l=i.value;t.parentNode.querySelectorAll("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button]").forEach(w=>w.classList.remove("selected"));const u=t.parentNode.querySelector(`[data-id='${l}']`);u&&u.classList.add("selected")}p(this,m,j).call(this);const s=p(this,m,pt).call(this,t),n=s.dataset.fluentCartAddressType,a=s.cloneNode(!0);a.classList.remove("hidden"),a.classList.add("show"),p(this,m,gt).call(this,a,t,n),p(this,m,mt).call(this,a,t),a.querySelectorAll("[data-fluent-cart-checkout-page-form-address-modal-close-button]").forEach(l=>{l.addEventListener("click",()=>a.remove())});const r=document.createElement("div");r.className="fluent-cart-checkout-page-form-address-modal-backdrop",r.addEventListener("click",()=>p(this,m,j).call(this)),a.appendChild(r),p(this,m,St).call(this,a),p(this,m,_t).call(this,a),p(this,m,kt).call(this,a,n,t),p(this,m,ft).call(this,a),p(this,m,ut).call(this,a)}})}initStateSelect(e,t=null){var i,s;return(s=(i=t==null?void 0:t.address_locale)==null?void 0:i.state)!=null&&s.label,be.init(e,{placeholder:!1,onChange:n=>{}})}initStateSelect2(e,t=null){var i,s;return(s=(i=t==null?void 0:t.address_locale)==null?void 0:i.state)!=null&&s.label,new W(e,{placeholder:!1,onChange:n=>{}})}onCountryChanged(e="billing",t){let i=[{text:"Select a option",value:""}];t==null||t.states.forEach(s=>{i.push({text:s.name,value:s.value})}),this.billingStateSelect.setOptions(i)}updateStateInput(e,t="billing"){var o,u,w;if(!e)return;const i=(u=(o=e==null?void 0:e.address_locale)==null?void 0:o.state)==null?void 0:u.hidden;e==null||e.states;const s="#"+t+"_state_wrapper";let n=this.form.querySelector("#"+t+"_state");if(!n)return;const a=((n==null?void 0:n.tagName)||"").toLowerCase(),r=((w=e==null?void 0:e.states)==null?void 0:w.length)||0,l=["select","select-one"].includes(a);if(i)this.form.querySelector(s).style.display="none";else if(this.form.querySelector(s).style.display="block",this.billingStateSelect!==null&&(this.billingStateSelect.destroy(),this.billingStateSelect=null),r===0)l&&(n=this.convertElementToType(n,"input"));else{l||(n=this.convertElementToType(n,"select"));let f=[];e==null||e.states.forEach(b=>{f.push({text:b.name,value:b.value})}),this.billingStateSelect=this.initStateSelect2(n,e).setOptions(f)}}convertElementToType(e,t){if(!e||!t)return;const i=document.createElement(t);return i.id=e.id,i.name=e.name,i.className=e.className,i.value=e.value,Array.from(e.attributes).forEach(s=>{s.name.startsWith("data-")&&i.setAttribute(s.name,s.value)}),e.parentNode.replaceChild(i,e),t==="input"&&(i.value=""),i}async getCountryInfo(e,t){const i=e?{timezone:e}:{country_code:t};let s=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_country_info`).toString();s=z.appendQueryParams(s,i);let n=null;if(e||(n=d(this,xe)[i.country_code]),n)return n;let a;return await fetch(s,{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(async r=>{r=await r.json(),a=r==null?void 0:r.country_info,r!=null&&r.fragments&&v.handleFragments(r.fragments)}),a}removeValidationErrors(){document.querySelectorAll("[data-fluent-cart-checkout-page-form-input-wrapper]").forEach(e=>e.classList.remove("has-error")),document.querySelectorAll("[data-fluent-cart-checkout-page-form-error]").forEach(e=>e.innerHTML="")}showValidationErrors(e){if(e!=null&&e.errors&&(e=e.errors),!e||Object.keys(e).length<1)return;let t="";this.form.querySelectorAll(".fct-errors").forEach(i=>i.remove());for(const i in e){const s=this.form.querySelectorAll("[data-fluent-cart-checkout-page-form-section]"),n=this.form.querySelector("#"+i);if(n){n.closest("[data-fluent-cart-checkout-page-form-input-wrapper]").classList.add("has-error"),s.forEach(r=>r.classList.add("has-error"));const a=e[i];if(typeof a=="object"){let r=0;const l=Object.entries(a).length;for(const o in a){t+=a[o];const u=`[data-fluent-cart-checkout-page-form-error][for="${n.name}"]`;this.form.querySelector(u)&&(this.form.querySelector(u).innerHTML=a[o]),r!==l&&(t+="<br>"),r++;break}}}else if(i==="shipping_method"){const a=document.querySelector("[data-fluent-cart-checkout-page-shipping-methods-wrapper]");a&&(a.classList.add("has-error"),a.querySelector("[data-fluent-cart-checkout-page-form-error]").innerHTML=e[i])}}new Toastify({text:t||'<span class="warn warning"></span>Validation Error! Please fill required fields!',className:"warning",escapeMarkup:!1,duration:1300,style:{color:"#000",background:"#ffffff"}}).showToast()}saveCustomerData(e,t){var l;const i=d(this,te).prepareFormData(),s=((l=window.fluentCartUtmManager)==null?void 0:l.get())||{};Object.keys(s).forEach(o=>{t&&i.append(`utm_data[${o}]`,s[o])});const n=new URLSearchParams;for(const[o,u]of i.entries())n.append(o,u);const a=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes`),r=z.appendQueryParams(a.toString(),{fc_checkout_action:"save_checkout_data",data_key:e,data_value:t});fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-WP-Nonce":d(this,ie)},credentials:"include",body:n}).then(o=>o.json()).then(o=>{o!=null&&o.fragments&&v.handleFragments(o.fragments),(o!=null&&o.shipping_charge_changes||o!=null&&o.tax_total_Changes)&&this.checkoutHandler.handleCheckoutAmountChanges()})}};R=new WeakMap,xe=new WeakMap,Z=new WeakMap,Le=new WeakMap,qe=new WeakMap,te=new WeakMap,ie=new WeakMap,m=new WeakSet,ut=function(e){const t=i=>{(i.key==="Escape"||i.keyCode===27)&&(p(this,m,j).call(this),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t),e._escKeyHandler=t},pt=function(e){return e.closest("[data-fluent-cart-checkout-page-form-address-modal-wrapper]").querySelector("[data-fluent-cart-checkout-page-form-address-modal-body]")},j=function(){document.querySelectorAll("body > [data-fluent-cart-checkout-page-form-address-modal-body]").forEach(e=>{e._escKeyHandler&&document.removeEventListener("keydown",e._escKeyHandler),e.remove()})},ft=function(e){document.body.appendChild(e)},gt=function(e,t,i){e.querySelectorAll("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button]").forEach(s=>{s.addEventListener("click",()=>{e.querySelectorAll("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button]").forEach(a=>a.classList.remove("selected")),s.classList.add("selected");const n=e.querySelector("[data-fluent-cart-checkout-page-form-address-modal-apply-button]");n&&(n.dataset.addressId=s.dataset.id,n.dataset.country=s.dataset.country,n.dataset.state=s.dataset.state,n.dataset.addressType=i)})})},mt=function(e,t){const i=e.querySelector("[data-fluent-cart-checkout-page-form-address-modal-apply-button]");i.closest("[data-fluent-cart-checkout-page-form-address-modal-body]").dataset.fluentCartAddressType,i&&i.addEventListener("click",()=>{const n=i.dataset.addressId;if(!n)return;const a=i.dataset.country,r=i.dataset.state,l=p(this,m,yt).call(this,t),o=p(this,m,$e).call(this,t),u=i.dataset.addressType;if(o){const w=o.dataset.country,f=o.dataset.state;if(w!==a||f!==r){o.value=n,o.dataset.country=a,o.dataset.state=r;const b=new Event("change",{bubbles:!0,cancelable:!0});o.dispatchEvent(b),window.dispatchEvent(new CustomEvent("fluentCartNotifyAddressCountryChanged",{detail:{country:a,state:r,input:o,addressType:u}}))}}l&&p(this,m,wt).call(this,n,l,u),p(this,m,j).call(this)})},$e=function(e){const t=e.closest("[data-fluent-cart-checkout-page-form-address-select-wrapper]");return(t==null?void 0:t.querySelector("[data-fluent-cart-checkout-page-form-address-input]"))??null},yt=function(e){const t=e.closest("[data-fluent-cart-checkout-page-form-address-select-wrapper]");return(t==null?void 0:t.querySelector("[data-fluent-cart-checkout-page-form-address-info-wrapper]"))??null},wt=function(e,t,i){this.saveCustomerData(i+"_address_id",e)},St=function(e){e.querySelectorAll("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-button]").forEach(t=>{t.addEventListener("click",()=>p(this,m,vt).call(this,e,t))})},vt=function(e,t){e.querySelector("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button-wrapper]").classList.add("hide");const i=e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-form-wrapper]");this.form=i,this.formType=i.querySelector("#billing_state")||i.querySelector("#billing_country")?"billing":"shipping",p(this,m,bt).call(this,i),i.classList.add("show"),t.parentNode.style.display="none"},bt=async function(e){var r,l,o,u;let t=null;const i="#"+this.formType+"_state",s="#"+this.formType+"_country",n=e.querySelector(s),a=e.querySelector(i);n&&(l=(r=n.nextElementSibling)==null?void 0:r.classList)!=null&&l.contains("fct-nice-select")&&n.nextElementSibling.remove(),a&&((u=(o=a.nextElementSibling)==null?void 0:o.classList)!=null&&u.contains("fct-nice-select")&&a.nextElementSibling.remove(),this.billingStateSelect=new W(a,{placeholder:!1,data:null})),n&&new W(n,{placeholder:this.translate("Select a Country"),clearable:!1,data:null,onChange:async w=>{if(w){const f=await E.getCountryInfo(w);this.updateStateInput(f,this.formType)}else e.querySelector(i).value="",this.billingStateSelect.setOptions([])}}),a&&this.onCountryChanged(this.formType,t)},_t=function(e){e.addEventListener("click",t=>{const i=t.target.closest("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-cancel-button]");i&&p(this,m,Ct).call(this,e,i)})},Ct=function(e,t){e.querySelector("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button-wrapper]").classList.remove("hide"),e.querySelector("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button-wrapper]").classList.add("show"),e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-form-wrapper]").classList.remove("show"),e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-form-wrapper]").classList.add("hide"),e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-button]").parentNode.style.display=""},kt=function(e,t,i){const s=e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-form-wrapper]"),n=s.cloneNode(!0),a=document.createElement("form");a.appendChild(n),s.replaceWith(a);const r=this.isAllDigital?"digital":"physical";a.addEventListener("submit",l=>{var w;l.preventDefault();const o=new FormData(a);o.append("type",t),o.append("product_type",r);const u=`${t}_label`;if(((w=o.get(u))==null?void 0:w.length)>15){new Toastify({text:this.translate("Label must not exceed 15 characters."),className:"warning",duration:900}).showToast();return}p(this,m,Et).call(this,e,o,i)})},Et=function(e,t,i){this.removeValidationErrors();let s=v.buildUrl(this.addAddressUrl.toString()).toString();fetch(s,{method:"POST",body:t,headers:{"X-WP-Nonce":this.nonce}}).then(async n=>{if(n.ok)return await n.json();throw this.showValidationErrors(await n.json()),Error("Failed to submit form")}).then(n=>{if(n.fragment)if(Array.isArray(n.fragment))n.fragment.forEach(r=>{const l=document.querySelector(r.selector);l&&r.type==="replace"&&(l.outerHTML=r.content)});else{let r=document.querySelector(n.fragment.selector);r&&n.fragment.type==="replace"&&(r.outerHTML=n.fragment.content)}const a=e.querySelector("[data-fluent-cart-checkout-page-form-address-modal-address-selector-button-wrapper]");document.querySelectorAll("[data-fluent-cart-checkout-page-form-address-select-wrapper]"),a.classList.remove("hide"),a.classList.remove("show"),e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-form-wrapper]").classList.remove("show"),e.querySelector("[data-fluent-cart-checkout-page-form-address-show-add-new-modal-form-wrapper]").classList.add("hide"),n.message&&(new Toastify({text:n.message,className:"info",duration:900}).showToast(),p(this,m,j).call(this))}).catch(n=>{})},g($,R,null);let je=$;var T,Te,se,ne,ae,re,K,oe,x,V,le,X,A,xt,Re,Lt;class Bt{constructor(e){g(this,A);g(this,T);g(this,Te);g(this,se);g(this,ne);g(this,ae);g(this,re);g(this,K);g(this,oe);g(this,x,[]);g(this,V,!1);g(this,le,!1);h(this,"translate",window.fluentcart.$t);g(this,X,"");var t;y(this,T,e),y(this,Te,window.fluentcart_checkout_vars.rest.url),y(this,le,((t=window.fluentcart_checkout_vars)==null?void 0:t.disable_coupons.toString())==="yes"),y(this,se,v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=apply_coupon`)),y(this,ne,v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=remove_coupon`)),y(this,X,window.fluentcart_checkout_info.checkout_nonce),y(this,ae,"[data-fluent-cart-checkout-page-coupon-container]"),y(this,re,"[data-fluent-cart-checkout-page-coupon-field-toggle]"),y(this,K,"[data-fluent-cart-checkout-page-coupon-validate]"),y(this,oe,"[data-fluent-cart-checkout-page-form-input-wrapper]")}init(){setTimeout(()=>{p(this,A,xt).call(this)},300),window.addEventListener("fluentCartNotifySummaryViewUpdated",()=>{}),window.fluentCartCouponService=this}getCoupons(){return d(this,x)}addCoupon(e){d(this,x).push(e)}removeCouponByCode(e){y(this,x,d(this,x).filter(t=>t!==e)),this.removeCouponFromUrl(e)}removeCouponFromUrl(e){const t=new URL(window.location.href),i=t.searchParams,s=i.get("coupons");if(s){const n=s.split(",").filter(r=>r!==e).join(",");n?i.set("coupons",n):i.delete("coupons");const a=t.pathname+"?"+i.toString();history.replaceState(null,"",a)}}}T=new WeakMap,Te=new WeakMap,se=new WeakMap,ne=new WeakMap,ae=new WeakMap,re=new WeakMap,K=new WeakMap,oe=new WeakMap,x=new WeakMap,V=new WeakMap,le=new WeakMap,X=new WeakMap,A=new WeakSet,xt=function(){d(this,le)||(d(this,T).addEventListener("pointerdown",e=>{e.target.closest(d(this,K))&&(e.preventDefault(),p(this,A,Re).call(this))}),d(this,T).addEventListener("click",e=>{if(e.target.closest(d(this,K))){if(d(this,V)){e.preventDefault();return}e.stopPropagation()}})),d(this,T).addEventListener("click",e=>{if(!e.target.closest(d(this,re)))return;e.preventDefault();const i=document.querySelector(d(this,ae));if(i){const s=i.querySelector(d(this,oe));if(s){const n=s.querySelector("input");n&&setTimeout(()=>n.focus(),0)}i.style.display=i.style.display==="none"||!i.style.display?"block":"none"}}),d(this,T).addEventListener("click",e=>{const t=e.target.closest("[data-remove-coupon]");if(!t||!t.closest("[data-fluent-cart-checkout-page-applied-coupon]"))return;e.preventDefault();const s=t.dataset.coupon??t.getAttribute("data-coupon");p(this,A,Lt).call(this,s)}),d(this,T).addEventListener("keypress",e=>{e.target.id==="coupon"&&e.key==="Enter"&&(e.preventDefault(),p(this,A,Re).call(this))})},Re=function(){y(this,V,!0);const e=document.getElementById("coupon").value,t=document.getElementById("billing_email").value,i=z.appendQueryParams(d(this,se).toString(),{coupon_code:e,customer_email:t});fetch(i,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":d(this,X)},credentials:"include"}).then(s=>(y(this,V,!1),s.ok?s.json():s.json().then(n=>{throw new Error(n.message)}))).then(s=>{v.handleFragments(s.fragments),y(this,x,s.applied_coupons),document.getElementById("coupon").value="",d(this,x).includes(e)?(new Toastify({text:this.translate("Applied Successfully"),className:"info",duration:3e3}).showToast(),window.dispatchEvent(new CustomEvent("fluentCartNotifyCouponApplied",{detail:{response:s}})),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:s}}))):new Toastify({text:this.translate("Coupon cannot be applied"),className:"info",duration:3e3}).showToast()}).catch(s=>{y(this,V,!1),new Toastify({text:`<span class="warn warning"></span>${s.message}`,className:"warning",escapeMarkup:!1,duration:3e3,close:!1}).showToast()})},Lt=function(e){this.removeCouponByCode(e),fetch(d(this,ne)+"&coupon_code="+e,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":d(this,X)},credentials:"include"}).then(t=>t.ok?(new Toastify({text:this.translate("Coupon removed!"),className:"info",duration:3e3}).showToast(),t.json()):t.text().then(i=>{throw new Error(i)})).then(t=>{y(this,x,t.applied_coupons),t.fragments&&v.handleFragments(t.fragments),window.dispatchEvent(new CustomEvent("fluentCartNotifyCouponRemoved",{detail:{response:t}})),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:t}}))}).catch(t=>{this.addCoupon(e),console.error("Failed to cancel coupon:",t.message)})};var Q,ce;const D=class D{constructor(e,t){g(this,Q,null);h(this,"formWrapper");h(this,"checkoutHandler",null);h(this,"onReady",null);h(this,"defaultCountry",null);g(this,ce,"");var i;this.formWrapper=e.form,this.checkoutHandler=e,this.isAllDigital=((i=window.fluentcart_checkout_vars)==null?void 0:i.is_all_digital.toString())==="1",y(this,ce,window.fluentcart_checkout_info.checkout_nonce),I.extend(Je),I.extend(Ye),y(this,Q,I.tz.guess()),this.onReady=t,this.initCustomBillingSelect()}static init(e,t){return D.instance===null&&(D.instance=new D(e,t)),window.fluent_cart_address_service=D.instance,D.instance}async initCustomBillingSelect(){var l,o,u,w;let e=this.formWrapper.querySelector("#billing_country"),t="";e&&(t=e.value);let i=null;(!e||!d(this,Q)&&!t)&&(t=window.fluentcart_checkout_info.store_country),t?i=await E.getCountryInfo(t):(i=await E.getCountryInfoByTimeZone(d(this,Q)),i!=null&&i.country_code&&this.saveCustomerData("billing_country",i==null?void 0:i.country_code)),e&&i&&(e.value=i==null?void 0:i.country_code),i.cached&&this.saveCustomerData("billing_country",i==null?void 0:i.country_code);let s=this.formWrapper.querySelector("#billing_state"),n="";s&&(n=s.value),this.stateLabel="State",i&&((o=(l=i.address_locale)==null?void 0:l.state)!=null&&o.label)&&(this.stateLabel=(w=(u=i.address_locale)==null?void 0:u.state)==null?void 0:w.label),s&&(this.billingStateSelect=new W(s,{placeholder:this.stateLabel,data:null}));let a="";e&&(a=e.value),this.defaultCountry=a,e&&(this.billingCountrySelect=new W(e,{placeholder:"Select a Country",clearable:!1,data:null})),e&&a&&this.billingCountrySelect.setSelected(a),e&&e.value===a&&s&&this.billingStateSelect.setSelected(n);const r=this;if(e&&(this.billingCountrySelect.setOnChange(async f=>{if(window.fluent_cart_checkout_ui_service.setComponentState("billingStateSelect","loading"),f){const b=await E.getCountryInfo(f);r.saveCustomerData("billing_country",f),b&&window.fluent_cart_checkout_ui_service.setComponentState("billingStateSelect","enable"),window.fluent_cart_shipping_service&&window.fluent_cart_shipping_service.shippingToDifferent===!1&&(b.views?window.fluent_cart_shipping_service.updateShippingMethodsView({view:b.views.shipping_methods,status:!0}):window.fluent_cart_shipping_service.handleBillingAddressChange(f)),this.updateStateInput(b,"billing")}else this.formWrapper.querySelector("#billing_state")&&(this.formWrapper.querySelector("#billing_state").value="",this.billingStateSelect.setOptions([]))}),this.onCountryChanged("billing",i,i==null?void 0:i.country_code)),this.updateStateInput(i,"billing"),s&&this.billingStateSelect,this.isAllDigital)typeof this.onReady=="function"&&this.onReady();else{const f={response:i,defaultCountry:a,defaultState:n};this.initCustomShippingSelect(f)}}initCustomShippingSelect(e){var a;const t=this.formWrapper.querySelector("#shipping_state"),i=this.formWrapper.querySelector("#shipping_country");let s="";i&&(s=i.value);let n="";t&&(n=t.value),t&&(this.shippingStateSelect=new W(t,{placeholder:this.stateLabel,data:null})),i&&(this.shippingCountrySelect=new W(i,{placeholder:!1,clearable:!1,data:null})),s||(s=e.defaultCountry),n||(n=e.defaultState),this.defaultCountry=s,i&&this.shippingCountrySelect.setSelected(s),s&&this.shippingStateSelect.setSelected(n),i&&(this.shippingCountrySelect.setOnChange(async r=>{if(window.fluent_cart_checkout_ui_service.setComponentState("shippingStateSelect","loading"),r){const l=await E.getCountryInfo(r,"shipping");l&&window.fluent_cart_checkout_ui_service.setComponentState("shippingStateSelect","enable"),window.fluent_cart_shipping_service&&(l.views?window.fluent_cart_shipping_service.updateShippingMethodsView({view:l.views.shipping_methods,status:!0}):window.fluent_cart_shipping_service.handleShippingAddressChange(r)),this.updateStateInput(l,"shipping")}else this.formWrapper.querySelector("#shipping_state").value="",this.shippingStateSelect.setOptions([])}),this.onCountryChanged("shipping",e.response,(a=e.response)==null?void 0:a.country_code)),typeof this.onReady=="function"&&this.onReady()}onCountryChanged(e="billing",t,i=""){var l,o;const s=this.formWrapper.querySelector("#"+e+"_state"),a=this.formWrapper.querySelector("#"+e+"_country").value;let r="";if(s&&(r=s.value),t!=null&&t.states){let u=[{text:"Select an option",value:""}];if(t==null||t.states.forEach(w=>{u.push({text:w.name,value:w.value})}),e==="billing"){if(s){this.billingStateSelect&&this.billingStateSelect.setOptions(u),a&&this.billingStateSelect.setSelected(r);const w=this;this.billingStateSelect.setOnChange(async f=>{w.saveCustomerData("billing_state",f)})}}else if(s){this.shippingStateSelect&&this.shippingStateSelect.setOptions(u),a&&this.shippingStateSelect.setSelected(r);const w=this;this.shippingStateSelect.setOnChange(async f=>{w.saveCustomerData("shipping_state",f)})}}this.showHideState((o=(l=t==null?void 0:t.address_locale)==null?void 0:l.state)==null?void 0:o.hidden,e)}updateStateInput(e,t="billing"){var u,w,f,b,J,we,Se,ve,et,tt,it;if(!e)return;const i=(w=(u=e==null?void 0:e.address_locale)==null?void 0:u.state)==null?void 0:w.hidden;e==null||e.states;const s="#"+t+"_state_wrapper";let n=this.formWrapper.querySelector("#"+t+"_state");const a=((n==null?void 0:n.tagName)||"").toLowerCase(),r=((f=e==null?void 0:e.states)==null?void 0:f.length)||0,l=["select","select-one"].includes(a);if(!n)return;const o=n.value;if(i)this.formWrapper.querySelector(s).style.display="none";else{if(this.formWrapper.querySelector(s).style.display="block",t==="billing"&&this.billingStateSelect!==null&&(this.billingStateSelect.destroy(),this.billingStateSelect=null),t==="shipping"&&this.shippingStateSelect!==null&&(this.shippingStateSelect.destroy(),this.shippingStateSelect=null),r===0){if(l){let P="State";e&&((J=(b=e.address_locale)==null?void 0:b.state)!=null&&J.label)&&(P=(Se=(we=e.address_locale)==null?void 0:we.state)==null?void 0:Se.label),n=this.convertElementToType(n,"input",P),n.addEventListener("change",()=>{this.saveCustomerData(n.name,n.value)})}}else{l||(n=this.convertElementToType(n,"select"),n.addEventListener("change",()=>{this.saveCustomerData(n.name,n.value)}));let P="State";e&&((et=(ve=e.address_locale)==null?void 0:ve.state)!=null&&et.label)&&(P=(it=(tt=e.address_locale)==null?void 0:tt.state)==null?void 0:it.label);let Ne=[{text:"Select "+P,value:""}];if(e==null||e.states.forEach(H=>{Ne.push({text:H.name,value:H.value})}),t==="shipping"){this.shippingStateSelect=this.initStateSelect(n,e,P).setOptions(Ne),this.shippingStateSelect.setSelected(o);const H=this;this.shippingStateSelect.setOnChange(async We=>{H.saveCustomerData("shipping_state",We)})}else{this.billingStateSelect=this.initStateSelect(n,e,P).setOptions(Ne),this.billingStateSelect.setSelected(o);const H=this;this.billingStateSelect.setOnChange(async We=>{H.saveCustomerData("shipping_state",We)})}}n.closest("[data-fluent-cart-checkout-page-form-input-wrapper]")}}initStateSelect(e,t=null,i=!1){var s,n;return(n=(s=t==null?void 0:t.address_locale)==null?void 0:s.state)!=null&&n.label,new W(e,{placeholder:i,onChange:a=>{}})}convertElementToType(e,t,i=null){if(!e||!t)return;const s=document.createElement(t);s.id=e.id,s.name=e.name,s.className=e.className,s.value=e.value,Array.from(e.attributes).forEach(a=>{a.name.startsWith("data-")&&s.setAttribute(a.name,a.value)}),i&&s.setAttribute("placeholder",i);const n=e.parentNode;return n&&n.replaceChild(s,e),t==="input"&&(s.value=""),s}showHideState(e,t="billing"){let i="#"+t+"_state_wrapper";this.formWrapper.querySelector("#"+t+"_state"),this.formWrapper.querySelector(i)&&(e?this.formWrapper.querySelector(i).style.display="none":this.formWrapper.querySelector(i).style.display="block")}saveCustomerData(e,t){var l;const i=this.checkoutHandler.prepareFormData(),s=((l=window.fluentCartUtmManager)==null?void 0:l.get())||{};Object.keys(s).forEach(o=>{t&&i.append(`utm_data[${o}]`,s[o])});const n=new URLSearchParams;for(const[o,u]of i.entries())n.append(o,u);const a=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes`),r=z.appendQueryParams(a.toString(),{fc_checkout_action:"save_checkout_data",data_key:e,data_value:t});fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-WP-Nonce":d(this,ce)},credentials:"include",body:n}).then(o=>o.json()).then(o=>{o!=null&&o.fragments&&v.handleFragments(o.fragments),(o!=null&&o.shipping_charge_changes||o!=null&&o.tax_total_Changes)&&this.checkoutHandler.handleCheckoutAmountChanges()})}};Q=new WeakMap,ce=new WeakMap,h(D,"instance",null);let ke=D;var de;const O=class O{constructor(e){h(this,"checkoutHandler",null);h(this,"form",null);g(this,de,"");this.checkoutHandler=e,this.form=e.form,y(this,de,window.fluentcart_checkout_info.checkout_nonce),this.bindEvents()}static init(e){return O.instance===null&&(O.instance=new O(e)),window.fluent_cart_checkout_data_watcher=O.instance,O.instance}bindEvents(){const e=["billing_country","shipping_country"];for(const a of e){const r=document.getElementById(a);r&&r.addEventListener("change",this.debounce(l=>{this.saveCustomerData(a,l.target.value)},400))}const t=["billing_state","shipping_state"];for(const a of t){const r=document.getElementById(a);r&&r.addEventListener("change",this.debounce(l=>{l.target.value==="Select State"||l.target.value===""||this.saveCustomerData(a,l.target.value)},400))}const i=["billing_address","billing_full_name","billing_email","billing_address_1","billing_city","billing_postcode","billing_company_name","billing_phone","shipping_address","shipping_full_name","shipping_address_1","shipping_city","shipping_postcode","shipping_company_name","shipping_phone"];for(let a of i){const r=document.getElementById(a);r&&r.addEventListener("change",this.debounce(l=>{a==="shipping_address"&&(a="shipping_address_id"),a==="billing_address"&&(a="billing_address_id"),this.saveCustomerData(a,l.target.value)},400))}document.querySelectorAll('input[name="_fct_pay_method"]').forEach(a=>{a.addEventListener("change",r=>{r.target.checked&&this.saveCustomerData("_fct_pay_method",r.target.value)})}),window.addEventListener("change",a=>{const r=a.target;r&&r.name==="fc_shipping_method"&&r.checked&&this.saveCustomerData("shipping_method_id",r.value)});const n=["ship_to_different"];for(const a of n)document.querySelectorAll(`input[name="${a}"]`).forEach(l=>{l.addEventListener("change",o=>{o.target.checked===!0?this.saveCustomerData(a,"yes"):this.saveCustomerData(a,"no")})})}debounce(e,t){let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>e.apply(this,s),t)}}saveCustomerData(e,t){var l;const i=this.checkoutHandler.prepareFormData(),s=((l=window.fluentCartUtmManager)==null?void 0:l.get())||{};Object.keys(s).forEach(o=>{t&&i.append(`utm_data[${o}]`,s[o])});const n=new URLSearchParams;for(const[o,u]of i.entries())n.append(o,u);const a=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes`),r=z.appendQueryParams(a.toString(),{fc_checkout_action:"save_checkout_data",data_key:e,data_value:t});fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-WP-Nonce":d(this,de)},credentials:"include",body:n}).then(o=>o.json()).then(o=>{o!=null&&o.fragments&&v.handleFragments(o.fragments),(o!=null&&o.shipping_charge_changes||o!=null&&o.tax_total_Changes)&&this.checkoutHandler.handleCheckoutAmountChanges()})}prepareUtmData(){const e=new FormData(this.form);e.append("_wpnonce",this.nonce);const t=window.fluentCartUtmManager.get();return Object.keys(t).forEach(i=>{const s=t[i];s&&e.append(`utm_data[${i}]`,s)}),e}};de=new WeakMap,h(O,"instance",null);let Ee=O;const N=class N{constructor(e,t){h(this,"countries",[]);h(this,"states",{});h(this,"shippingToDifferent",!1);h(this,"billingCountry",null);h(this,"shippingCountry",null);h(this,"loadingShippingInfo",!1);h(this,"countryCode","");h(this,"state","");h(this,"billingState","");h(this,"shippingState","");h(this,"formWrapper");h(this,"shippingContainer");h(this,"checkoutHandler",null);h(this,"currentShippingMethodId",null);h(this,"translate",window.fluentcart.$t);this.formWrapper=e,this.checkoutHandler=t,this.shippingContainer=this.formWrapper.querySelector("[data-fluent-cart-checkout-page-shipping-method-wrapper]"),this.bindDelegatedListeners(),this.countryCode=window.fluent_cart_address_service.defaultCountry}static init(e,t){return N.instance===null&&(N.instance=new N(e,t)),ke.init(this,()=>{Ee.init(this)}),window.fluent_cart_shipping_service=N.instance,N.instance}getShippingContainer(){return this.shippingContainer=this.formWrapper.querySelector("[data-fluent-cart-checkout-page-shipping-method-wrapper]"),this.shippingContainer}bindDelegatedListeners(){const e=document.getElementById("ship_to_different");e&&(this.shippingToDifferent=e.checked);const t=document.getElementById("billing_address");t&&(this.billingCountry=t.dataset.country);const i=document.getElementById("shipping_address");i&&(this.shippingCountry=i.dataset.country),this.formWrapper.addEventListener("change",s=>{if(s.target.id==="ship_to_different"){this.handleShipToDifferentChange(s.target.checked);return}if(s.target.id==="billing_address"){this.countryCode=s.target.dataset.country,this.state=s.target.dataset.state,this.fetchCountryShippingMethods();return}if(s.target.id==="billing_country"){this.billingCountry=s.target.value,this.handleCountryChange(s.target.value);return}if(s.target.id==="shipping_country"){this.shippingCountry=s.target.value,this.handleCountryChange(s.target.value);return}if(s.target.id==="shipping_address"){this.countryCode=s.target.dataset.country,this.state=s.target.dataset.state,this.fetchCountryShippingMethods();return}if(s.target.matches('select[name="shipping_state"]')){this.shippingState=s.target.value,this.handleStateChange();return}if(s.target.matches('select[name="billing_state"]')){this.billingState=s.target.value,this.handleStateChange();return}if(s.target.matches('input[name="fc_shipping_method"]')){this.handleShippingMethodChange(s.target.value);return}})}bindShipToDifferentListener(){const e=document.getElementById("ship_to_different");if(e){this.shippingToDifferent=e.checked;const t=this;e.addEventListener("change",function(){t.handleShipToDifferentChange.bind(t)(this.checked)})}}handleShipToDifferentChange(e){this.shippingToDifferent=e;const t=document.getElementById("shipping_address");if(t&&t.dataset.country&&this.shippingToDifferent)this.countryCode=t.dataset.country,this.state=t.dataset.state,this.fetchCountryShippingMethods();else{let i="",s="";this.shippingToDifferent?(this.formWrapper.querySelector("#shipping_country")&&(i=this.formWrapper.querySelector("#shipping_country").value),this.formWrapper.querySelector("#shipping_state")&&(s=this.formWrapper.querySelector("#shipping_state").value)):(this.formWrapper.querySelector("#billing_country")&&(i=this.formWrapper.querySelector("#billing_country").value),this.formWrapper.querySelector("#billing_state")&&(s=this.formWrapper.querySelector("#billing_state").value)),this.countryCode=i,this.state=s,this.fetchCountryShippingMethods()}}bindBillingCountryListener(){const e=document.getElementById("billing_address");if(e){const i=this;this.billingCountry=e.dataset.country,e.addEventListener("change",function(){const s=this.dataset.country;i.handleBillingAddressChange.bind(i)(s)});return}const t=document.getElementById("billing_country");t&&(this.billingCountry=t.value,t.addEventListener("change",function(){}))}bindShippingCountryListener(){const e=document.getElementById("shipping_address");if(e){const i=this;this.shippingCountry=e.dataset.country,e.addEventListener("change",function(){const s=this.dataset.country;i.handleShippingAddressChange.bind(i)(s)});return}const t=document.getElementById("shipping_country");t&&(this.shippingCountry=t.value,t.addEventListener("change",function(){}))}handleBillingAddressChange(e){this.billingCountry=e,this.shippingToDifferent||(this.shippingCountry=e)}handleCountryChange(){this.shippingToDifferent?this.countryCode=this.shippingCountry:this.countryCode=this.billingCountry}handleShippingAddressChange(e){this.shippingToDifferent?this.shippingCountry=e:this.shippingCountry=this.billingCountry}handleStateChange(){this.shippingToDifferent?this.state=this.shippingState:this.state=this.billingState,this.fetchCountryShippingMethods()}fetchCountryShippingMethods(){}updateShippingMethodsView(e){var i;if(e.status===!1){if(e.fragments){v.handleFragments(e.fragments);return}this.shippingContainer.innerHTML=e.view||`<div class="fct-empty-text">${e.message}</div>`;return}this.getShippingContainer()&&(this.getShippingContainer().innerHTML=e.view),(i=this.checkoutHandler)==null||i.buttons.removeAttribute("disabled");let t="";this.getShippingContainer()&&(t=this.getShippingContainer().querySelectorAll('input[name="fc_shipping_method"]')),t.length>0&&this.selectDefaultShippingMethod(t)}bindShippingMethodChangeListener(){this.currentShippingMethodId=null,this.setShippingMethodIdToForm();const e=this.shippingContainer.querySelectorAll('input[name="fc_shipping_method"]');e.length>0&&this.selectDefaultShippingMethod(e)}selectDefaultShippingMethod(e){e[0].checked=!0,setTimeout(()=>{this.handleShippingMethodChange(e[0].value)},0)}setShippingMethodIdToForm(){const e=this.getShippingContainer().querySelector('input[name="fc_selected_shipping_method"]');e&&(e.value=this.currentShippingMethodId)}handleShippingMethodChange(e){}};h(N,"instance",null);let Ze=N;const q=class q{constructor(e){h(this,"formWrapper",null);h(this,"states",{loading:"loading",enable:"enable",disable:"disable",loadingAndDisabled:"loadingAndDisabled"});h(this,"viewsStates",{});h(this,"views",{billingCountry:null,billingState:null,billingStateSelect:null,shippingCountry:null,shippingState:null,shippingStateSelect:null,checkoutButton:null});this.formWrapper=e.form,this.initViews()}static init(e){return q.instance===null&&(q.instance=new q(e),window.dispatchEvent(new CustomEvent("checkout_ui_service_initialized",{detail:{service:q.instance}}))),window.fluent_cart_checkout_ui_service=q.instance,q.instance}initViews(){this.views.billingCountry=this.formWrapper.querySelector("#billing_country"),this.views.billingState=this.formWrapper.querySelector("#billing_state"),this.views.billingState&&(this.views.billingStateSelect=this.views.billingState.closest("#billing_state_wrapper")),this.views.shippingCountry=this.formWrapper.querySelector("#shipping_country"),this.views.shippingState=this.formWrapper.querySelector("#shipping_state"),this.views.shippingState&&(this.views.shippingStateSelect=this.views.shippingState.closest("#shipping_state_wrapper")),this.views.checkoutButton=this.formWrapper.querySelector("#fluent_cart_order_btn")}setCheckoutButtonText(e){this.views.checkoutButton&&(this.views.checkoutButton.innerHTML=e)}enableCheckoutButton(){this.setComponentState("checkoutButton",this.states.enable)}disableCheckoutButton(){this.setComponentState("checkoutButton",this.states.disable)}hideCheckoutButton(){this.hideComponent("checkoutButton")}showCheckoutButton(){this.showComponent("checkoutButton")}isCheckoutButtonDisabled(){return this.viewsStates.hasOwnProperty("checkoutButton")?this.viewsStates.checkoutButton!==this.states.enable:!1}setComponentState(e,t){this.views[e]&&(t===this.states.enable&&(this.views[e].removeAttribute("disabled"),this.views[e].dataset.loading=""),t===this.states.disable&&this.views[e].setAttribute("disabled","disabled"),t===this.states.loading&&(this.views[e].dataset.loading="loading"),t===this.states.loadingAndDisabled&&(this.views[e].setAttribute("disabled","disabled"),this.views[e].dataset.loading="loading"),this.viewsStates[e]=t)}hideComponent(e){this.views[e]&&(this.views[e].style.display="none")}showComponent(e,t="block"){this.views[e]&&(this.views[e].style.display=t)}};h(q,"instance",null);let Ke=q;const M=class M{constructor(e){h(this,"checkoutHandler",null);h(this,"form",null);h(this,"taxWrapper",null);h(this,"applyBtn",null);h(this,"loader",null);h(this,"taxIdInput",null);h(this,"errorWrapper",null);h(this,"taxRemoveBtn",null);h(this,"validNoteWrapper",null);h(this,"validNote",null);h(this,"translate",window.fluentcart.$t);var t,i,s,n,a,r,l;this.checkoutHandler=e,this.form=e==null?void 0:e.form,this.taxWrapper=this.form.querySelector("[data-fluent-cart-checkout-page-tax-wrapper]"),this.applyBtn=(t=this.taxWrapper)==null?void 0:t.querySelector("[data-fluent-cart-checkout-page-tax-apply-btn]"),this.loader=(i=this.taxWrapper)==null?void 0:i.querySelector("[data-fluent-cart-checkout-page-tax-loading]"),this.taxIdInput=(s=this.taxWrapper)==null?void 0:s.querySelector("[data-fluent-cart-checkout-page-tax-id]"),this.errorWrapper=(n=this.taxWrapper)==null?void 0:n.querySelector("[data-fluent-cart-checkout-page-form-error]"),this.taxRemoveBtn=(a=this.taxWrapper)==null?void 0:a.querySelector("[data-fluent-cart-tax-remove-btn]"),this.validNoteWrapper=(r=this.taxWrapper)==null?void 0:r.querySelector("[data-fluent-cart-tax-valid-note-wrapper]"),this.validNote=(l=this.taxWrapper)==null?void 0:l.querySelector("[data-fluent-cart-tax-valid-note]"),this.bindDelegatedEvents()}static init(e){return M.instance===null&&(M.instance=new M(e)),M.instance}getTaxWrapper(){return this.taxWrapper=this.form.querySelector("[data-fluent-cart-checkout-page-tax-wrapper]"),this.taxWrapper}getTaxElements(){const e=this.getTaxWrapper();return e?{applyBtn:e.querySelector("[data-fluent-cart-checkout-page-tax-apply-btn]"),loader:e.querySelector("[data-fluent-cart-checkout-page-tax-loading]"),taxIdInput:e.querySelector("[data-fluent-cart-checkout-page-tax-id]"),errorWrapper:e.querySelector("[data-fluent-cart-checkout-page-form-error]"),taxRemoveBtn:e.querySelector("[data-fluent-cart-tax-remove-btn]"),validNoteWrapper:e.querySelector("[data-fluent-cart-tax-valid-note-wrapper]"),validNote:e.querySelector("[data-fluent-cart-tax-valid-note]")}:{}}bindDelegatedEvents(){this.form.addEventListener("click",e=>{if(e.target.matches("[data-fluent-cart-checkout-page-tax-apply-btn]")){e.preventDefault(),this.validateVatHandler();return}if(e.target.matches("[data-fluent-cart-tax-remove-btn]")){e.preventDefault(),this.removeVat();return}}),this.form.addEventListener("keydown",e=>{e.target.matches("[data-fluent-cart-checkout-page-tax-id]")&&e.key==="Enter"&&(e.preventDefault(),this.validateVatHandler())})}validateVatHandler(){var i,s;const t=(s=(i=this.getTaxElements().taxIdInput)==null?void 0:i.value)==null?void 0:s.trim();if(!t){this.clearError();return}this.validateVat(t)}async validateVat(e){var s;const t=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_validate_vat`).toString(),i=new URLSearchParams({vat_number:e,_wpnonce:((s=window.fluentcart_checkout_info)==null?void 0:s.checkout_nonce)||""}).toString();try{this.startLoading();const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},credentials:"include",body:i}),a=await n.json();if(!n.ok||(a==null?void 0:a.success)===!1){const l=(a==null?void 0:a.message)||(a==null?void 0:a.message)||this.translate("Invalid VAT number");return this.showError(l),!1}const r=a==null?void 0:a.tax_data;return a!=null&&a.fragments&&v.handleFragments(a.fragments),this.clearError(),this.showSuccess(`${r!=null&&r.name?r.name+" • ":""}${(r==null?void 0:r.country)||""}`),!0}catch(n){return console.log(n,"error"),this.showError(this.translate("Validation service unavailable. Please try again.")),!1}finally{this.endLoading()}}async removeVat(){var i;if(!confirm(this.translate("Are you sure you want to remove VAT?")))return;const e=v.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_remove_vat`).toString(),t=new URLSearchParams({_wpnonce:((i=window.fluentcart_checkout_info)==null?void 0:i.checkout_nonce)||""}).toString();try{this.startLoading();const s=await fetch(e,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},credentials:"include",body:t}),n=await s.json();if(!s.ok||(n==null?void 0:n.success)===!1){this.showError((n==null?void 0:n.message)||this.translate("Failed to remove VAT"));return}this.clearError(),this.clearSuccess(),n!=null&&n.fragments&&v.handleFragments(n.fragments);const a=this.getTaxElements();a.taxIdInput&&(a.taxIdInput.value=""),window.location.reload()}catch(s){console.error(s),this.showError(this.translate("Could not remove VAT, please try again."))}finally{this.endLoading()}}showError(e){var s;const t=this.getTaxElements(),i=this.getTaxWrapper();i==null||i.classList.add("has-error"),(s=t.taxIdInput)==null||s.setAttribute("aria-invalid","true"),t.errorWrapper&&(t.errorWrapper.textContent=e||this.translate("Invalid VAT number"),t.errorWrapper.style.display="block")}clearError(){var i;const e=this.getTaxElements(),t=this.getTaxWrapper();t==null||t.classList.remove("has-error"),(i=e.taxIdInput)==null||i.removeAttribute("aria-invalid"),e.errorWrapper&&(e.errorWrapper.textContent="",e.errorWrapper.style.display=""),this.clearSuccess()}showSuccess(e){const t=this.getTaxElements();this.getTaxWrapper()&&t.validNote&&(t.validNoteWrapper.classList.remove("is-hidden"),t.validNote.textContent=e||this.translate("Valid VAT number"))}clearSuccess(){const e=this.getTaxElements();this.getTaxWrapper()&&e.validNote&&(e.validNoteWrapper.classList.add("is-hidden"),e.validNote.textContent="")}startLoading(){var t,i;const e=this.getTaxElements();e.loader&&(e.loader.style.display="block",e.loader.textContent=this.translate("Validating...")),(e.applyBtn||e.taxIdInput)&&((t=e.taxIdInput)==null||t.setAttribute("disabled","disabled"),(i=e.applyBtn)==null||i.setAttribute("disabled","disabled")),this.clearError()}endLoading(){var t,i;const e=this.getTaxElements();e.loader&&(e.loader.style.display="none"),(e.applyBtn||e.taxIdInput)&&((t=e.taxIdInput)==null||t.removeAttribute("disabled"),(i=e.applyBtn)==null||i.removeAttribute("disabled")),e.errorWrapper&&(e.errorWrapper.style.display="block")}};h(M,"instance",null);let Xe=M;var he,k,ue,Ge,pe,Ie,Ae,fe,ge,U,me,De,Oe,ye,ze;const Y=class Y{constructor(e,t,i){g(this,ye);g(this,k,null);g(this,ue);g(this,Ge,[]);g(this,pe,null);g(this,Ie);g(this,Ae);g(this,fe,null);g(this,ge,!1);g(this,U);g(this,me);g(this,De,!1);g(this,Oe,!1);h(this,"checkoutUiService");h(this,"translate",window.fluentcart.$t);var s,n,a,r,l,o,u,w,f;if(I.extend(Je),I.extend(Ye),y(this,pe,I.tz.guess()),d(Y,he)!==null)return d(Y,he);this.form=t,this.settings=i,y(this,Ie,window.fluentCartRestVars.rest.url),this.checkoutInfo=window.fluentcart_checkout_info,y(this,De,((s=window.fluentcart_checkout_info)==null?void 0:s.is_zero_payment)==="yes"),y(this,Oe,((n=window.fluentcart_checkout_info)==null?void 0:n.has_subscription)=="yes"),this.nonce=(a=this.checkoutInfo)==null?void 0:a.rest.nonce,this.checkoutUrl=(r=this.checkoutInfo)==null?void 0:r.order_confirmation_url,this.checkoutUrl=v.buildUrl(this.checkoutUrl),y(this,Ae,(l=window.fluentcart_checkout_vars)==null?void 0:l.submit_button),y(this,fe,this.form.querySelector("[data-fluent-cart-ship-to-different-address]")),y(this,U,this.form.querySelector("[data-fluent-cart-checkout-order-notes-toggle]")),y(this,me,this.form.querySelector("[data-fluent-cart-checkout-order-notes-wrapper]")),this.isAllDigital=((o=window.fluentcart_checkout_vars)==null?void 0:o.is_all_digital.toString())==="1",this.buttons=this.form.querySelector("[data-fluent-cart-checkout-page-checkout-button]"),this.checkoutUiService=Ke.init(this),y(this,k,new At({form:this.form,orderHandler:this.handleOrder.bind(this),checkoutHandler:this})),new je(this).init(),new Bt(this.form).init(),ke.init(this,()=>{setTimeout(()=>{Ee.init(this),this.isAllDigital||Ze.init(this.form,this)},1e3)}),((w=(u=window.fluentcart_checkout_vars)==null?void 0:u.tax_settings)==null?void 0:w.enable_tax)==="yes"&&Xe.init(this),this.init(),this.handleShippingForm(t),this.loadPaymentEmbedModules(),this.formatErrorFields(),this.handleCartItemsCollapse(),this.handleCouponItemsCollapse(),this.isCartLocked=((f=window.fluentcart_checkout_vars)==null?void 0:f.is_cart_locked.toString())==="yes",this.setDefaultCountry(),this.setupDeleteCartItemHandler(),this.handleCountryChange(),this.handlePhoneInput(),this.handleOrderNotesToggle()}handleCountryChange(){var e;(e=d(this,fe))==null||e.addEventListener("change",t=>{y(this,ge,t.target.checked)})}async setDefaultCountry(){}handleCheckoutAmountChanges(){}async load(){try{const e=await this.loadCartItems();return e&&y(this,ue,e),d(this,ue)}catch(e){console.error("Error loading cart data:",e)}}async loadCartItems(){try{return await d(this,ye,ze).getCart()}catch(e){throw console.error("Error fetching cart items:",e),e}}setupDeleteCartItemHandler(){const e=this;document.addEventListener("click",async t=>{if(t.target.matches("[data-fluent-cart-checkout-item-remove-button]")){const s=t.target.dataset.fluentCartCheckoutItemId;try{await d(e,ye,ze).removeProduct(s);const n=await e.load();(!n||Object.keys(n).length===0)&&location.reload()}catch(n){console.error("Failed to remove product:",n)}}})}formatErrorFields(){document.querySelectorAll("[data-fluent-cart-checkout-page-form-section]").forEach(t=>{t.querySelectorAll("[data-fluent-cart-checkout-page-form-error]").forEach(s=>{const n=s.cloneNode(!0);s.remove(),t.appendChild(n)})})}init(){this.form.addEventListener("submit",e=>{e.preventDefault(),e.detail===void 0&&this.handleOrder(e)}),this.buttons&&this.buttons.addEventListener("click",e=>{e.preventDefault(),this.form.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))})}loadPaymentEmbedModules(){d(this,k).load()}handleShippingForm(e){this.disableRequiredShipping();const t=this,i=e.querySelector("[data-fluent-cart-ship-to-different-address]"),s=e.querySelector("[data-fluent-cart-checkout-page-shipping-fields]");i!=null&&i.checked&&(y(this,ge,!0),s.style.display="block",s.querySelectorAll('input[data-required="disabled"]').forEach(a=>{a.dataset.required="yes",a.required=!0})),i&&i.addEventListener("change",function(n){const a=e.querySelector("[data-fluent-cart-checkout-page-shipping-fields]");this.checked?(a.style.display="block",a.querySelectorAll('input[data-required="disabled"]').forEach(l=>{l.dataset.required="yes",l.required=!0})):t.disableRequiredShipping()})}disableRequiredShipping(){const e=this.form.querySelector("[data-fluent-cart-checkout-page-shipping-fields]");e&&(e.style.display="none",e.querySelectorAll('input[data-required="yes"]').forEach(i=>{i.dataset.required="disabled",i.required=!1}))}buttonState(e,t,i="disabled"){i==="disabled"?d(this,k).disableCheckoutButton(t):i==="hide"?d(this,k).hideCheckoutButton():d(this,k).enableCheckoutButton(t),this.form.classList.add("fluent_cart_"+e)}async handleOrder(e){var l,o;if(this.checkoutUiService.isCheckoutButtonDisabled())return;document.querySelectorAll(".fct-error-message").forEach(u=>u.remove()),this.payMethod=d(this,k).payMethod;const i=window["is_"+this.payMethod+"_ready"];if(this.payMethod!=="offline_payment"&&!i)return console.warn("Dev Warn FCT: Payment method is not ready yet!"),window.dispatchEvent(new CustomEvent("fluent_cart_validate_checkout_"+this.payMethod)),!1;d(this,k).disableCheckoutButton(this.translate("Processing Order..."));const s='<div class="loader"></div>';let n=document.querySelector(".fct-order-processing");n?(n.classList.remove("hidden"),n.style.display=""):(n=this.createProcessingDiv(s),document.body.appendChild(n)),this.removeValidationErrors();const a=(l=window.fluentCartCheckout)==null?void 0:l.beforeCheckoutCallbacks;let r=!0;if(Array.isArray(a)){for(let u of a)if(typeof u=="function"){let w=await u({paymentLoader:d(this,k)});r=r&&w}}if(r!==!1)try{const u=this.prepareFormData();this.removeValidationErrors();const f=await(await this.submitCheckoutForm(u)).json();if(f.status==="success")return(o=window.fluentCartUtmManager)==null||o.clear(),this.handleSuccessfulResponse(f),f;{if(f!=null&&f.errors&&typeof(f==null?void 0:f.errors)=="object"){let J="";for(const we in f.errors){const Se=f.errors[we],ve=Object.values(Se)[0];J+=ve+` 
`}return new Toastify({text:J,className:"warning",duration:1500}).showToast(),this.cleanupAfterProcessing(),!1}this.showValidationErrors(f==null?void 0:f.errors);let b=(f==null?void 0:f.message)||(f==null?void 0:f.message);return b&&this.showProductValidationError(b),this.cleanupAfterProcessing(),!1}}catch{return this.cleanupAfterProcessing(),!1}}createProcessingDiv(e){const t=document.createElement("div");return t.className="fct-order-processing",t.innerHTML=e+"<br/><div class='loading-status'>"+this.translate("Order Processing...")+"</div><div class='fct-browser-notify'>"+this.translate("Please Don't close the browser")+"</div>",t}prepareFormData(){const e=new FormData(this.form);e.append("_wpnonce",this.nonce);const t=window.fluentCartUtmManager.get();return Object.keys(t).forEach(i=>{const s=t[i];s&&e.append(`utm_data[${i}]`,s)}),e}async submitCheckoutForm(e){e.append("user_tz",d(this,pe));const t=new URLSearchParams;for(const[s,n]of e.entries())t.append(s,n);let i=this.checkoutUrl.toString();return await fetch(i,{method:"POST",headers:{"X-WP-Nonce":window.fluentCartCheckout.nonce,"Content-Type":"application/x-www-form-urlencoded"},body:t})}async handleSuccessfulResponse(e){var i,s;const t=(i=window.fluentCartCheckout)==null?void 0:i.afterCheckoutCallbacks;if(Array.isArray(t))for(let n of t)typeof n=="function"&&await n(e);e!=null&&e.redirect_to&&(this.buttonState("order_processing",this.translate("Please wait..."),e==null?void 0:e.buttonState),window.location.href=e.redirect_to),(e==null?void 0:e.actionName)==="custom"?window.dispatchEvent(new CustomEvent("fluent_cart_payment_next_action_"+(e==null?void 0:e.nextAction),{detail:{response:e}})):(e==null?void 0:e.actionName)==="redirect"&&(window.location.href=(s=e==null?void 0:e.payment_args)==null?void 0:s.checkout_url)}cleanupAfterProcessing(){const e=document.querySelector(".fct-order-processing");e&&(e.classList.add("hidden"),e.style.display="none"),d(this,k).enableCheckoutButton(this.translate("Place Order"))}removeValidationErrors(){document.querySelectorAll("[data-fluent-cart-checkout-page-form-input-wrapper]").forEach(e=>{e.classList.remove("has-error")}),document.querySelectorAll("[data-fluent-cart-checkout-page-form-error]").forEach(e=>{e.innerHTML=""}),document.querySelectorAll("[data-fluent-cart-checkout-page-form-section]").forEach(e=>{e.classList.remove("has-error")})}showProductValidationError(e=this.translate("Error! Please update cart items!")){new Toastify({text:'<span class="warn warning"></span>'+e,className:"warning",escapeMarkup:!1,duration:3e3,close:!0,style:{color:"#000",background:"#ffffff"}}).showToast()}showValidationErrors(e){if(!(!e||Object.keys(e).length<1))for(const t in e){const i=document.querySelectorAll("[data-fluent-cart-checkout-page-form-section]"),s=this.form.querySelector("#"+t);if(s){s.closest("[data-fluent-cart-checkout-page-form-input-wrapper]")&&s.closest("[data-fluent-cart-checkout-page-form-input-wrapper]").classList.add("has-error"),i.forEach(a=>a.classList.add("has-error"));const n=e[t];if(typeof n=="object"){let a="",r=0;const l=Object.entries(n).length;for(const u in n){a+=n[u],r!==l&&(a+="<br>"),r++;break}new Toastify({text:a,className:"warning",escapeMarkup:!1,duration:1500,style:{color:"#000",background:"#ffffff"}}).showToast(),t==="order_notes"&&new Toastify({text:'<span class="warn error"></span>'+a,className:"error",escapeMarkup:!1,duration:1500,style:{color:"#000",background:"#ffffff"}}).showToast();const o=`[data-fluent-cart-checkout-page-form-error][for="${s.name}"]`;document.querySelector(o).innerHTML=a,document.querySelector(o).classList.add("show_error")}}else if(t==="shipping_method"){const n=document.querySelector("[data-fluent-cart-checkout-page-shipping-methods-wrapper]");n&&(n.classList.add("has-error"),n.querySelector("[data-fluent-cart-checkout-page-form-error]").innerHTML=e[t])}else new Toastify({text:'<span class="warn warning"></span>'+this.translate("Validation Error! Please fill required fields!"),className:"warning",escapeMarkup:!1,duration:1300,style:{color:"#000",background:"#ffffff"}}).showToast()}}handleCartItemsCollapse(){this.form.addEventListener("click",e=>{e.target.closest("[data-fluent-cart-checkout-cart-items-toggle]")&&this.form.querySelector("[data-fluent-cart-checkout-page-cart-items-wrapper]").classList.toggle("box_closed")})}handleCouponItemsCollapse(){const e=document.querySelector("[data-fluent-cart-checkout-coupon-items-toggle]"),t=document.querySelector("[data-fluent-cart-checkout-coupon-items-wrapper]");e&&t&&e.addEventListener("click",()=>{e.classList.toggle("active"),t.style.display=t.style.display==="none"?"block":"none"})}handlePhoneInput(){const e=document.querySelector("[data-fluent-cart-checkout-page-form-input-wrapper][id='billing_phone_wrapper'] input"),t=document.querySelector("[data-fluent-cart-checkout-page-form-input-wrapper][id='shipping_phone_wrapper'] input"),i=s=>{s&&s.value.length>15&&(s.value=s.value.substring(0,15))};e&&(e.addEventListener("input",()=>i(e)),e.addEventListener("paste",()=>{setTimeout(()=>i(e),0)})),t&&(t.addEventListener("input",()=>i(t)),t.addEventListener("paste",()=>{setTimeout(()=>i(t),0)}))}handleOrderNotesToggle(){this.form.querySelectorAll("[data-fct-item-toggle-control]").forEach(t=>{t.addEventListener("click",()=>{const i=t.closest("[data-fct-item-toggle]");i&&i.classList.toggle("active")})}),d(this,U)&&d(this,U).addEventListener("click",()=>{d(this,U).classList.toggle("active"),d(this,me).classList.toggle("active")})}};he=new WeakMap,k=new WeakMap,ue=new WeakMap,Ge=new WeakMap,pe=new WeakMap,Ie=new WeakMap,Ae=new WeakMap,fe=new WeakMap,ge=new WeakMap,U=new WeakMap,me=new WeakMap,De=new WeakMap,Oe=new WeakMap,ye=new WeakSet,ze=function(){return window.fluentCartCart},g(Y,he,null);let Qe=Y,Mt={checkoutPageContainer:null,init(){if(this.checkoutPageContainer=document.querySelector("[data-fluent-cart-checkout-page]"),!this.checkoutPageContainer)return;let c=this.checkoutPageContainer.querySelector("form[data-fluent-cart-checkout-page-checkout-form]");return new Qe(this,c,{})}};window.addEventListener("load",function(){const c=document.querySelector("[data-fluent-cart-checkout-item-wrapper]");document.querySelector("[data-fluent-cart-checkout-subtotal]"),document.querySelectorAll("[data-fluent-cart-checkout-estimated-total]");let e=window.fluentcart_checkout_vars.ajaxurl+"?action=fluent_cart_checkout_routes&fc_checkout_action=get_checkout_summary_view";c&&window.addEventListener("fluentCartNotifyCartDrawerItemChanged",function(){fetch(v.buildUrl(e).toString(),{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(t=>t.json()).then(t=>{t.fragments&&v.handleFragments(t.fragments),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:t}}))}).catch(t=>{console.error("An error occurred:",t)})},!1),window.fluentCartCheckout=Mt.init(),window.fluentCartCheckout&&(window.fluentCartCheckout.beforeCheckoutCallbacks=[],window.fluentCartCheckout.afterCheckoutCallbacks=[]),setTimeout(()=>{window.dispatchEvent(new CustomEvent("fluent_cart_after_checkout_js_loaded",{}))},200)})});export default Vt();
