var Ve=Object.defineProperty;var Ee=(a,t,s)=>t in a?Ve(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var Le=(a,t,s)=>Ee(a,typeof t!="symbol"?t+"":t,s);import{a as u,c as h,o,d as e,e as w,w as n,u as m,b as $,f as l,t as c,F as T,h as H,n as oe,g as x,i as O,m as ee,p as re,k as me,j as de,q as X,D as Ce,l as Pe,K as j,aj as Ae,r as Te}from"./vue.esm-bundler-DZdE0M9V.js";import{C as R,c as B,d as N,T as Ue,_ as Me,P as Ie,a as Oe,g as Be}from"./RouteCell-DrtjJJDU.js";import{L as ne,_ as Ne}from"./NotFound-tC_jj0zn.js";import{_ as Fe,m as Se,a as Re,d as He,T as q,i as xe}from"./dateShortCuts-BXDLx_t9.js";import{_ as pe}from"./Empty-aPQNCX5s.js";import{t as p,A as ce}from"./Translator-Bios5QX5.js";import{A as ae}from"./Arr-MwYQQ3qa.js";import{I as ue,B as W,S as De}from"./Badge-CAEsoWyQ.js";import{a as ze,cq as je,b as qe}from"./index-DwF99AZu.js";import{_ as se,P as Ye,L as Ke,O as ie,e as We,d as Ge}from"./OrderCustomerInformation-DVrA669s.js";import{_ as G}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Y}from"./DynamicIcon-D-LZibaK.js";import{d as Z}from"./dayjs.min-2rai63wT.js";import{M as Xe}from"./Model-B7FTF6mI.js";import{R as $e}from"./Rest-DEQMhckH.js";import{f as Q,i as Ze}from"./common-D35bkMcN.js";import{a as _e,C as Je}from"./CopyToClipboard-BjLMcgNd.js";import{S as Qe}from"./Str-Ckn63bs5.js";import"./Url-D4lOoZOf.js";import"./timezone-C2U15obx.js";import"./Notify-CV-A2uNH.js";import"./Utils-DWmIjEEK.js";import"./Asset-DDfERlE5.js";import"./index-C83b7x36.js";import"./productService-BVWCmR6j.js";const et={class:"fct-license-settings fct-layout-width"},tt={key:1,class:"fct-license-settings-body"},nt={class:"fct-licensed-product-table hide-on-mobile"},at={class:"fct-media-with-content"},lt={class:"media"},st=["src","alt"],it={class:"title"},ot=["innerHTML"],rt=["innerHTML"],ct={class:"fct-product-pricing-table-item"},dt={class:"fct-licensed-product-table-mobile"},ut={class:"fct-licensed-product-table-mobile-col"},_t={class:"root-title"},mt={class:"fct-media-with-content"},pt={class:"media"},ht=["src","alt"],ft={class:"title"},gt=["innerHTML"],vt=["innerHTML"],bt={class:"fct-licensed-product-table-mobile-col"},yt={class:"root-title"},wt={class:"fct-product-pricing-table-item"},kt={key:0},Lt={class:"custom-wp-editor-wrapper relative"},Ct={class:"absolute mb-0 font-bold"},St={key:0,class:"setting-save-action"},Dt={name:"LicenseSettings",props:["product_id"],data(){return{settings:null,saving:!1,loading:!1,product:{},globalUpdateFile:{},selectedFile:null,fetchSettings:!1}},methods:{fetchProduct(){this.loading=!0,this.$get("products/"+this.product_id+"/pricing",{}).then(a=>{this.product=a.product}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})},getSettings(){this.fetchSettings=!0,this.$get(`licensing/products/${this.product_id}/settings`).then(a=>{var t,s;this.settings=a.settings,this.selectedFile=(t=a.settings.global_update_file)!=null&&t.id?parseInt((s=a.settings.global_update_file)==null?void 0:s.id):""}).catch(a=>{this.handleError(a)}).finally(()=>{this.fetchSettings=!1})},updateSettings(){this.saving=!0,this.$post(`licensing/products/${this.product_id}/settings`,{settings:this.settings}).then(a=>{this.handleSuccess(a.message)}).catch(a=>{this.handleError(a)}).finally(()=>{this.saving=!1})},imageUrl(a){var t;return a&&((t=a.meta_value)==null?void 0:t.length)>0?a.meta_value[0].url:this.appVars.asset_url+"images/empty-image.svg"},imageAlt(a){var t;return a&&((t=a.meta_value)==null?void 0:t.length)>0?a.meta_value[0].title:"No Image"}},mounted(){this.getSettings(),this.fetchProduct();const a=document.querySelector("#fct_admin_menu_holder .fct-admin-product-header");a&&document.querySelector("#fluent_cart_plugin_app").prepend(a)}},xt=Object.assign(Dt,{setup(a){return(t,s)=>{const L=u("el-switch"),r=u("el-skeleton"),i=u("el-table-column"),S=u("el-input"),C=u("el-table"),b=u("el-form-item"),D=u("el-col"),V=u("el-option"),y=u("el-select"),A=u("el-row"),v=u("el-form"),I=u("el-button");return o(),h("div",et,[e(N,null,{default:n(()=>[e(R,{border_bottom:"",title:m(p)("License Settings")},{action:n(()=>[t.settings?(o(),$(L,{key:0,modelValue:t.settings.enabled,"onUpdate:modelValue":s[0]||(s[0]=f=>t.settings.enabled=f),"active-value":"yes","inactive-value":"no","active-text":m(p)("Enable Licensing for this product")},null,8,["modelValue","active-text"])):w("",!0)]),_:1},8,["title"]),e(B,null,{default:n(()=>[t.fetchSettings?(o(),$(r,{key:0,rows:6,animated:!0})):w("",!0),t.settings&&!t.fetchSettings?(o(),h("div",tt,[t.settings.enabled==="yes"?(o(),$(v,{key:0,"label-position":"top",modelValue:t.settings,"onUpdate:modelValue":s[11]||(s[11]=f=>t.settings=f)},{default:n(()=>[e(b,null,{default:n(()=>[l("div",nt,[e(C,{ref:"elTable","row-key":f=>f.rowId,data:t.settings.variations},{default:n(()=>[e(i,{label:m(p)("Variant"),width:300},{default:n(f=>[l("div",at,[l("div",lt,[l("img",{src:t.imageUrl(f.row.media),alt:t.imageAlt(f.row.media)},null,8,st)]),l("div",null,[l("div",it,c(f.row.title),1),f.row.subscription_info?(o(),h("div",{key:0,class:"text",innerHTML:f.row.subscription_info},null,8,ot)):w("",!0),f.row.setup_fee_info?(o(),h("div",{key:1,class:"text",innerHTML:f.row.setup_fee_info},null,8,rt)):w("",!0)])])]),_:1},8,["label"]),e(i,{width:140},{header:n(()=>[e(ne,{title:m(p)("Activation Limit"),content:m(p)("Activation limit controls how many sites/devices can use this license. License validity matches your subscription interval. For example, an annual subscription will generate a license valid for one year.")},null,8,["title","content"])]),default:n(f=>[l("div",ct,[e(S,{type:"number",min:1,placeholder:m(p)("Use 0 or empty for no limit"),modelValue:f.row.activation_limit,"onUpdate:modelValue":U=>f.row.activation_limit=U},null,8,["placeholder","modelValue","onUpdate:modelValue"])])]),_:1})]),_:1},8,["row-key","data"])]),l("div",dt,[(o(!0),h(T,null,H(t.settings.variations,f=>(o(),h("div",{class:"fct-licensed-product-table-mobile-row",key:f.rowId},[l("div",ut,[l("div",_t,c(m(p)("Variant")),1),l("div",mt,[l("div",pt,[l("img",{src:t.imageUrl(f.media),alt:t.imageAlt(f.media)},null,8,ht)]),l("div",null,[l("div",ft,c(f.title),1),f.subscription_info?(o(),h("div",{key:0,class:"text",innerHTML:f.subscription_info},null,8,gt)):w("",!0),f.setup_fee_info?(o(),h("div",{key:1,class:"text",innerHTML:f.setup_fee_info},null,8,vt)):w("",!0)])])]),l("div",bt,[l("div",yt,[e(ne,{title:m(p)("Activation Limit"),content:m(p)("Activation limit controls how many sites/devices can use this license. License validity matches your subscription interval. For example, an annual subscription will generate a license valid for one year.")},null,8,["title","content"])]),l("div",wt,[e(S,{type:"number",min:1,placeholder:m(p)("Use 0 or empty for no limit"),modelValue:f.activation_limit,"onUpdate:modelValue":U=>f.activation_limit=U},null,8,["placeholder","modelValue","onUpdate:modelValue"])])])]))),128))])]),_:1}),e(A,{gutter:20},{default:n(()=>[e(D,{lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("Version Number"),content:m(p)("Enter the current version number of your product.")},null,8,["title","content"])]),default:n(()=>[e(S,{placeholder:m(p)("Your Product Version"),modelValue:t.settings.version,"onUpdate:modelValue":s[1]||(s[1]=f=>t.settings.version=f)},null,8,["placeholder","modelValue"])]),_:1})]),_:1}),e(D,{lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("License Key Prefix (Optional)"),content:m(p)("If you add any prefix here then it will will be used as the prefix of the generated license key")},null,8,["title","content"])]),default:n(()=>[e(S,{placeholder:m(p)("Your License Key Prefix"),modelValue:t.settings.prefix,"onUpdate:modelValue":s[2]||(s[2]=f=>t.settings.prefix=f)},null,8,["placeholder","modelValue"])]),_:1})]),_:1}),t.fetchSettings?w("",!0):(o(),$(D,{key:0,lg:8},{default:n(()=>[e(b,null,{label:n(()=>[e(ne,{title:m(p)("Update File"),content:m(p)("Update File (Choose the source file to get automatic updates)")},null,8,["title","content"])]),default:n(()=>{var f,U;return[((U=(f=t.product)==null?void 0:f.downloadable_files)==null?void 0:U.length)===0?(o(),h("span",kt,c(m(p)("No downloadable files found")),1)):(o(),$(y,{key:1,modelValue:t.settings.global_update_file,"onUpdate:modelValue":s[3]||(s[3]=_=>t.settings.global_update_file=_),placeholder:m(p)("Update File")},{default:n(()=>[(o(!0),h(T,null,H(t.product.downloadable_files,_=>(o(),$(V,{key:_.id,label:_.title,value:_.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]))]}),_:1})]),_:1}))]),_:1}),e(b,null,{default:n(()=>[l("div",Lt,[l("label",Ct,c(m(p)("Changelog Description")),1),e(Fe,{modelValue:t.settings.changelog,onUpdate:s[4]||(s[4]=f=>{t.settings.changelog=f})},null,8,["modelValue"])])]),_:1}),l("div",{class:oe("is-wp-product-wrap "+(t.settings.wp.is_wp==="yes"?"pb-0":""))},[l("div",{class:oe(t.settings.wp.is_wp==="yes"?"pb-4":"")},[e(L,{modelValue:t.settings.wp.is_wp,"onUpdate:modelValue":s[5]||(s[5]=f=>t.settings.wp.is_wp=f),"active-value":"yes","inactive-value":"no","active-text":m(p)("Is WP Plugin?")},null,8,["modelValue","active-text"])],2),t.settings.wp.is_wp==="yes"?(o(),h(T,{key:0},[e(b,{label:m(p)("Changelog Page URL")},{default:n(()=>[e(S,{placeholder:m(p)("Your Product Changelog Page URL"),modelValue:t.settings.wp.readme_url,"onUpdate:modelValue":s[6]||(s[6]=f=>t.settings.wp.readme_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"]),e(A,{gutter:20},{default:n(()=>[e(D,{md:12},{default:n(()=>[e(b,{label:m(p)("Banner URL")},{default:n(()=>[e(S,{placeholder:m(p)("Plugin Banner URL"),modelValue:t.settings.wp.banner_url,"onUpdate:modelValue":s[7]||(s[7]=f=>t.settings.wp.banner_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12},{default:n(()=>[e(b,{label:m(p)("Icon URL")},{default:n(()=>[e(S,{placeholder:m(p)("Plugin Icon URL"),modelValue:t.settings.wp.icon_url,"onUpdate:modelValue":s[8]||(s[8]=f=>t.settings.wp.icon_url=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12,xs:24},{default:n(()=>[e(b,{label:m(p)("Required PHP Version (optional)")},{default:n(()=>[e(S,{placeholder:m(p)("Required PHP Version"),modelValue:t.settings.wp.required_php,"onUpdate:modelValue":s[9]||(s[9]=f=>t.settings.wp.required_php=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1}),e(D,{md:12,xs:24},{default:n(()=>[e(b,{label:m(p)("Required WP Version (optional)")},{default:n(()=>[e(S,{placeholder:m(p)("Required WP Version"),modelValue:t.settings.wp.required_wp,"onUpdate:modelValue":s[10]||(s[10]=f=>t.settings.wp.required_wp=f)},null,8,["placeholder","modelValue"])]),_:1},8,["label"])]),_:1})]),_:1})],64)):w("",!0)],2)]),_:1},8,["modelValue"])):w("",!0),t.settings.enabled!=="yes"?(o(),$(pe,{key:1,icon:"Empty/WebPage",text:m(p)("License for this product has not been enabled")},null,8,["text"])):w("",!0)])):w("",!0)]),_:1})]),_:1}),t.settings?(o(),h("div",St,[e(I,{onClick:s[12]||(s[12]=f=>t.updateSettings()),loading:t.saving,disabled:t.saving,type:"primary"},{default:n(()=>[x(c(m(p)(" Update Settings")),1)]),_:1},8,["loading","disabled"])])):w("",!0)])}}});class $t extends Ue{setupInitialData(){super.setupInitialData(),this.data.sorting.sortBy="order_id"}getTabs(){return{all:p("All"),active:p("Active"),inactive:p("Inactive"),expired:p("Expired"),disabled:p("Disabled")}}getToggleableColumns(){return[{label:p("Order ID"),value:"order_id"},{label:p("Product"),value:"product"},{label:p("Customer"),value:"customer"},{label:p("Date"),value:"date"}]}getSortableColumns(){return[{label:"Order ID",value:"order_id"},{label:"Activation Count",value:"activation_count"},{label:"Expiration Date",value:"expiration_date"},{label:"Date",value:"created_at"},{label:"Status",value:"status"}]}getSearchHint(){return p("by license key, order id, customer name/email or connected sites.")}getFetchUrl(){return"licensing/licenses"}parseResponse(t){return t.licenses}getTableName(){return"licenses"}getAdvanceFilterOptions(){return ae.get(window,"fluentCartAdminApp.filter_options.license_filter_options.advance")}getSearchGuideOptions(){return ae.get(window,"fluentCartAdminApp.filter_options.license_filter_options.guide")}with(){return["customer","product:ID,post_title","productVariant:id,variation_title"]}}function Vt(a){return $t.init(a)}class Et extends Xe{constructor(){super(...arguments);Le(this,"data",{summaryData:[],lineChartData:[],pieChartData:[],isBusy:!1})}get controllerKey(){return"LicenseReportController"}beforeInit(){}makeRequest(s,L,r,i){this.data.isBusy=!0,typeof L!="object"&&(L={});const S=$e.get(`reports/${s}`,L);return this.resolvePromiseResponse(S,r,i),S}resolvePromiseResponse(s,L=null,r=null){s.then(i=>{r==null||L==null||(this.data[r]=i[L])}).catch(i=>{console.log(i,"error")}).finally(()=>{this.data.isBusy=!1})}getLicenseLineChart(s={}){return this.makeRequest("license-chart",s,"lineChartData","lineChartData")}getLicensePieChart(s={}){return this.makeRequest("license-pie-chart",s,"pieChartData","pieChartData")}getSummary(s={}){return this.makeRequest("license-summary",s,"summaryData","summaryData")}}const F=Et.init(),Pt={class:"fct-license-statistics-wrap"},At={class:"fct-btn-group sm"},Tt={class:"chart-action-wrap"},Ut={class:"chart-change-wrap"},Mt={class:"chart-change"},It={class:"text"},Ot={class:"chart-change"},Bt={class:"text"},Nt={__name:"LicenseStatistics",props:{reportFilter:{type:Object}},setup(a){const t=a,s=O(null),L=O("daily"),r=O("line"),i=O([Z().startOf("month"),Z()]),S=[{value:"daily",label:"Daily"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],C=ee(()=>[{title:"Total License",key:"total_license",color:"#2ecc71"}].map(({title:_,key:d,color:k},g)=>v(_,r.value,g%2,F.data.lineChartData.map(M=>M.license_count),k))),b=ee(()=>F.data.lineChartData.map(_=>{if(L.value==="daily"){const[d,k,g]=_.date.split("-");return`${Se[parseInt(k)-1]} ${g}, ${d}`}else{if(L.value==="monthly")return`${Se[parseInt(_.month)-1]} ${_.year}`;if(L.value==="yearly")return`${_.year}`}}));let D=null;const V=()=>{s.value&&D===null&&(D=xe(s.value),y())},y=()=>{const _={title:{text:t.chartTitle??"",left:"center"},legend:{show:!1},tooltip:{trigger:"axis",backgroundColor:q.isDark()?"#38485a":"#ffffff",borderColor:q.isDark()?"#4a5a6b":"#c0c4ca",borderWidth:1,textStyle:{color:q.isDark()?"#ffffff":"#565865"}},xAxis:{type:"category",data:b.value,axisLabel:{color:q.isDark()?"#ffffff":"#565865",fontSize:12}},yAxis:[{type:"value",axisLabel:{color:q.isDark()?"#ffffff":"#565865",fontSize:12},splitLine:{show:!0,lineStyle:{color:q.isDark()?"#38485a":"#D6DAE1"}}},{type:"value",position:"right",axisLabel:{color:q.isDark()?"#ffffff":"#565865",fontSize:12},splitLine:{show:!1}}],dataZoom:[],series:C.value};D.setOption(_,{notMerge:!0,replaceMerge:["series"]})},A=()=>{const _={startDate:i.value[0].toISOString(),endDate:i.value[1].toISOString()};F.getLicenseLineChart({params:{..._,groupKey:L.value}})},v=(_,d,k,g,M)=>({name:_,type:d,yAxisIndex:k,data:g,smooth:!0,color:M,lineStyle:{width:3}}),I=()=>{A()},f=()=>{A()},U=_=>{r.value!==_&&(r.value=_,y())};return re([()=>F.chartData,r],()=>{X(y)},{deep:!0}),re(()=>F.data.lineChartData,()=>{X(()=>{y()})},{deep:!0}),me(()=>{window.removeEventListener("onFluentCartThemeChange",y,!1)}),de(()=>{window.addEventListener("onFluentCartThemeChange",y),A(),X(V)}),(_,d)=>{const k=u("el-option"),g=u("el-select"),M=u("el-date-picker");return o(),h("div",Pt,[e(N,{id:"chartContainer"},{default:n(()=>[e(R,{title:_.$t("License Chart"),title_size:"small",border_bottom:""},{action:n(()=>[l("div",At,[e(Re,{activeType:r.value,types:{line:"LineChart",bar:"BarChart"},onChange:U},null,8,["activeType"]),e(g,{class:"w-[100px] el-select--x-small",modelValue:L.value,"onUpdate:modelValue":d[0]||(d[0]=E=>L.value=E),onChange:f},{default:n(()=>[(o(),h(T,null,H(S,E=>e(k,{key:E.value,label:_.$t(E.label),value:E.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(M,{class:"w-[220px] el-range-editor--x-small hide-close-icon",modelValue:i.value,"onUpdate:modelValue":d[1]||(d[1]=E=>i.value=E),type:"daterange","range-separator":"-","start-placeholder":_.$t("Start date"),"end-placeholder":_.$t("End date"),"unlink-panels":"",clearable:!1,shortcuts:m(He),onChange:I},null,8,["modelValue","start-placeholder","end-placeholder","shortcuts"])])]),_:1},8,["title"]),e(B,null,{default:n(()=>[l("div",{class:"fct-license-statistics-chart",ref_key:"chartRef",ref:s},null,512),l("div",Tt,[l("div",Ut,[l("div",Mt,[d[2]||(d[2]=l("svg",{width:"9",height:"11",viewBox:"0 0 9 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M4.6087 10.5L4.6087 1.46395",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M1.00004 4.05762L4.55764 0.500019L8.11523 4.05762",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),l("span",It,c(_.$t("Data")),1)]),l("div",Ot,[l("span",Bt,c(_.$t("Timeline")),1),d[3]||(d[3]=l("svg",{class:"rotate-90",width:"9",height:"11",viewBox:"0 0 9 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[l("path",{d:"M4.6087 10.5L4.6087 1.46395",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"}),l("path",{d:"M1.00004 4.05762L4.55764 0.500019L8.11523 4.05762",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"})],-1))])])])]),_:1})]),_:1})])}}},Ft={class:"fct-usage-statistics-chart-wrap"},Rt={class:"fct-usage-statistics-info flex items-center justify-between"},Ht={class:"text-lg font-semibold text-system-dark dark:text-gray-50"},zt={class:"text-xs font-medium text-system-mid dark:text-gray-300"},jt={class:"fct-custom-legend",style:{width:"100%"}},qt={style:{margin:"0 0 15px 0","font-size":"14px","font-weight":"600"}},Yt={class:"legend-items"},Kt=["onClick","onMouseenter","onMouseleave"],Wt={style:{flex:"1","min-width":"0"}},Gt={style:{display:"flex","justify-content":"space-between","align-items":"center"}},Xt=["title"],Zt={class:"legend-item-percentage"},Jt={class:"legend-item-count"},Qt={class:"fct-custom-legend-controls"},en={class:"fct-action-link-btn"},tn={class:"fct-chart-container",style:{display:"flex","align-items":"flex-start"}},nn={__name:"UsageStatistics",props:{reportFilter:{type:Object},activatedSites:String|Number},setup(a){const t=a,s=q.colors;s.blue;const L=O(null),r=O("daily"),i=O("pie"),S=O([Z().startOf("month"),Z()]),C=O({}),b=ee(()=>F.data.pieChartData?F.data.pieChartData.map((k,g)=>({name:k.post_title,value:k.activation_count,percentage:k.percentage,color:D(g),visible:C.value[k.post_title]!==!1})):[]),D=k=>{const g=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc","#ffb347"];return g[k%g.length]},V=ee(()=>F.data.pieChartData.filter(k=>C.value[k.post_title]!==!1).map((k,g)=>({value:k.activation_count,name:k.post_title,itemStyle:{color:D(F.data.pieChartData.findIndex(M=>M.post_title===k.post_title))}})));let y=null;const A=()=>{L.value&&y===null&&(y=xe(L.value),v())},v=()=>{if(!y)return;const k={title:{text:t.chartTitle??"",left:"center"},legend:{show:!1},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)",borderRadius:8,backgroundColor:q.isDark()?"#38485a":"#ffffff",textStyle:{color:q.isDark()?s.gray[25]:s.system.mid},borderColor:q.isDark()?"#4a5a6b":"#c0c4ca",borderWidth:1},series:[{type:"pie",radius:"55%",center:["50%","50%"],data:V.value,label:{show:!0,color:q.isDark()?s.gray[25]:s.system.dark},emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};y.setOption(k,{notMerge:!0,replaceMerge:["series"]})},I=k=>{C.value[k.name]=!k.visible,X(()=>{v()})},f=(k,g)=>{y&&(g?y.dispatchAction({type:"highlight",name:k.name}):y.dispatchAction({type:"downplay",name:k.name}))},U=()=>{const k={startDate:S.value[0].toISOString(),endDate:S.value[1].toISOString()};F.getLicensePieChart({params:{...k,groupKey:r.value}})},_=()=>{F.data.pieChartData&&F.data.pieChartData.forEach(k=>{k.post_title in C.value||(C.value[k.post_title]=!0)})};re([()=>F.chartData,i],()=>{X(v)},{deep:!0}),re(()=>F.data.pieChartData,()=>{_(),X(()=>{v()})},{deep:!0});const d=k=>{v()};return de(()=>{window.addEventListener("onFluentCartThemeChange",d),U(),X(A)}),me(()=>{window.removeEventListener("onFluentCartThemeChange",d)}),(k,g)=>{const M=u("el-popover");return o(),h("div",Ft,[l("div",Rt,[l("div",Ht,[x(c(a.activatedSites)+" ",1),l("div",zt,c(k.$t("Total Activated Sites")),1)]),e(M,{placement:"bottom-start",width:226,trigger:"click","popper-class":"fct-license-statistics-popover"},{reference:n(()=>[l("div",en,[e(ue,null,{default:n(()=>[e(Y,{name:"More"})]),_:1})])]),default:n(()=>[l("div",jt,[l("h4",qt,c(k.$t("License Distribution")),1),l("div",Yt,[(o(!0),h(T,null,H(b.value,E=>(o(),h("div",{key:E.name,class:oe(["legend-item",{"legend-item-hidden":!E.visible}]),onClick:J=>I(E),onMouseenter:J=>f(E,!0),onMouseleave:J=>f(E,!1),style:Ce({opacity:E.visible?1:.5})},[l("div",{class:"legend-color",style:Ce({backgroundColor:E.color})},null,4),l("div",Wt,[l("div",Gt,[l("span",{class:"legend-item-name",title:E.name},c(E.name),9,Xt),l("span",Zt,c(E.percentage)+"% ",1)]),l("div",Jt,c(m(p)("%s licenses",E.value.toLocaleString())),1)])],46,Kt))),128))]),l("div",Qt,[l("button",{onClick:g[0]||(g[0]=()=>{Object.keys(C.value).forEach(E=>C.value[E]=!0),X(v)})},c(k.$t("Show All")),1),l("button",{onClick:g[1]||(g[1]=()=>{Object.keys(C.value).forEach(E=>C.value[E]=!1),X(v)})},c(k.$t("Hide All")),1)])])]),_:1})]),l("div",tn,[l("div",{class:"fct-usage-statistics-chart",ref_key:"chartRef",ref:L,style:{flex:"1",height:"350px"}},null,512)])])}}},an=G(nn,[["__scopeId","data-v-2fd9c692"]]),ln={},sn={class:"p-4 bg-gray-25 rounded dark:bg-primary-500"},on={class:"flex items-center gap-2 mb-3"},rn={class:"right flex flex-col flex-1 gap-2"};function cn(a,t){const s=u("el-skeleton-item"),L=u("el-skeleton");return o(),h(T,null,H(4,r=>e(L,{animated:"",key:r},{template:n(()=>[l("div",sn,[l("div",on,[e(s,{variant:"p",class:"rounded w-10 h-10 block"}),l("div",rn,[e(s,{variant:"p",class:"rounded w-4/5 block"}),e(s,{variant:"p",class:"rounded w-1/2 block"})])]),l("div",null,[e(s,{variant:"p",class:"rounded w-2/3 block"})])])]),_:2},1024)),64)}const dn=G(ln,[["render",cn]]),un={name:"LicensesStatsCard",props:{licenseOverview:{type:Object,required:!0},loading:{type:Boolean}},components:{DynamicIcon:Y,LicenseStatLoader:dn},methods:{translate:p}},_n={class:"licenses-stats-card-head"},mn={class:"licenses-icon"},pn={class:"licenses-stats-card-head-content"},hn={class:"title"},fn={class:"value"},gn={class:"text"};function vn(a,t,s,L,r,i){const S=u("LicenseStatLoader"),C=u("DynamicIcon");return s.loading?(o(),$(S,{key:0})):(o(!0),h(T,{key:1},H(s.licenseOverview,(b,D)=>(o(),h("div",{class:oe(`licenses-stats-card ${D}`),key:D},[l("div",_n,[l("div",mn,[e(C,{name:b.icon},null,8,["name"])]),l("div",pn,[l("div",hn,c(i.translate(b.title)),1),l("div",fn,c(b.value),1)])]),l("div",gn,c(i.translate(b.text)),1)],2))),128))}const bn=G(un,[["render",vn]]),yn={name:"LicenseStats",props:{licenses:{type:Array,required:!0}},components:{DynamicIcon:Y,CardBody:B,CardHeader:R,CardContainer:N,LicenseStatistics:Nt,UsageStatistics:an,LicensesStatsCard:bn},data(){return{loading:!1,licenseSummary:{}}},methods:{translate:p,fetchSummary(){this.loading=!0,this.$get("reports/license-summary",{params:{start_date:Z().startOf("month").format("YYYY-MM-DD"),end_date:Z().format("YYYY-MM-DD")}}).then(a=>{this.licenseSummary=a.summaryData}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})}},computed:{totalLicensedProducts(){var a;return((a=this.licenseSummary)==null?void 0:a.totalLicensedProducts)||0},totalActivatedSites(){var a;return((a=this.licenseSummary)==null?void 0:a.totalActivatedSites)||0},totalActiveLicense(){var a;return((a=this.licenseSummary)==null?void 0:a.totalActiveLicense)||this.licenses.filter(t=>t.status==="active").length},totalExpiredLicense(){var a;return((a=this.licenseSummary)==null?void 0:a.totalExpiredLicense)||this.licenses.filter(t=>t.status==="expired").length},totalInactiveLicense(){var a;return((a=this.licenseSummary)==null?void 0:a.totalInactiveLicense)||this.licenses.filter(t=>t.status==="inactive").length},licenseOverview(){return{"license-product":{title:"Licensed Product",value:this.totalLicensedProducts,text:`Active License ${this.totalActiveLicense}`,icon:"LicensedProduct"},"total-active":{title:"Total Active",value:this.totalActiveLicense,text:`New Active License ${this.totalActiveLicense}`,icon:"CheckCircle"},"total-expired":{title:"Total Expired",value:this.totalExpiredLicense,text:`New Expired License ${this.totalExpiredLicense}`,icon:"Warning"},"inactive-license":{title:"Inactive License",value:this.totalInactiveLicense,text:"Individual Sites",icon:"LicensedInactive"}}}},mounted(){this.fetchSummary()}},wn={class:"fct-license-stats-wrap"},kn={class:"licenses-stats-row"},Ln={class:"fct-usage-statistics-wrap"};function Cn(a,t,s,L,r,i){const S=u("CardHeader"),C=u("LicensesStatsCard"),b=u("CardBody"),D=u("CardContainer"),V=u("LicenseStatistics"),y=u("el-col"),A=u("el-skeleton"),v=u("UsageStatistics"),I=u("el-row");return o(),h("div",wn,[e(D,null,{default:n(()=>[e(S,{title:i.translate("Overall License Stats"),border_bottom:"",title_size:"small"},null,8,["title"]),e(b,null,{default:n(()=>[l("div",kn,[e(C,{licenseOverview:i.licenseOverview,loading:r.loading},null,8,["licenseOverview","loading"])])]),_:1})]),_:1}),e(I,{gutter:30},{default:n(()=>[e(y,{md:24,lg:16},{default:n(()=>[e(V)]),_:1}),e(y,{md:24,lg:8},{default:n(()=>[e(D,null,{default:n(()=>[e(S,{title:i.translate("Usage Statistics"),border_bottom:"",title_size:"small"},null,8,["title"]),e(b,null,{default:n(()=>[l("div",Ln,[r.loading?(o(),$(A,{key:0,animated:"",rows:4})):(o(),$(v,{key:1,activatedSites:i.totalActivatedSites},null,8,["activatedSites"]))])]),_:1})]),_:1})]),_:1})]),_:1})])}const Sn=G(yn,[["render",Cn]]),Dn={class:"table-cell"},xn={class:"w-full flex flex-col items-start justify-start gap-1"},$n={class:"table-cell"},Vn={class:"w-full flex flex-col items-start justify-start gap-1"},En={class:"table-cell"},Pn={class:"table-cell"},An={class:"table-cell"},Tn={__name:"LicensesLoader",props:{nextPageCount:{type:Number,default:0},licenseTable:{type:Object,default:()=>({})}},setup(a){const t=a,s=r=>t.licenseTable.columns.includes(r),L=Array.from({length:t.nextPageCount},(r,i)=>i+1);return(r,i)=>{const S=u("el-table-column"),C=u("el-skeleton-item"),b=u("el-table"),D=u("el-skeleton");return o(),$(D,{animated:""},{template:n(()=>[e(b,{data:m(L),class:"w-full compact-table responsive"},{empty:n(()=>i[0]||(i[0]=[])),default:n(()=>[w("",!0),e(S,{label:r.$t("License Key"),width:220},{default:n(()=>[l("div",Dn,[l("div",xn,[e(C,{varient:"p",class:"w-1/5"}),e(C,{varient:"p",class:"w-3/5"})])])]),_:1},8,["label"]),s("product")!==-1?(o(),$(S,{key:1,width:200,label:r.$t("Product")},{default:n(()=>[l("div",$n,[l("div",Vn,[e(C,{varient:"p",class:"w-1/5"}),e(C,{varient:"p",class:"w-2/5"})])])]),_:1},8,["label"])):w("",!0),s("order_id")!==-1?(o(),$(S,{key:2,width:80,label:r.$t("Order ID")},{default:n(()=>[l("div",En,[e(C,{varient:"p",class:"w-3/5"})])]),_:1},8,["label"])):w("",!0),s("customer")!==-1?(o(),$(S,{key:3,width:100,label:r.$t("Customer")},{default:n(()=>[l("div",Pn,[e(C,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])):w("",!0),e(S,{width:"100",label:r.$t("Activations")},{default:n(()=>[l("div",An,[e(C,{varient:"p",class:"w-4/5"})])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1})}}},Un={},Mn={class:"px-4 py-3"},In={class:"grid grid-cols-3 gap-5 mt-5"};function On(a,t){const s=u("el-skeleton-item"),L=u("el-skeleton");return o(),$(L,{animated:""},{template:n(()=>[l("div",Mn,[(o(),h(T,null,H(2,r=>l("div",{key:r,class:"flex items-center justify-between mb-3"},[e(s,{varient:"p",class:"w-1/2"}),e(s,{varient:"p",class:"w-[100px]"})])),64)),l("div",In,[(o(),h(T,null,H(3,r=>l("div",{key:r},[e(s,{varient:"p",class:"w-1/2"}),e(s,{varient:"p",class:"w-[100px]"})])),64))])])]),_:1})}const Bn=G(Un,[["render",On]]),Nn={name:"LicenseTableMobile",components:{ProductInfo:Ye,UserCan:se,RouteCell:Me,DynamicIcon:Y,IconButton:ue,CopyToClipboard:_e,Empty:pe,Badge:W},props:{licenses:{type:Array,required:!0},columns:{type:Array,default(){return["product","order_id","customer","date"]}},emptyText:{type:String,default:p("No Licenses found based on your filter")}},computed:{Clipboard(){return Je},formattedLicense(){return this.licenses.map(a=>{var t;return{...a,product:{...a.product,variation_title:((t=a.product_variant)==null?void 0:t.variation_title)||"n/a"}}})}},methods:{translate:p,formatDate:Q}},Fn={class:"fct-table-mobile-wrap fct-licenses-table-mobile"},Rn=["onClick"],Hn={class:"fct-table-status-col"},zn={key:0,class:"fct-table-date-col"},jn={key:0},qn={key:1},Yn={class:"fct-table-mobile-body"},Kn=["onClick"],Wn={class:"fct-license-key-wrap has-bg"},Gn={class:"fct-license-key"},Xn={class:"fct-license-key-inner pr-2"},Zn={class:"fct-table-mobile-footer"},Jn={class:"fct-table-mobile-footer-row"},Qn={key:0,class:"fct-table-id-col"},ea={class:"title"},ta={key:1,class:"fct-table-customer-col"},na={class:"title"},aa={class:"fct-table-activations-col"},la={class:"title"},sa={key:0,class:"py-6 text-center"};function ia(a,t,s,L,r,i){const S=u("Badge"),C=u("ProductInfo"),b=u("router-link"),D=u("DynamicIcon"),V=u("el-tooltip"),y=u("Empty"),A=u("UserCan");return o(),$(A,{permission:"licenses/view"},{default:n(()=>[l("div",Fn,[(o(!0),h(T,null,H(i.formattedLicense,(v,I)=>(o(),h("div",{key:v.id,class:"fct-table-mobile-row"},[l("div",{class:"fct-table-mobile-header",onClick:f=>a.$router.push({name:"view_license",params:{license_id:v==null?void 0:v.id}})},[l("div",Hn,[(o(),$(S,{status:v.status,key:v.id},null,8,["status"]))]),s.columns.indexOf("date")!==-1?(o(),h("div",zn,[l("span",null,c(i.formatDate(v.created_at)),1),t[0]||(t[0]=l("span",{class:"px-1"},"-",-1)),v.expiration_date?(o(),h("span",jn,c(i.formatDate(v.expiration_date)),1)):(o(),h("span",qn,c(i.translate("Lifetime")),1))])):w("",!0)],8,Rn),l("div",Yn,[s.columns.indexOf("product")!==-1?(o(),h("div",{key:0,class:"fct-table-product-col",onClick:f=>a.$router.push({name:"view_license",params:{license_id:v==null?void 0:v.id}})},[e(C,{product:v.product,hideProductId:!0,hideViewIcon:!0,hideImage:!0},null,8,["product"])],8,Kn)):w("",!0),l("div",Wn,[l("div",Gn,[l("div",Xn,[e(b,{class:"link",to:{name:"view_license",params:{license_id:v==null?void 0:v.id}}},{default:n(()=>[x(c(v.license_key),1)]),_:2},1032,["to"])]),e(V,{content:v.license_key,placement:"top","popper-class":"fct-tooltip"},{default:n(()=>[e(D,{class:"cursor-pointer p-1 w-6 h-6",name:"Copy",onClick:()=>{i.Clipboard.copy(v.license_key,{successMessage:i.translate("License Key copied to clipboard"),errorMessage:i.translate("Failed to copy License Key")})}},null,8,["onClick"])]),_:2},1032,["content"])])])]),l("div",Zn,[l("div",Jn,[s.columns.indexOf("order_id")!==-1?(o(),h("div",Qn,[l("div",ea,c(i.translate("Order ID")),1),e(b,{class:"value",to:{name:"view_order",params:{order_id:v.order_id}}},{default:n(()=>[x(" #"+c(v.order_id),1)]),_:2},1032,["to"])])):w("",!0),s.columns.indexOf("customer")!==-1?(o(),h("div",ta,[l("div",na,c(i.translate("Customer")),1),e(b,{class:"value",to:{name:"view_customer",params:{customer_id:v.customer_id}}},{default:n(()=>{var f;return[x(c(((f=v==null?void 0:v.customer)==null?void 0:f.full_name)||i.translate("No Name")),1)]}),_:2},1032,["to"])])):w("",!0),l("div",aa,[l("div",la,c(i.translate("Activations")),1),e(b,{class:"value",to:{name:"view_license",params:{license_id:v==null?void 0:v.id}}},{default:n(()=>[x(c(v.activation_count)+" "+c("/")+" "+c(v.limit===0?"Unlimited":v.limit),1)]),_:2},1032,["to"])])])])]))),128)),i.formattedLicense.length===0?(o(),h("div",sa,[e(y,{icon:"Empty/ListView","has-dark":"",text:s.emptyText},null,8,["text"])])):w("",!0)])]),_:1})}const oa=G(Nn,[["render",ia]]),ra={class:"fct-all-license-page fct-layout-width"},ca={class:"fct-all-license-wrap"},da={key:1},ua={__name:"Licenses",setup(a){const t=Vt(),s=O(!1),L=O(!1),r=()=>{L.value=window.innerWidth<768},i=C=>{C==="show_license_stats"&&(De.set("show_license_stats",!s.value),s.value=!s.value)},S=()=>{const C=De.get("show_license_stats");C&&(s.value=C)};return de(()=>{S(),r(),window.addEventListener("resize",r)}),me(()=>{window.removeEventListener("resize",r)}),(C,b)=>{const D=u("el-icon"),V=u("el-button"),y=u("el-dropdown-item"),A=u("el-dropdown-menu"),v=u("el-dropdown");return o(),h("div",ra,[e(Ie,{title:m(p)("Licenses")},{action:n(()=>[e(se,{permission:"reports/view"},{default:n(()=>[e(v,{trigger:"click","popper-class":"fct-dropdown",onCommand:i,placement:"bottom-end"},{dropdown:n(()=>[e(A,null,{default:n(()=>[e(y,{command:"show_license_stats"},{default:n(()=>[s.value?(o(),h(T,{key:1},[e(Y,{name:"EyeOff"}),x(" "+c(m(p)("Hide License Stats")),1)],64)):(o(),h(T,{key:0},[e(Y,{name:"Eye"}),x(" "+c(m(p)("Show License Stats")),1)],64))]),_:1})]),_:1})]),default:n(()=>[e(V,null,{default:n(()=>[x(c(m(p)("More actions"))+" ",1),e(D,null,{default:n(()=>[e(m(ze))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"]),e(se,{permission:"reports/view"},{default:n(()=>[s.value?(o(),$(Sn,{key:0,licenses:m(t).getTableData()},null,8,["licenses"])):w("",!0)]),_:1}),e(se,{permission:"licenses/view"},{default:n(()=>[l("div",ca,[e(Oe,{table:m(t),classicTabStyle:!0,"has-mobile-slot":!0},{mobile:n(()=>[m(t).isLoading()?(o(),$(Bn,{key:0})):w("",!0),m(t).isLoading()?w("",!0):(o(),$(oa,{key:1,licenses:m(t).getTableData(),columns:m(t).data.columns},null,8,["licenses","columns"]))]),default:n(()=>[m(t).isLoading()?(o(),$(Tn,{key:0,licenseTable:m(t),"next-page-count":m(t).nextPageCount},null,8,["licenseTable","next-page-count"])):(o(),h("div",da,[e(Ke,{licenses:m(t).getTableData(),columns:m(t).data.columns},null,8,["licenses","columns"])]))]),_:1},8,["table"])])]),_:1})])}}},_a={class:"el-form--label-top fct-plan-changer-content-wrap"},ma={key:0},pa=["innerHTML"],ha={key:1},fa=["innerHTML"],ga={key:1,class:"fct-btn-group"},va={__name:"PlanChanger",props:{variations:{},product_id:"",variation_id:"",license:null,order:null,upgrade_path_base:""},setup(a){const t=a,s=O(!1),L=()=>{s.value=!0},r=Pe().ctx,i=O(""),S=O([]);let C=O(null);const b=ee(()=>{var _,d;return ce.get("shop.currency_sign")?ce.get("shop.currency_sign"):(d=(_=window.fluentcart_customer_profile_vars)==null?void 0:_.shop)!=null&&d.currency_sign?window.fluentcart_customer_profile_vars.shop.currency_sign:""}),D=ee(()=>{var _;return(_=t.order)==null?void 0:_.order_items.find(d=>d.payment_type==="subscription"||d.payment_type==="adjustment"||d.payment_type==="onetime")}),V=function(_){let d="";const k=_==null?void 0:_.payment_type,g=_==null?void 0:_.other_info;if((g==null?void 0:g.payment_type)==="subscription"&&k!=="adjustment"){(g==null?void 0:g.manage_setup_fee)==="yes"&&(d+=g.signup_fee_name+" : "+b.value+parseFloat(g.signup_fee/100)+", ");const M=Number(g==null?void 0:g.times)?(g==null?void 0:g.times)+" times":", Until Cancel";return d+=(_==null?void 0:_.formatted_total)+" Subscriptions "+g.repeat_interval+" "+M,d}else if((g==null?void 0:g.payment_type)==="subscription"&&k==="adjustment"){(g==null?void 0:g.manage_setup_fee)==="yes"&&(d+=g.signup_fee_name+" :"+parseFloat(g.signup_fee/100)+", ");const M=Number(g==null?void 0:g.times)?(g==null?void 0:g.times)+" times":", Until Cancel";return d+=(_==null?void 0:_.formatted_total)+" Subscriptions "+g.repeat_interval+" "+M,d}else if((g==null?void 0:g.payment_type)==="onetime")return d+=(_==null?void 0:_.formatted_total)+" One Time Payment";return _==null?void 0:_.other_info.billing_summary};let y=O("");const A=_=>{C=t.variations.find(d=>d.id.toString()===_),y.value=V(C)},v=_=>{var k,g;return((k=_==null?void 0:_.other_info)==null?void 0:k.payment_type)==="subscription"?(_==null?void 0:_.variation_title)+" - "+Qe.capitalize((g=_==null?void 0:_.other_info)==null?void 0:g.repeat_interval):(_==null?void 0:_.variation_title)+" - One Time Payment"},I=()=>{r.$get(`products/${t.product_id}/upgrade-paths`,{variation_id:t.variation_id}).then(_=>{_.data.forEach((d,k)=>{d.object_id===t.variation_id&&d.value.to_variants.forEach((g,M)=>{S.value.push({id:g,variation_title:v(t.variations.find(E=>E.id.toString()===g)),payment_type:d.payment_type,is_prorate:d.value.is_prorate,discount_amount:d.value.discount_amount})})})})},f=_=>{let d=_.discount_amount;return d>0?_.variation_title+" - "+(_.is_prorate.toString()==="1"?"( Prorated )":"(Full Charge Applies)")+" ( "+d+b.value+" discount )":_.variation_title+" - "+(_.is_prorate.toString()==="1"?"( Prorated )":"(Full Charge Applies)")};de(()=>{I()});const U=()=>{if(i.value){const _=new URL(t.upgrade_path_base);return _.searchParams.append("order_hash",t.order.uuid),_.searchParams.append("mode","upgrade_plan"),_.searchParams.append("variation_id",i.value),_.href}return!1};return(_,d)=>{const k=u("el-button"),g=u("el-option"),M=u("el-select"),E=u("el-form-item"),J=u("el-dialog");return S.value.length>0&&D.value?(o(),h(T,{key:0},[e(k,{class:"el-button--x-small",onClick:L,type:"primary"},{default:n(()=>[x(c(_.$t("Change Plan")),1)]),_:1}),e(J,{modelValue:s.value,"onUpdate:modelValue":d[1]||(d[1]=K=>s.value=K),title:_.$t("Change Plan"),"append-to-body":!0},{default:n(()=>[l("div",_a,[S.value.length>0?(o(),$(E,{key:0,label:_.$t("Change Plan to")},{default:n(()=>[e(M,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=K=>i.value=K),onChange:A,clearable:""},{default:n(()=>[(o(!0),h(T,null,H(S.value,K=>(o(),$(g,{key:K.id,label:f(K),value:K.id.toString()},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):w("",!0),e(E,{label:_.$t("New Plan")},{default:n(()=>[m(y)?(o(),h("span",ma,[l("span",{innerHTML:m(y),class:"fct-plan-changer-text"},null,8,pa)])):(o(),h("span",ha,"---"))]),_:1},8,["label"]),e(E,{label:_.$t("Current Plan")},{default:n(()=>[l("span",{innerHTML:V(D.value),class:"fct-plan-changer-text"},null,8,fa)]),_:1},8,["label"]),U()?(o(),h("div",ga,[e(k,{type:"primary",tag:"a",href:U(),target:"_blank",rel:"noopener noreferrer",size:"small"},{default:n(()=>[x(c(_.$t(" Upgrade to New Plan")),1)]),_:1},8,["href"]),e(_e,{showMode:"basic_copy_btn",text:U()},null,8,["text"])])):w("",!0)])]),_:1},8,["modelValue","title"])],64)):w("",!0)}}},ba={name:"UpgradePlan",components:{CopyToClipboard:_e,DynamicIcon:Y},props:{variation_id:{type:[String,Number],required:!0},is_admin:{type:Boolean,required:!1,default:!1},product_id:{type:[String,Number],required:!0},order:{type:Object,required:!0},has_upgrades:{type:Boolean,required:!0},props_variations:{type:[Array,Object],required:!0},endpoint_path:{type:String,default:"products"},appendToBody:{type:Boolean,default:!0}},data(){return{variations:this.props_variations,upgradePlanModal:!1,selectedUpgradePath:"",upgradePaths:[]}},computed:{currencySign(){var a,t;return ce.get("shop.currency_sign")?ce.get("shop.currency_sign"):(t=(a=window.fluentcart_customer_profile_vars)==null?void 0:a.shop)!=null&&t.currency_sign?window.fluentcart_customer_profile_vars.shop.currency_sign:""}},methods:{translate:p,showUpgradePlanModal(){$e.get(`${this.endpoint_path}/variation/${this.variation_id}/upgrade-paths`,{params:{variation_id:this.variation_id,order_hash:this.order.uuid}}).then(a=>{this.upgradePaths=a.upgradePaths,this.upgradePlanModal=!0})},closeUpgradePlanModal(){this.upgradePlanModal=!1}}},ya={class:"fct-upgrade-plan"},wa={key:0,class:"fct-upgrade-variation-table"},ka={class:"upgrade-title"},La={class:"plan-price"},Ca={class:"plan-price"},Sa={class:"upgrade-cost"},Da={class:"upgrade-title"},xa=["innerHTML"],$a={key:0,class:"upgrade-text"},Va={class:"upgrade-action"},Ea={key:1};function Pa(a,t,s,L,r,i){const S=u("el-button"),C=u("el-table-column"),b=u("el-table"),D=u("el-dialog");return o(),h("div",ya,[s.has_upgrades?(o(),$(S,{key:0,size:"small",onClick:i.showUpgradePlanModal},{default:n(()=>[x(c(a.$t("Upgrade")),1)]),_:1},8,["onClick"])):w("",!0),e(D,{modelValue:r.upgradePlanModal,"onUpdate:modelValue":t[0]||(t[0]=V=>r.upgradePlanModal=V),"append-to-body":s.appendToBody,title:a.$t("Upgrade"),class:"fct-upgrade-plan-dialog fluent-cart-customer-profile-app"},{default:n(()=>[r.upgradePaths.length>0?(o(),h("div",wa,[e(b,{data:r.upgradePaths,style:{width:"100%"}},{default:n(()=>[e(C,{label:a.$t("Package"),width:290},{default:n(V=>[l("div",ka,c(V.row.title),1)]),_:1},8,["label"]),e(C,{label:a.$t("Price"),width:100},{default:n(V=>[l("div",La,[l("div",Ca,c(a.formatNumber(V.row.price,s.order.currency)),1)])]),_:1},8,["label"]),e(C,{label:a.$t("Amount to pay")},{default:n(V=>[l("div",Sa,[l("div",Da,[l("span",{innerHTML:V.row.payment_summary},null,8,xa),V.row.prorate_credit?(o(),h("div",$a)):w("",!0)])])]),_:1},8,["label"]),e(C,{label:a.$t("Action"),width:110},{default:n(V=>[l("div",Va,[e(S,{class:"el-button--x-small",tag:"a",href:V.row.upgrade_url,target:"_blank"},{default:n(()=>[x(c(a.$t("Upgrade")),1)]),_:2},1032,["href"])])]),_:1},8,["label"])]),_:1},8,["data"])])):(o(),h("div",Ea,c(a.$t("No upgrade plan found")),1))]),_:1},8,["modelValue","append-to-body","title"])])}const Aa=G(ba,[["render",Pa]]),Ta={name:"LicenseInformation",components:{Badge:W,CopyToClipboard:_e,DynamicIcon:Y,IconButton:ue,PlanChanger:va,UpgradePlan:Aa},props:{license:"license",customerId:"customerId",license_id:"license_id",activations:"activations",product:null,order:null,upgrade_path_base:""},data(){return{isDateSelected:!1,isCalendarOpen:!1,selectedDate:null,loading:!1,isConfirmationIconEnable:!1,limit:this.license.limit,variations:[],variation_id:this.license.variation_id+"",licenseLifetime:!1,isExpirationDateEnable:!1,isActivationLimitEnable:!1}},watch:{product:{handler(){var a;(a=this.product)!=null&&a.variants&&(this.variations=this.product.variants)},deep:!0,immediate:!0}},methods:{translate:p,formatDate:Q,translateNumber:p,handleToggleExpirationDate(){this.isExpirationDateEnable=!this.isExpirationDateEnable},handleToggleActivationLimit(){this.isActivationLimitEnable=!this.isActivationLimitEnable},handleLifetimeLicense(){this.$confirm(this.$t("Are you sure you want to mark license as lifetime?"),this.$t("Confirm!"),{cancelButtonText:this.$t("No,Thanks"),confirmButtonText:this.$t("Confirm"),type:"warning"}).then(()=>{this.markAsLifetime()}).catch(()=>{this.licenseLifetime=!1})},handleActivationLimit(){this.$confirm(this.$t("Are you sure you want to mark limit as unlimited?"),this.$t("Confirm!"),{cancelButtonText:this.$t("No,Thanks"),confirmButtonText:this.$t("Confirm"),type:"warning"}).then(()=>{this.markAsUnlimited()}).catch(()=>{})},handleDateChange(){this.newExpirationDate=Z(this.selectedDate).format("YYYY-MM-DD HH:mm:ss"),this.extendValidity()},handleLimitChange(){this.isConfirmationIconEnable=!0},markAsLifetime(){this.licenseLifetime=!0,this.newExpirationDate="lifetime",this.extendValidity()},markAsUnlimited(){this.activationLimitUnlimited=!0,this.limit="unlimited",this.updateLimit()},regenerateLicenseKey(){this.$post("licensing/licenses/"+this.license_id+"/regenerate-key").then(a=>{this.$emit("fetchLicense"),this.handleSuccess(a.message)}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})},extendValidity(){this.$post("licensing/licenses/"+this.license_id+"/extend-validity",{expiration_date:this.newExpirationDate}).then(a=>{this.newExpirationDate=null,this.$emit("fetchLicense"),this.handleSuccess(a.message),this.selectedDate=null,this.licenseLifetime=!0}).catch(a=>{this.handleError(a),this.licenseLifetime=!1}).finally(()=>{this.loading=!1})},updateLimit(){this.$post("licensing/licenses/"+this.license_id+"/update_limit",{limit:this.limit}).then(a=>{this.$emit("fetchLicense"),this.handleSuccess(a.message),this.isConfirmationIconEnable=!1}).catch(a=>{this.handleError(a),this.isConfirmationIconEnable=!1}).finally(()=>{this.loading=!1})},resetLimit(){this.limit=this.license.limit,this.isConfirmationIconEnable=!1}},mounted(){var t;const a=(t=this.$refs.calendar)==null?void 0:t.$el.querySelector("input");a&&a.addEventListener("keydown",s=>{s.key==="Enter"&&this.handleDateChange()})}},Ua={class:"fct-license-info-content"},Ma={class:"flex items-center gap-2"},Ia={class:"fct-input-with-action-wrap"},Oa={class:"fct-input-with-action"},Ba={class:"fct-license-product"},Na={class:"text-xs"},Fa={class:"fct-license-inline-action-wrap"},Ra={key:1,class:"text"},Ha={key:2,class:"separator"},za={class:"inline-action-button"},ja={class:"text"},qa={class:"fct-license-inline-action-wrap"},Ya={key:0,class:"inline-action-input-group mr-2"},Ka={key:0,class:"fct-license-activation-limit-actions"},Wa={key:1,class:"text"},Ga={key:2,class:"separator"},Xa={class:"inline-action-button"},Za={class:"text"},Ja={class:"fct-license-info-form-show-on-mobile"},Qa={class:"fct-license-info-mobile-header"},el={class:"fct-license-info-mobile-body"},tl={class:"fct-license-product"},nl={class:"text-xs text-system-mid dark:text-gray-300"},al={class:"fct-input-with-action-wrap"},ll={class:"fct-input-with-action"},sl={class:"fct-input-with-action-icon"},il={class:"fct-license-info-mobile-footer"},ol={class:"fct-license-info-mobile-footer-item"},rl={class:"title"},cl={class:"fct-license-inline-action-wrap"},dl={key:1,class:"text"},ul={key:2,class:"separator"},_l={class:"inline-action-button"},ml={class:"text"},pl={class:"fct-license-info-mobile-footer-item"},hl={class:"title"},fl={class:"fct-license-inline-action-wrap"},gl={key:0,class:"inline-action-input-group mr-2"},vl={key:0,class:"fct-license-activation-limit-actions"},bl={key:1,class:"text"},yl={key:2,class:"separator"},wl={class:"inline-action-button"},kl={class:"text"};function Ll(a,t,s,L,r,i){var M,E,J,K,he,fe,ge,ve,be;const S=u("CopyToClipboard"),C=u("el-input"),b=u("DynamicIcon"),D=u("el-button"),V=u("el-popconfirm"),y=u("el-form-item"),A=u("el-col"),v=u("router-link"),I=u("UpgradePlan"),f=u("el-date-picker"),U=u("el-input-number"),_=u("IconButton"),d=u("el-row"),k=u("el-form"),g=u("Badge");return o(),h("div",Ua,[e(k,{class:"fct-license-info-form-hide-on-mobile",model:s.license,"label-position":"top"},{default:n(()=>[e(d,null,{default:n(()=>[e(A,{lg:24},{default:n(()=>[e(y,{label:""},{label:n(()=>[l("div",Ma,[x(c(i.translate("License Key"))+" ",1),e(S,{text:s.license.license_key,showMode:"basic_copy_btn",tooltipText:i.translate("Copy License")},null,8,["text","tooltipText"])])]),default:n(()=>[l("div",Ia,[e(C,{modelValue:s.license.license_key,"onUpdate:modelValue":t[0]||(t[0]=P=>s.license.license_key=P),disabled:""},null,8,["modelValue"]),l("div",Oa,[e(V,{width:"250","confirm-button-text":i.translate("Confirm"),"cancel-button-text":i.translate("No, Thanks"),title:i.translate("Are you sure to regenerate?"),onConfirm:i.regenerateLicenseKey},{reference:n(()=>[e(D,{class:"el-button--x-small",plain:""},{default:n(()=>[e(b,{name:"Reload"}),x(" "+c(i.translate("Regenerate")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title","onConfirm"])])])]),_:1})]),_:1}),e(A,{lg:24},{default:n(()=>[s.product!=null?(o(),$(y,{key:0,label:i.translate("Product Name")},{default:n(()=>{var P;return[l("div",Ba,[e(v,{class:"link",to:{name:"product_edit",params:{product_id:s.product.ID}}},{default:n(()=>{var z;return[x(c(s.product.post_title)+" ",1),l("span",Na," â€“ "+c((z=r.variations.find(le=>le.id==s.license.variation_id))==null?void 0:z.variation_title),1)]}),_:1},8,["to"]),((P=r.variations)==null?void 0:P.length)>0?(o(),$(I,{key:0,variation_id:r.variation_id,product_id:s.product.ID,order:s.order,props_variations:r.variations,endpoint_path:"products",has_upgrades:s.license.has_upgrades&&!["expired","disabled"].includes(s.license.status),is_admin:!0},null,8,["variation_id","product_id","order","props_variations","has_upgrades"])):w("",!0)])]}),_:1},8,["label"])):w("",!0)]),_:1}),e(A,{lg:12},{default:n(()=>[e(y,{label:i.translate("Purchase Date")},{default:n(()=>{var P;return[l("span",null,c(i.formatDate((P=s.license)==null?void 0:P.created_at)),1)]}),_:1},8,["label"])]),_:1}),e(A,{lg:12},{default:n(()=>[e(y,{label:i.translate("Expirations date")},{default:n(()=>{var P,z,le,ye,we,ke;return[l("div",Fa,[r.isExpirationDateEnable?(o(),$(f,{key:0,modelValue:r.selectedDate,"onUpdate:modelValue":t[1]||(t[1]=te=>r.selectedDate=te),placeholder:i.formatDate((P=s.license)==null?void 0:P.expiration_date)?i.formatDate((z=s.license)==null?void 0:z.expiration_date):i.translate("Lifetime"),"default-value":(le=s.license)==null?void 0:le.expiration_date,type:"date",ref:"calendar",onChange:i.handleDateChange,class:"el-input--x-small mr-2"},null,8,["modelValue","placeholder","default-value","onChange"])):(o(),h("span",Ra,c((ye=s.license)!=null&&ye.expiration_date?i.formatDate((we=s.license)==null?void 0:we.expiration_date):"Lifetime"),1)),r.isExpirationDateEnable?w("",!0):(o(),h("span",Ha)),l("div",za,[l("a",{href:"#",onClick:t[2]||(t[2]=j((...te)=>i.handleToggleExpirationDate&&i.handleToggleExpirationDate(...te),["prevent"]))},c(r.isExpirationDateEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isExpirationDateEnable&&((ke=s.license)!=null&&ke.expiration_date)?(o(),h(T,{key:0},[l("span",ja,c(i.translate("or")),1),l("a",{href:"#",onClick:t[3]||(t[3]=j((...te)=>i.handleLifetimeLicense&&i.handleLifetimeLicense(...te),["prevent"]))},c(i.translate("Mark as lifetime")),1)],64)):w("",!0)])])]}),_:1},8,["label"])]),_:1}),e(A,{lg:12},{default:n(()=>[e(y,{label:i.translate("Activation Limit")},{default:n(()=>{var P;return[l("div",qa,[r.isActivationLimitEnable?(o(),h("div",Ya,[e(U,{modelValue:r.limit,"onUpdate:modelValue":t[4]||(t[4]=z=>r.limit=z),min:0,"controls-position":"right",onChange:i.handleLimitChange,onKeyup:i.handleLimitChange},{"decrease-icon":n(()=>[e(b,{class:"w-3",name:"ChevronDown"})]),"increase-icon":n(()=>[e(b,{class:"w-3",name:"ChevronUp"})]),_:1},8,["modelValue","onChange","onKeyup"]),r.isConfirmationIconEnable?(o(),h("div",Ka,[e(_,{tag:"button",onClick:j(i.updateLimit,["prevent"])},{default:n(()=>[e(b,{name:"Check"})]),_:1},8,["onClick"]),e(_,{tag:"button",onClick:j(i.resetLimit,["prevent"])},{default:n(()=>[e(b,{name:"Cross"})]),_:1},8,["onClick"])])):w("",!0)])):w("",!0),r.isActivationLimitEnable?w("",!0):(o(),h("span",Wa,c(i.translateNumber((P=s.activations)==null?void 0:P.length))+" / "+c(r.limit!=0?r.limit:i.translate("Unlimited")),1)),r.isActivationLimitEnable?w("",!0):(o(),h("span",Ga)),l("div",Xa,[l("a",{href:"#",onClick:t[5]||(t[5]=j((...z)=>i.handleToggleActivationLimit&&i.handleToggleActivationLimit(...z),["prevent"]))},c(r.isActivationLimitEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isActivationLimitEnable&&r.limit!=0?(o(),h(T,{key:0},[l("span",Za,c(i.translate("or")),1),l("a",{href:"#",onClick:t[6]||(t[6]=j((...z)=>i.handleActivationLimit&&i.handleActivationLimit(...z),["prevent"]))},c(i.translate("Mark as unlimited")),1)],64)):w("",!0)])])]}),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model"]),l("div",Ja,[l("div",Qa,[e(g,{status:s.license.status,size:"small"},null,8,["status"]),l("span",null,c(i.translate("Purchase Date"))+": "+c(i.formatDate((M=s.license)==null?void 0:M.created_at)),1)]),l("div",el,[l("div",tl,[e(v,{class:"link",to:{name:"product_edit",params:{product_id:s.product.ID}}},{default:n(()=>{var P;return[x(c(s.product.post_title)+" ",1),l("span",nl," â€“ "+c((P=r.variations.find(z=>z.id==s.license.variation_id))==null?void 0:P.variation_title),1)]}),_:1},8,["to"]),((E=r.variations)==null?void 0:E.length)>0?(o(),$(I,{key:0,variation_id:r.variation_id,product_id:s.product.ID,order:s.order,props_variations:r.variations,endpoint_path:"products",has_upgrades:s.license.has_upgrades&&!["expired","disabled"].includes(s.license.status),is_admin:!0},null,8,["variation_id","product_id","order","props_variations","has_upgrades"])):w("",!0)]),l("div",al,[e(C,{modelValue:s.license.license_key,"onUpdate:modelValue":t[7]||(t[7]=P=>s.license.license_key=P),readonly:""},null,8,["modelValue"]),l("div",ll,[e(V,{width:"250","confirm-button-text":i.translate("Confirm"),"cancel-button-text":i.translate("No, Thanks"),title:i.translate("Are you sure to regenerate?"),onConfirm:i.regenerateLicenseKey},{reference:n(()=>[l("div",sl,[e(b,{name:"Reload"})])]),_:1},8,["confirm-button-text","cancel-button-text","title","onConfirm"])])])]),l("div",il,[l("div",ol,[l("div",rl,c(i.translate("Expirations date")),1),l("div",cl,[r.isExpirationDateEnable?(o(),$(f,{key:0,modelValue:r.selectedDate,"onUpdate:modelValue":t[8]||(t[8]=P=>r.selectedDate=P),placeholder:i.formatDate((J=s.license)==null?void 0:J.expiration_date)?i.formatDate((K=s.license)==null?void 0:K.expiration_date):i.translate("Lifetime"),"default-value":(he=s.license)==null?void 0:he.expiration_date,type:"date",ref:"calendar",onChange:i.handleDateChange,class:"el-input--x-small mr-2"},null,8,["modelValue","placeholder","default-value","onChange"])):(o(),h("span",dl,c((fe=s.license)!=null&&fe.expiration_date?i.formatDate((ge=s.license)==null?void 0:ge.expiration_date):"Lifetime"),1)),r.isExpirationDateEnable?w("",!0):(o(),h("span",ul)),l("div",_l,[l("a",{href:"#",onClick:t[9]||(t[9]=j((...P)=>i.handleToggleExpirationDate&&i.handleToggleExpirationDate(...P),["prevent"]))},c(r.isExpirationDateEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isExpirationDateEnable&&((ve=s.license)!=null&&ve.expiration_date)?(o(),h(T,{key:0},[l("span",ml,c(i.translate("or")),1),l("a",{href:"#",onClick:t[10]||(t[10]=j((...P)=>i.handleLifetimeLicense&&i.handleLifetimeLicense(...P),["prevent"]))},c(i.translate("Mark as lifetime")),1)],64)):w("",!0)])])]),l("div",pl,[l("div",hl,c(i.translate("Activation Limit")),1),l("div",fl,[r.isActivationLimitEnable?(o(),h("div",gl,[e(U,{modelValue:r.limit,"onUpdate:modelValue":t[11]||(t[11]=P=>r.limit=P),min:0,"controls-position":"right",onChange:i.handleLimitChange,onKeyup:i.handleLimitChange},{"decrease-icon":n(()=>[e(b,{class:"w-3",name:"ChevronDown"})]),"increase-icon":n(()=>[e(b,{class:"w-3",name:"ChevronUp"})]),_:1},8,["modelValue","onChange","onKeyup"]),r.isConfirmationIconEnable?(o(),h("div",vl,[e(_,{tag:"button",onClick:j(i.updateLimit,["prevent"])},{default:n(()=>[e(b,{name:"Check"})]),_:1},8,["onClick"]),e(_,{tag:"button",onClick:j(i.resetLimit,["prevent"])},{default:n(()=>[e(b,{name:"Cross"})]),_:1},8,["onClick"])])):w("",!0)])):w("",!0),r.isActivationLimitEnable?w("",!0):(o(),h("span",bl,c((be=s.activations)==null?void 0:be.length)+" / "+c(r.limit!=0?r.limit:i.translate("Unlimited")),1)),r.isActivationLimitEnable?w("",!0):(o(),h("span",yl)),l("div",wl,[l("a",{href:"#",onClick:t[12]||(t[12]=j((...P)=>i.handleToggleActivationLimit&&i.handleToggleActivationLimit(...P),["prevent"]))},c(r.isActivationLimitEnable?i.translate("Cancel"):i.translate("Edit")),1),!r.isActivationLimitEnable&&r.limit!=0?(o(),h(T,{key:0},[l("span",kl,c(i.translate("or")),1),l("a",{href:"#",onClick:t[13]||(t[13]=j((...P)=>i.handleActivationLimit&&i.handleActivationLimit(...P),["prevent"]))},c(i.translate("Mark as unlimited")),1)],64)):w("",!0)])])])])])])}const Cl=G(Ta,[["render",Ll]]),Sl={name:"ActivatedSiteInformation",props:["activatedSites","modelValue","activationLimit","activationCount"],computed:{Link(){return je}},components:{IconButton:ue,DynamicIcon:Y,Badge:W,Empty:pe},methods:{formatDate:Q,updateModelValue(a){this.$emit("update:modelValue",a)},activateSite(){this.$emit("siteActivated")},deactivateSite(a){this.$emit("siteDeactivated",a)}}},Dl={class:"fct-activated-site-url-container grid gap-5"},xl={key:0,class:"-mx-6 -mb-6 fct-license-site-url-table-wrap"};function $l(a,t,s,L,r,i){const S=u("el-table-column"),C=u("Badge"),b=u("DynamicIcon"),D=u("IconButton"),V=u("el-popconfirm"),y=u("el-table"),A=u("Empty");return o(),h("div",Dl,[s.activatedSites.length>0?(o(),h("div",xl,[e(y,{data:s.activatedSites,class:"w-full"},{default:n(()=>[e(S,{label:a.$t("Site URL"),width:"360"},{default:n(v=>[l("span",null,c(v.row.site_url),1)]),_:1},8,["label"]),e(S,{label:a.$t("Status"),width:"100"},{default:n(v=>[e(C,{status:v.row.status,size:"small"},null,8,["status"])]),_:1},8,["label"]),e(S,{label:a.$t("Activated at"),width:"140"},{default:n(v=>[l("span",null,c(i.formatDate(v.row.created_at)),1)]),_:1},8,["label"]),e(S,{width:"100"},{default:n(v=>[l("span",null,[e(V,{width:"200","confirm-button-text":a.$t("Confirm"),"cancel-button-text":a.$t("No, Thanks"),title:a.$t("Are you sure?"),onConfirm:I=>i.deactivateSite(v.row.id)},{reference:n(()=>[e(D,{tag:"a",size:"x-small",class:"ml-auto",hover:"danger"},{default:n(()=>[e(b,{name:"TrashIcon"})]),_:1})]),_:2},1032,["confirm-button-text","cancel-button-text","title","onConfirm"])])]),_:1})]),_:1},8,["data"])])):(o(),$(A,{key:1,icon:"Empty/ListView","has-dark":!0,text:a.$t("No activated sites found")},null,8,["text"]))])}const Vl=G(Sl,[["render",$l]]),El={class:"fct-single-customer-loader-wrap fct-layout-width"},Pl={class:"single-page-header fct-page-loader-header flex items-start justify-between"},Al={class:"single-page-body"},Tl={class:"fct-single-order"},Ul={class:"fct-single-order-main"},Ml={class:"grid gap-5 grid-cols-[repeat(auto-fit,minmax(200px,1fr))]"},Il={class:"fct-single-order-aside"},Ol={class:"fct-admin-sidebar"},Bl={__name:"SingleLicenseLoader",setup(a){return(t,s)=>{const L=u("el-skeleton-item"),r=u("el-skeleton");return o(),h("div",El,[l("div",Pl,[e(r,{animated:"",class:"flex items-start gap-2"},{template:n(()=>[(o(),h(T,null,H(3,i=>e(L,{key:i,class:"max-w-[100px]"})),64))]),_:1})]),l("div",Al,[l("div",Tl,[l("div",Ul,[e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Manage License Details")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5"},{template:n(()=>[e(L,{variant:"p",class:"w-full"}),e(L,{variant:"p",style:{width:"50%"}})]),_:1}),l("div",Ml,[(o(),h(T,null,H(6,i=>e(r,{key:i,animated:!0},{template:n(()=>[l("div",null,[e(L,{variant:"p",class:"w-full"}),e(L,{variant:"p",style:{width:"50%"}})])]),_:2},1024)),64))])]),_:1})]),_:1}),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Related Orders")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5",rows:2})]),_:1})]),_:1}),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:t.$t("Activated Sites")},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:!0,class:"mb-5",rows:3})]),_:1})]),_:1})]),l("div",Il,[l("div",Ol,[e(N,null,{default:n(()=>[e(R,{title:t.$t("Customer Information"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:"",rows:6})]),_:1})]),_:1}),e(N,null,{default:n(()=>[e(R,{title:t.$t("Actions"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:""},{template:n(()=>[e(L,{variant:"p",class:"w-1/2"})]),_:1})]),_:1})]),_:1}),e(N,null,{default:n(()=>[e(R,{title:t.$t("Labels"),border_bottom:"",title_size:"small"},null,8,["title"]),e(B,null,{default:n(()=>[e(r,{animated:"",rows:1})]),_:1})]),_:1})])])])])])}}},Nl={key:2,class:"fct-view-license-wrap fct-layout-width"},Fl={class:"single-page-header"},Rl={class:"flex items-center gap-3 flex-wrap whitespace-pre-wrap",style:{"overflow-wrap":"anywhere"}},Hl={class:"license-breadcrumb-only-mobile"},zl={class:"single-page-body"},jl={class:"fct-view-license-content-wrap"},ql={class:"more-btn"},Yl={class:"fct-related-license-content"},Kl={class:"fct-license-related-orders-show-on-mobile fct-table-mobile-wrap"},Wl={class:"fct-table-mobile-header"},Gl={class:"fct-table-date-col"},Xl={class:"fct-table-price-col"},Zl={class:"fct-table-mobile-footer"},Jl={class:"fct-table-mobile-footer-row"},Ql={class:"title"},es={class:"fct-table-status-col flex items-center gap-1"},ts={class:"title"},ns={class:"value capitalize"},as={class:"fct-related-license-content"},ls={class:"value-column-with-space",style:{"max-height":"500px","overflow-y":"auto"}},ss=["innerHTML"],is={class:"fct-admin-sidebar"},os={class:"fct-admin-sidebar-item"},rs={class:"fct-lists"},cs={class:"!mb-0"},ds={name:"ViewLicense",components:{OrderUpDownIndicator:ie},props:["license_id"],data(){return{changes_made:0,isDateSelected:!1,isCalendarOpen:!1,activeTab:"license",activeMenu:"details",license:null,order:null,selectedDate:null,orders:[],prevOrders:[],activations:[],loading:!0,saving:!1,limit:null,site_url:null,upgrade_path_base:"",showConfirmationIcons:!1,customerId:null,activatedSites:[],logs:[],selectedLabels:[],renewalNoticeValue:"",renewalNoticeOptions:[{value:"option1",label:"Need to connect backend"},{value:"option2",label:"Need to connect backend"}],product:{},notFound:{show:!1,message:"",buttonText:"",route:""}}},watch:{license:{handler(){this.changes_made++},deep:!0,immediate:!0},product:{handler(){var a;(a=this.product)!=null&&a.variants&&(this.variations=this.product.variants)},deep:!0,immediate:!0},license_id:{handler(a,t){this.fetchLicense()}}},methods:{handleLicenseCommand(a){a==="delete_license"&&this.$confirm("Are you sure you want to delete this license?","Confirm Delete!",{confirmButtonText:"Yes, Delete!",cancelButtonText:"Cancel",confirmButtonClass:"el-button--primary",cancelButtonClass:"el-button--info is-plain",type:"warning"}).then(()=>{this.deleteLicense()}).catch(()=>{})},deleteLicense(){this.$del(`licensing/licenses/${this.license_id}/delete`).then(a=>{this.handleSuccess(a.message),this.$router.push({name:"licenses"})}).catch(a=>{this.handleError(a)})},updateUrl(a,t){this.activatedSites[a]=t},activateSite(){Ze(this.site_url)?this.$post("licensing/licenses/"+this.license_id+"/activate_site",{url:this.site_url}).then(t=>{if(this.fetchLicense(),this.site_url=null,t.success)this.handleSuccess("Site activated successfully!");else{let s=t.error??"An error occurred while activating the site";this.handleError(s)}}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1}):this.handleError("Enter a valid site URL")},deactivateSite(a){this.$post("licensing/licenses/"+this.license_id+"/deactivate_site",{activation_id:a}).then(t=>{this.fetchLicense(),this.handleSuccess(t.message)}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1})},fetchLicense(){this.loading=!0,this.notFound.show=!1,this.$get("licensing/licenses/"+this.license_id).then(a=>{var t,s;this.license=a.license,this.order=a.order,this.order.customer=(t=this.license)==null?void 0:t.customer,this.upgrade_path_base=a.upgrade_path_base,this.orders=a.orders,this.activations=a.activations,this.limit=this.license.limit,this.customerId=(s=this.license.customer)==null?void 0:s.id,this.product=a.product,this.selectedLabels=a.selected_labels,this.prevOrders=a.prev_orders,this.activatedSites=this.activations.map(L=>{var r,i;return{id:L.id,site_url:(r=L.site)==null?void 0:r.site_url,created_at:(i=L.site)==null?void 0:i.created_at,status:L.status}}).sort((L,r)=>r.id-L.id)}).catch(a=>{a&&((a==null?void 0:a.code)==="fluent_cart_entity_not_found"?(this.notFound.show=!0,this.notFound.buttonText=ae.get(a,"data.buttonText"),this.notFound.message=ae.get(a,"data.message"),this.notFound.route=ae.get(a,"data.route")):this.handleError(a))}).finally(()=>{this.loading=!1})},fetchLicenseMeta(){this.$get("licensing/licenses/meta/"+this.license_id).then(a=>{this.logs=a}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1})},updateLicenseStatus(a){this.$post("licensing/licenses/"+this.license_id+"/update_status",{status:a}).then(t=>{this.license&&(this.license.status=a),this.$emit("fetchLicense"),this.handleSuccess(t.message),this.fetchLicense()}).catch(t=>{this.handleError(t)}).finally(()=>{this.loading=!1})},getCustomerTotalOrders(a){return a>0?a+" "+(a==1?p("order"):p("orders")):p("No orders")},handleMenuClick(a){this.activeMenu=a},discard(){return window.location.reload()}},mounted(){this.fetchLicense()}},us=Object.assign(ds,{setup(a){return(t,s)=>{var _;const L=u("el-breadcrumb-item"),r=u("el-breadcrumb"),i=u("router-link"),S=u("el-dropdown-item"),C=u("el-dropdown-menu"),b=u("el-dropdown"),D=u("el-table-column"),V=u("el-table"),y=u("el-timeline-item"),A=u("el-timeline"),v=u("el-col"),I=u("el-button"),f=u("el-popconfirm"),U=u("el-row");return o(),h("div",null,[t.loading?(o(),$(Bl,{key:0})):w("",!0),t.notFound.show?(o(),$(Ne,{key:1,"button-text":t.notFound.buttonText,message:t.notFound.message,route:t.notFound.route},null,8,["button-text","message","route"])):w("",!0),t.notFound.show===!1?(o(),h("div",Nl,[t.loading?w("",!0):(o(),h(T,{key:0},[t.license?(o(),h(T,{key:0},[l("div",Fl,[e(r,{class:"hide-license-breadcrumb-on-mobile","separator-icon":m(qe)},{default:n(()=>[e(L,{to:{name:"licenses"}},{default:n(()=>[x(c(m(p)("Licenses")),1)]),_:1}),e(L,null,{default:n(()=>{var d;return[l("div",Rl,[x(c((d=t.license)==null?void 0:d.license_key)+" ",1),e(W,{status:t.license.status,size:"small"},null,8,["status"])])]}),_:1})]),_:1},8,["separator-icon"]),l("ul",Hl,[l("li",null,[e(i,{to:{name:"licenses"}},{default:n(()=>[e(Y,{name:"ArrowLeft",class:"cursor-pointer"})]),_:1})]),l("li",null,c((_=t.license)==null?void 0:_.license_key),1)])]),l("div",zl,[e(U,{gutter:30},{default:n(()=>[e(v,{lg:17},{default:n(()=>[l("div",jl,[e(N,null,{default:n(()=>[e(R,{border_bottom:"",title_size:"small",title:m(p)("License Details")},{action:n(()=>[e(b,{trigger:"click",class:"fct-more-option-wrap","popper-class":"fct-dropdown",onCommand:t.handleLicenseCommand,placement:"bottom-end"},{dropdown:n(()=>[e(C,null,{default:n(()=>[e(S,{command:"delete_license",class:"item-destructive"},{default:n(()=>[e(Y,{name:"Delete"}),x(" "+c(m(p)("Delete License")),1)]),_:1})]),_:1})]),default:n(()=>[l("span",ql,[e(Y,{name:"More"})])]),_:1},8,["onCommand"])]),_:1},8,["title"]),e(B,null,{default:n(()=>[e(Cl,{license:t.license,customerId:t.customerId,license_id:a.license_id,activations:t.activations,product:t.product,order:t.order,upgrade_path_base:t.upgrade_path_base,onFetchLicense:t.fetchLicense},null,8,["license","customerId","license_id","activations","product","order","upgrade_path_base","onFetchLicense"])]),_:1})]),_:1}),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Related Orders"),title_size:"small"},null,8,["title"]),e(B,{class:"px-0 pb-0"},{default:n(()=>[l("div",Yl,[e(V,{data:t.orders,class:"w-full fct-license-related-orders-hide-on-mobile"},{default:n(()=>[e(D,{width:120,label:m(p)("ID")},{default:n(d=>[e(i,{class:"link",to:{name:"view_order",params:{order_id:d.row.id}}},{default:n(()=>[x(" #"+c(m(p)(d.row.id)),1)]),_:2},1032,["to"])]),_:1},8,["label"]),e(D,{width:120,label:m(p)("Amount")},{default:n(d=>[l("span",null,c(t.formatNumber(d.row.total_paid)),1)]),_:1},8,["label"]),e(D,{width:150,label:m(p)("Date"),prop:"created_at"},{default:n(d=>[l("span",null,c(m(Q)(d.row.created_at)),1)]),_:1},8,["label"]),e(D,{label:m(p)("Payment Method")},{default:n(d=>[x(c(d.row.payment_method),1)]),_:1},8,["label"]),e(D,{label:m(p)("Status")},{default:n(d=>[e(W,{type:d.row.payment_status},{default:n(()=>[x(c(d.row.payment_status),1)]),_:2},1032,["type"]),e(W,{style:{"margin-left":"5px","margin-right":"5px"},type:d.row.type},{default:n(()=>[x(c(d.row.type),1)]),_:2},1032,["type"]),e(ie,{order:d.row},null,8,["order"])]),_:1},8,["label"])]),_:1},8,["data"]),l("div",Kl,[(o(!0),h(T,null,H(t.orders,(d,k)=>(o(),h("div",{key:k,class:"fct-table-mobile-row"},[l("div",Wl,[l("div",Gl,[x(c(m(Q)(d.created_at))+" ",1),s[4]||(s[4]=l("div",{class:"bullet"},"â€¢",-1)),e(i,{class:"link",to:{name:"view_order",params:{order_id:d.id}}},{default:n(()=>[x(" #"+c(d.id),1)]),_:2},1032,["to"])]),l("div",Xl,c(t.formatNumber(d.total_paid)),1)]),l("div",Zl,[l("div",Jl,[l("div",null,[l("div",Ql,c(m(p)("Status")),1),l("div",es,[e(W,{type:d.payment_status},{default:n(()=>[x(c(d.payment_status),1)]),_:2},1032,["type"]),e(W,{type:d.type},{default:n(()=>[x(c(d.type),1)]),_:2},1032,["type"]),e(ie,{order:d},null,8,["order"])])]),l("div",null,[l("div",ts,c(m(p)("Payment Method")),1),l("div",ns,c(d.payment_method),1)])])])]))),128))])])]),_:1})]),_:1}),t.prevOrders&&t.prevOrders.length?(o(),$(N,{key:0,class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Previous Orders"),title_size:"small"},null,8,["title"]),e(B,{class:"px-0 pb-0"},{default:n(()=>[l("div",as,[e(V,{data:t.prevOrders,class:"w-full"},{default:n(()=>[e(D,{width:120,label:m(p)("ID")},{default:n(d=>[e(i,{class:"link",to:{name:"view_order",params:{order_id:d.row.id}}},{default:n(()=>[x(" #"+c(m(p)(d.row.id)),1)]),_:2},1032,["to"])]),_:1},8,["label"]),e(D,{width:120,label:m(p)("Amount")},{default:n(d=>[l("span",null,c(t.formatNumber(d.row.total_paid)),1)]),_:1},8,["label"]),e(D,{width:150,label:m(p)("Date"),prop:"created_at"},{default:n(d=>[l("span",null,c(m(Q)(d.row.created_at)),1)]),_:1},8,["label"]),e(D,{label:m(p)("Status")},{default:n(d=>[e(W,{type:d.row.payment_status},{default:n(()=>[x(c(d.row.payment_status),1)]),_:2},1032,["type"]),e(W,{style:{"margin-left":"5px","margin-right":"5px"},type:d.row.type},{default:n(()=>[x(c(d.row.type),1)]),_:2},1032,["type"]),e(ie,{order:d.row},null,8,["order"])]),_:1},8,["label"])]),_:1},8,["data"])])]),_:1})]),_:1})):w("",!0),e(N,{class:"overflow-hidden"},{default:n(()=>[e(R,{title:m(p)("Activated Sites"),title_size:"small",border_bottom:""},null,8,["title"]),e(B,null,{default:n(()=>[e(Vl,{modelValue:t.site_url,"onUpdate:modelValue":s[0]||(s[0]=d=>t.site_url=d),onSiteActivated:t.activateSite,onSiteDeactivated:t.deactivateSite,activatedSites:t.activatedSites,activationLimit:t.limit,activationCount:t.activations.length},null,8,["modelValue","onSiteActivated","onSiteDeactivated","activatedSites","activationLimit","activationCount"])]),_:1})]),_:1}),t.logs.length>0?(o(),$(N,{key:1},{default:n(()=>[e(B,null,{default:n(()=>[l("div",ls,[e(A,{style:{"padding-left":"2px"}},{default:n(()=>[(o(!0),h(T,null,H(t.logs,d=>{var k;return o(),$(y,{key:d,timestamp:m(Z)((k=t.license)==null?void 0:k.updated_at).format("MMMM DD, YYYY"),placement:"top",color:"blue"},{default:n(()=>[l("div",{innerHTML:d.meta_value},null,8,ss)]),_:2},1032,["timestamp"])}),128))]),_:1})])]),_:1})]),_:1})):w("",!0)])]),_:1}),e(v,{lg:7},{default:n(()=>[l("div",is,[e(We,{order:t.order,shouldEnableEditing:!0,onOnAddressSelected:s[1]||(s[1]=d=>{d.type==="shipping"?t.order.shipping_address_id=d.id:t.order.billing_address_id=d.id})},null,8,["order"]),e(N,null,{default:n(()=>[e(R,{title:m(p)("Actions"),title_size:"small",border_bottom:""},null,8,["title"]),e(B,null,{default:n(()=>[l("div",os,[l("ul",rs,[l("li",cs,[t.license.status!=="disabled"?(o(),$(f,{key:0,width:"210","confirm-button-text":m(p)("Confirm"),"cancel-button-text":m(p)("No, Thanks"),title:m(p)("Are you sure?"),onConfirm:s[2]||(s[2]=d=>t.updateLicenseStatus("disabled"))},{reference:n(()=>[e(I,{text:"",class:"!text-red-500 !mt-0"},{default:n(()=>[x(c(m(p)("Disable")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title"])):w("",!0),t.license.status==="disabled"?(o(),$(f,{key:1,width:"210","confirm-button-text":m(p)("Confirm"),"cancel-button-text":m(p)("No, Thanks"),title:m(p)("Are you sure?"),onConfirm:s[3]||(s[3]=d=>t.updateLicenseStatus("active"))},{reference:n(()=>[e(I,{text:"",class:"!text-primary-500 !mt-0"},{default:n(()=>[x(c(m(p)("Enable")),1)]),_:1})]),_:1},8,["confirm-button-text","cancel-button-text","title"])):w("",!0)])])])]),_:1})]),_:1}),t.loading?w("",!0):(o(),$(Ge,{key:0,"bind-to-id":t.license.id,"bind-to-type":"FluentCartPro\\App\\Modules\\Licensing\\Models\\License",selectedLabels:t.selectedLabels,shouldEnableEditing:!0,"onUpdate:updateLabel":()=>{}},null,8,["bind-to-id","selectedLabels"]))])]),_:1})]),_:1})])],64)):w("",!0)],64))])):w("",!0)])}}}),_s={class:"heading-wrap"},ms={class:"title"},ps={key:0,class:"heading-action"},hs={__name:"Heading",props:{title:String},setup(a){const t=Ae();return(s,L)=>(o(),h("div",_s,[l("h2",ms,c(a.title),1),m(t).actions?(o(),h("div",ps,[Te(s.$slots,"actions")])):w("",!0)]))}},fs={name:"AllLicenses",components:{Pagination:Be,Heading:hs},data(){return{licenses:[],paginate:{per_page:10,current_page:1,total:0,last_page:1},loading:!1,is_loaded:!1,search:""}},methods:{fetch(){this.loading=!0,this.$get("licensing/licenses/customer/1",{page:this.paginate.current_page,per_page:this.paginate.per_page,search:this.search}).then(a=>{this.licenses=a.licenses.data,this.paginate.total=a.licenses.total,this.paginate.last_page=a.licenses.last_page}).catch(a=>{this.handleError(a)}).finally(()=>{this.loading=!1,this.is_loaded=!0})},getProductName(a){return a?(a==null?void 0:a.product.post_title)+" - "+a.variation_label:"n/a"},onCurrentPageChanged({page:a,currentPageCount:t}){this.paginate.current_page=a,this.fetch()},onPerPageChanged(a){this.paginate.per_page=a,this.fetch()}},mounted(){this.fetch()}},gs={class:"all_licenses"},vs={class:"bg-white dark:bg-dark-700"},bs={key:0},ys={key:1},ws={class:"py-2.5 px-7.5 dark:bg-gray-800"},ks={class:"flex justify-between"},Ls={class:"flex items-center gap-2"};function Cs(a,t,s,L,r,i){const S=u("Heading"),C=u("router-link"),b=u("el-table-column"),D=u("el-table"),V=u("pagination");return o(),h("div",gs,[e(S,{title:"All Licenses"}),l("div",vs,[e(D,{stripe:"",data:r.licenses},{default:n(()=>[e(b,{label:"ID",width:100},{default:n(y=>[e(C,{to:{name:"view_license",params:{license_id:y.row.id}}},{default:n(()=>[x(" #"+c(y.row.id),1)]),_:2},1032,["to"])]),_:1}),e(b,{width:290,label:"License Key"},{default:n(y=>[e(C,{to:{name:"view_license",params:{license_id:y.row.id}}},{default:n(()=>[x(c(y.row.license_key),1)]),_:2},1032,["to"])]),_:1}),e(b,{width:100,label:"Status"},{default:n(y=>[l("span",null,c(y.row.status),1)]),_:1}),e(b,{"min-width":300,label:"Product"},{default:n(y=>[x(c(i.getProductName(y.row.product_details)),1)]),_:1}),e(b,{"min-width":120,label:"Customer"},{default:n(y=>[e(C,{to:{name:"view_customer",params:{customer_id:y.row.customer_id}}},{default:n(()=>{var A;return[x(c(((A=y.row)==null?void 0:A.customer.full_name)||"No Customer Found"),1)]}),_:2},1032,["to"])]),_:1}),e(b,{width:120,label:"Activations"},{default:n(y=>[x(c(y.row.activation_count)+" / "+c(y.row.limit||"Unlimited"),1)]),_:1}),e(b,{width:160,label:"Expires"},{default:n(y=>[y.row.expiration_date?(o(),h("span",bs,c(y.row.expiration_date),1)):(o(),h("span",ys,"Lifetime"))]),_:1}),e(b,{width:160,label:"Purchased"},{default:n(y=>[e(C,{to:{name:"view_order",params:{order_id:y.row.order_id}}},{default:n(()=>[x(c(y.row.created_at),1)]),_:2},1032,["to"])]),_:1})]),_:1},8,["data"]),l("div",ws,[l("div",ks,[l("div",Ls,[e(V,{"pager-only":!0,hide_on_single:!1,pagination:r.paginate,onFetch:i.fetch,onCurrentPageChanged:i.onCurrentPageChanged,onOnPerPageChanged:i.onPerPageChanged},null,8,["pagination","onFetch","onCurrentPageChanged","onOnPerPageChanged"])]),e(V,{hide_on_single:!1,pagination:r.paginate,onFetch:i.fetch,onCurrentPageChanged:i.onCurrentPageChanged,onOnPerPageChanged:i.onPerPageChanged},null,8,["pagination","onFetch","onCurrentPageChanged","onOnPerPageChanged"])])])])])}const Ss=G(fs,[["render",Cs]]);window.fluent_cart_admin.hooks.addFilter("fluent_cart_routes","fluent_all_licenses",function(a){return a.product_route.children.push({name:"license_settings",path:"license_settings",props:!0,component:xt,meta:{active_menu:"products",title:"License Settings",permission:"store/sensitive"}}),a.license_route={name:"licenses",path:"/licenses",component:ua,meta:{active_menu:"licenses",title:"Licenses",permission:"store/sensitive"}},a.view_license={name:"view_license",path:"/licenses/:license_id/view",component:us,props:!0,meta:{active_menu:"licenses",title:"View License",permission:"store/sensitive"}},a.view_customer_licenses={name:"view_customer_licenses",path:"/licenses/customer/:customer_id",component:Ss,props:!0,meta:{active_menu:"licenses",title:"View License",permission:"store/sensitive"}},a});
