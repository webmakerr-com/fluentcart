var U=Object.defineProperty;var S=r=>{throw TypeError(r)};var A=(r,t,e)=>t in r?U(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var b=(r,t,e)=>A(r,typeof t!="symbol"?t+"":t,e),B=(r,t,e)=>t.has(r)||S("Cannot "+e);var n=(r,t,e)=>(B(r,t,"read from private field"),e?e.call(r):t.get(r)),y=(r,t,e)=>t.has(r)?S("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),p=(r,t,e,o)=>(B(r,t,"write to private field"),o?o.call(r,e):t.set(r,e),e);const g=class g{static handleFragments(t){let e=!1;t.forEach(o=>{const a=document.querySelector(o.selector);a&&(o.selector&&o.type==="replace"&&(e=!0),o.type==="replace"?a.innerHTML=o.content:a.insertAdjacentHTML("beforeend",o.content))}),e&&setTimeout(()=>{window.dispatchEvent(new CustomEvent("fluentCartFragmentsReplaced",{detail:{selectors:t.filter(o=>o.type==="replace").map(o=>o.selector)}}))},10),window.dispatchEvent(new CustomEvent("fluentCartNotifySummaryViewUpdated"))}static handleSummaryViewUpdated(){fetch(g.buildUrl(`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_checkout_summary_view`).toString(),{headers:{"X-WP-Nonce":window.fluentCartRestVars.rest.nonce},credentials:"include"}).then(t=>t.json()).then(t=>{this.handleFragments(t.fragments),window.dispatchEvent(new CustomEvent("fluentCartCheckoutDataChanged",{detail:{response:t}}))}).catch(t=>{console.error("Error rendering checkout summary:",t)})}static getParams(){var c,s;const t=new URLSearchParams(window.location.search),e={};t.has("fct_cart_hash")&&(e.fct_cart_hash=t.get("fct_cart_hash")),t.has("quantity")&&(e.quantity=t.get("quantity"));const o=(c=window.fluentCartCouponService)==null?void 0:c.getCoupons();Array.isArray(o)&&o.length>0&&(e.coupons=o.join(","));const a=(s=window.fluent_cart_shipping_service)==null?void 0:s.currentShippingMethodId;return a&&(e.shipping_method_id=a),e}static buildUrl(t,e={}){const o={get(a,c){return c==="toString"||c==="valueOf"||c===Symbol.toPrimitive?()=>g._build(a.rawUrl,e):c==="rawUrl"?a.rawUrl:Reflect.get(a,c)}};return new Proxy({rawUrl:t},o)}static _build(t,e){var a,c;const o=new URLSearchParams(window.location.search);g.quantity==null&&(g.quantity=o.get("quantity")||1);for(const[s,d]of Object.entries(e))o.set(s,d);try{const s=new URL(t);for(const[k,C]of o)s.searchParams.set(k,C);s.searchParams.set("quantity",g.quantity);const d=(a=window.fluentCartCouponService)==null?void 0:a.getCoupons();Array.isArray(d)&&d.length>0&&s.searchParams.set("coupons",d.join(","));const f=(c=window.fluent_cart_shipping_service)==null?void 0:c.currentShippingMethodId;return f&&s.searchParams.set("shipping_method_id",f),s.href}catch(s){return console.error("Error building URL:",s),t}}};b(g,"quantity",null);let E=g;var i,q,M,L,P,v,m,l,w;class R{constructor({form:t,orderHandler:e,checkoutHandler:o=null,customPayment:a=!1}){y(this,i);b(this,"payMethod");y(this,q,`${window.fluentcart_checkout_vars.ajaxurl}?action=fluent_cart_checkout_routes&fc_checkout_action=get_order_info`);y(this,M);b(this,"checkoutHandler");b(this,"customPayment");y(this,L);y(this,P,null);y(this,v,!1);y(this,m,!1);y(this,l,null);y(this,w,window.fluentcart.$t);var s,d,f,k,C;p(this,M,e),p(this,i,t),this.payMethod=(s=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:s.value,this.checkoutHandler=o,p(this,l,o.checkoutUiService),this.customPayment=a,p(this,v,((d=window.fluentcart_checkout_info)==null?void 0:d.is_zero_payment)==="yes"),p(this,m,((f=window.fluentcart_checkout_info)==null?void 0:f.has_subscription)==="yes"),this.buttons=n(this,i).querySelector("[data-fluent-cart-checkout-page-checkout-button]"),this.paymenMethodsWithCustomCheckoutButtons=(k=window.fluentcart_checkout_vars)==null?void 0:k.payment_methods_with_custom_checkout_buttons,p(this,L,(C=window.fluentcart_checkout_vars)==null?void 0:C.submit_button);const c=n(this,i).querySelector('input[name="_fct_pay_method"]:checked');if(c)this.payMethod=c.value;else{const h=n(this,i).querySelector('input[name="_fct_pay_method"]');h&&(this.payMethod=h.value)}this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)&&(n(this,l).hideCheckoutButton(),n(this,l).enableCheckoutButton()),this.bindPaymentMethodListeners(),window.addEventListener("fluentCartCheckoutDataChanged",h=>{var u;this.checkTotal((u=h.detail)==null?void 0:u.response)}),window.addEventListener("fluentCartFragmentsReplaced",h=>{var u,_;(_=(u=h.detail)==null?void 0:u.selectors)!=null&&_.includes("[data-fluent-cart-checkout-payment-methods]")&&this.reinitializePaymentMethods()}),window.addEventListener("fluent_cart_payment_method_loading",h=>{const u=h.detail.payment_method;u&&(document.querySelectorAll(".fct_payment_method_wrapper").forEach(_=>{_.classList.remove("fct-payment-loading"),_.classList.remove("fct-payment-loading-failed")}),document.querySelectorAll(".fct_payment_method_"+u).forEach(_=>{_.classList.add("fct-payment-loading")}))}),window.addEventListener("fluent_cart_payment_method_loading_failed",h=>{const u=h.detail.payment_method;u&&document.querySelectorAll(".fct_payment_method_"+u).forEach(_=>{_.classList.remove("fct-payment-loading"),_.classList.add("fct-payment-loading-failed")})}),window.addEventListener("fluent_cart_payment_method_loading_success",h=>{const u=h.detail.payment_method;u&&document.querySelectorAll(".fct_payment_method_"+u).forEach(_=>{_.classList.remove("fct-payment-loading"),_.classList.remove("fct-payment-loading-failed")})})}reinitializePaymentMethods(){var o;const t=this.payMethod;this.payMethod=((o=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:o.value)||t,this.bindPaymentMethodListeners();const e=n(this,i).querySelector('input[name="_fct_pay_method"]:checked');if(e){n(this,i).querySelectorAll('input[name="_fct_pay_method"]').forEach(s=>{s.parentNode.classList.remove("active")}),e.parentNode.classList.add("active");const a=e.parentNode;if(a.querySelector(".fluent-cart-checkout_embed_payment_container")){document.querySelectorAll(".fct_payment_method_instructions").forEach(f=>f.style.display="none");const d=a.querySelector(".fct_payment_method_instructions");d&&(d.style.display="block"),this.load(this.payMethod)}}this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,l).hideCheckoutButton(),n(this,l).enableCheckoutButton()):(n(this,l).showCheckoutButton(),n(this,l).enableCheckoutButton())}bindPaymentMethodListeners(){const t=n(this,i).querySelectorAll('input[name="_fct_pay_method"]');t.forEach(e=>{e.addEventListener("change",()=>{var c;if(this.payMethod=(c=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:c.value,t.forEach(s=>s.parentNode.classList.remove("active")),e.parentNode.classList.add("active"),this.paymenMethodsWithCustomCheckoutButtons.includes(this.payMethod)?(n(this,l).hideCheckoutButton(),n(this,l).enableCheckoutButton()):(n(this,l).showCheckoutButton(),n(this,l).enableCheckoutButton()),document.querySelectorAll(".fct_payment_method_instructions").forEach(s=>{s.style.display="none"}),e.parentNode.querySelector(".fluent-cart-checkout_embed_payment_container")){const s=e.parentNode.querySelector(".fct_payment_method_instructions");s&&(s.style.display="block"),this.load(this.payMethod)}})})}checkTotal(t){(t==null?void 0:t.total)!==n(this,P)&&((t==null?void 0:t.total)>0?p(this,v,!1):(t==null?void 0:t.total)<=0&&!n(this,m)&&p(this,v,!0),p(this,P,t==null?void 0:t.total),this.togglePaymentMethods(t))}decodeHtml(t){const e=document.createElement("textarea");return e.innerHTML=t,e.value}togglePaymentMethods(t,e=!1){var a;let o=0;if(e?(o=0,p(this,m,!1)):(o=t==null?void 0:t.total,p(this,m,!!(t!=null&&t.has_subscriptions))),!n(this,m)&&o<=0){if(n(this,i).querySelectorAll('input[name="_fct_pay_method"]').length===0)return;const s=n(this,i).querySelector("[data-fluent-cart-checkout-payment-methods]");s.style.display="none",this.payMethod="offline_payment",n(this,i).querySelector('input[name="_fct_pay_method"]').checked=!1,n(this,i).querySelectorAll('input[name="_fct_pay_method"]').forEach(d=>{d.checked=!1,d.removeAttribute("checked")}),window.is_offline_payment_ready=!0,n(this,l).showCheckoutButton(),n(this,l).enableCheckoutButton()}else{const c=n(this,i).querySelector("[data-fluent-cart-checkout-payment-methods]");c.style.display="block";let s=(a=n(this,i).querySelector('input[name="_fct_pay_method"]:checked'))==null?void 0:a.value;if(this.payMethod=s,s)this.load(s);else{const d=n(this,i).querySelector('input[name="_fct_pay_method"]');d&&(d.checked=!0,this.payMethod=d.value,this.load())}}}disableCheckoutButton(t){n(this,i).classList.add("fluent-cart-checkout-order-processing"),n(this,l).disableCheckoutButton(),n(this,l).setCheckoutButtonText(t)}enableCheckoutButton(t){n(this,i).classList.add("fluent-cart-checkout-order-processing"),n(this,l).enableCheckoutButton(),n(this,l).setCheckoutButtonText(t)}showCheckoutButton(){this.buttons.style.display="block",this.buttons.disabled=!1}triggerPaymentCompleteEvent(t){var a;const e=new URLSearchParams({action:"fluent_cart_run_order_actions",order_hash:(a=t==null?void 0:t.order)==null?void 0:a.uuid}),o=new XMLHttpRequest;o.open("POST",window.fluentcart_checkout_vars.ajaxurl,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){o.status>=200&&o.status<300||console.error("Network response was not ok")},o.send(e.toString())}load(t){var s,d;if(t==null){const f=n(this,i).querySelector('input[name="_fct_pay_method"]');if(f){t=f.value,f.checked=!0,n(this,i).querySelectorAll('input[name="_fct_pay_method"]').forEach(h=>{h.parentNode.classList.remove("active")}),f.parentNode.classList.add("active");const k=f.parentNode;k.querySelector(".fluent-cart-checkout_embed_payment_container");const C=k.querySelector(".fct_payment_method_instructions");C&&(document.querySelectorAll(".fct_payment_method_instructions").forEach(h=>{h.style.display="none"}),C.style.display="block")}else return}if(this.payMethod=t,n(this,v)&&!n(this,m))return this.togglePaymentMethods({},!0);window["is_"+t+"_ready"]=!0;let e=new URLSearchParams(window.location.search);const o=n(this,q);let a={method:t};(s=window.fluentcart_checkout_info)!=null&&s.paymentMode&&(a.mode=window.fluentcart_checkout_info.paymentMode),(d=window.fluentcart_checkout_info)!=null&&d.orderHash&&(a.order_hash=window.fluentcart_checkout_info.orderHash),e.has("mode")&&e.get("variation_id")&&(a.mode=e.get("mode"),a.variation_id=e.get("variation_id"));const c=E.buildUrl(o.toString(),a).toString();window.dispatchEvent(new CustomEvent("fluent_cart_load_payments_"+t,{detail:{form:n(this,i),paymentInfoUrl:c,nonce:window.fluentcart_checkout_info.checkout_nonce,orderHandler:n(this,M),paymentLoader:this,isZeroPayment:n(this,v),hasSubscriptions:n(this,m)}}))}changeLoaderStatus(t){const e=document.querySelector(".fct-order-processing .loading-status");if(!e)return;const o={processing:n(this,w).call(this,"Payment Processing..."),confirming:n(this,w).call(this,"Confirming Payment..."),completed:n(this,w).call(this,"Payment completed! Updating order..."),redirecting:n(this,w).call(this,"Redirecting to receipt..."),failed:n(this,w).call(this,"Payment failed!"),canceled:n(this,w).call(this,"Payment canceled!"),rejected:n(this,w).call(this,"Payment Process rejected!")};e.textContent=o[t]||t}hideLoader(){const t=document.querySelector(".fct-order-processing");t&&t.classList.add("hidden")}getPaymentMethod(){return this.payMethod}}i=new WeakMap,q=new WeakMap,M=new WeakMap,L=new WeakMap,P=new WeakMap,v=new WeakMap,m=new WeakMap,l=new WeakMap,w=new WeakMap;export{E as C,R as P};
